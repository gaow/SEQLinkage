---

title: Core module


keywords: fastai
sidebar: home_sidebar

summary: "API details"
description: "API details"
nb_path: "nbs/00_Core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_Core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>which python
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/home/yh3455/miniconda3/envs/seqpy3v0/bin/python
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.-parameters">1. parameters<a class="anchor-link" href="#1.-parameters"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">SEQLinkage.Main</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>args = Args().parser.parse_args(['--fam','../sample_i/rare_positions/sample_i_coding.hg38_multianno.fam', 
                                 '--vcf', '../sample_i/rare_positions/sample_i_coding.hg38_multianno.vcf.gz',
                                 '--blueprint','./data/vipgenemap.hg38.txt','-f','MERLIN',
'--tempdir','./Tempdir_s1',
'--build', 'hg38',  '--freq', 'AF', '-K', '0.001', '--moi', 'AD', '-W', '0', '-M', '1', 
'--theta-max', '0.5', '--theta-inc', '0.05','--run-linkage', '--output', './testseqlink'])</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>args = Args().parser.parse_args(['--fam','../sample_i/rare_positions/sample_i_coding.hg38_multianno.fam', 
                                 '--vcf', '../sample_i/vcf/small_sample_i.vcf.gz',
                                 '--blueprint','./data/vipgenemap.hg38.txt','-f','MERLIN',
'--tempdir','./Tempdir_s1',
'--build', 'hg38',  '--freq', 'AF', '-K', '0.001', '--moi', 'AD', '-W', '0', '-M', '1', 
'--theta-max', '0.5', '--theta-inc', '0.05','--run-linkage', '--output', './testseqlink'])</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>args = Args().parser.parse_args(['--fam','./seqlinkage-example/seqlinkage-example.fam','--vcf','./seqlinkage-example/seqlinkage-example.vcf.gz','-f','MERLIN',
                                 '--tempdir','./seqlinkage-example/tmprst',
                                 '--build','hg19','--blueprint','./seqlinkage-example/twogenomap.txt','--freq','EVSEAAF','-K','0.001','--moi','AR','-W','0','-M','1',
                                 '--theta-max','0.5','--theta-inc','0.05','--run-linkage','--output','./seqlinkage-example/tsq20211130'])</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>?shoud we set mle parameter as true?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>args = Args().parser.parse_args(['--fam','../MWE/sample2_uniq.fam', 
                                 '--vcf', '../MWE/sample_ii_coding.hg38_multianno.vcf.gz',
'--blueprint','../MWE/genemap.hg38.txt', '--chrom-prefix','1','-f','MERLIN',
'--tempdir','./Tempdir',
'--build', 'hg38',  '--freq', 'AF', '-K', '0.001', '--moi', 'AD', '-W', '0', '-M', '1', 
'--theta-max', '0.5', '--theta-inc', '0.05','--run-linkage', '--output', './testseqlink1105'])</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>args = Args().parser.parse_args('--fam seqlinkage-example/seqlinkage-example.fam --vcf seqlinkage-example/seqlinkage-example.vcf.gz -f MERLIN --blueprint data/genemap.txt --freq EVSEAAF'.split())</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">args</span> <span class="o">=</span> <span class="n">Args</span><span class="p">()</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="s1">&#39;--fam data/mwe_normal_fam.csv --vcf data/first1000snp_full_samples.vcf.gz -f MERLIN --blueprint data/genemap.hg38.txt --freq AF&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">args</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Namespace(bin=0.8, blueprint=&#39;data/genemap.hg38.txt&#39;, single_markers=False, tfam=&#39;data/mwe_normal_fam.csv&#39;, vcf=&#39;data/first1000snp_full_samples.vcf.gz&#39;, build=&#39;hg19&#39;, prephased=False, freq=&#39;AF&#39;, freq_by_fam=None, mle=False, rvhaplo=False, recomb_max=1, recomb_cross_fam=False, rsq=0.0, include_vars=None, maf_cutoff=1.0, chr_prefix=None, output=None, format=[&#39;MERLIN&#39;], prevalence=None, inherit_mode=None, wild_pen=None, muta_pen=None, theta_max=0.5, theta_inc=0.05, run_linkage=False, output_limit=10, jobs=16, tempdir=None, vanilla=True, quiet=False, debug=False, no_save=False, func=&lt;function main at 0x2b8c25c03c10&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.from-Core-import-deepcopy">2.from Core import deepcopy<a class="anchor-link" href="#2.from-Core-import-deepcopy"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="3.-RData-class">3. RData class<a class="anchor-link" href="#3.-RData-class"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RData" class="doc_header"><code>class</code> <code>RData</code><a href="https://github.com/changebio/SEQLinkage/tree/master/SEQLinkage/Core.py#L29" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RData</code>(<strong><code>vcf</code></strong>, <strong><code>tfam</code></strong>) :: <code>dict</code></p>
</blockquote>
<p>dict() -&gt; new empty dictionary
dict(mapping) -&gt; new dictionary initialized from a mapping object's
    (key, value) pairs
dict(iterable) -&gt; new dictionary initialized as if via:
    d = {}
    for k, v in iterable:
        d[k] = v
dict(**kwargs) -&gt; new dictionary initialized with the name=value pairs
    in the keyword argument list.  For example:  dict(one=1, two=2)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="4.RegionExtractor-class">4.RegionExtractor class<a class="anchor-link" href="#4.RegionExtractor-class"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">RegionExtractor</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Extract given genomic region from VCF</span>
<span class="sd">    converting genotypes into dictionary of</span>
<span class="sd">    genotype list&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">build</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">build</span><span class="p">,</span> <span class="n">chr_prefix</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">allele_freq_info</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">include_vars_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcf</span> <span class="o">=</span> <span class="n">cstatgen</span><span class="o">.</span><span class="n">VCFstream</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">startpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chr_prefix</span> <span class="o">=</span> <span class="n">chr_prefix</span>
        <span class="c1"># name of allele frequency meta info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">af_info</span> <span class="o">=</span> <span class="n">allele_freq_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xchecker</span> <span class="o">=</span> <span class="n">PseudoAutoRegion</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">build</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ychecker</span> <span class="o">=</span> <span class="n">PseudoAutoRegion</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">build</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_vars_file</span> <span class="o">=</span> <span class="n">include_vars_file</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Clean up</span>
        <span class="n">data</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">data</span><span class="o">.</span><span class="n">chrom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">Extract</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">startpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpos</span><span class="p">)</span>
        <span class="n">varIdx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># for each variant site</span>
        <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">Next</span><span class="p">()):</span>
            <span class="c1"># skip tri-allelic sites</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">IsBiAllelic</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">triallelic_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                    <span class="n">env</span><span class="o">.</span><span class="n">triallelic_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variants</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span><span class="o">==</span><span class="n">data</span><span class="o">.</span><span class="n">variants</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">continue</span>
            <span class="c1"># check if the line&#39;s sample number matches the entire VCF sample number</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">CountSampleGenotypes</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">sampleCount</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Genotype and sample mismatch for region </span><span class="si">{}</span><span class="s1">: </span><span class="si">{:,d}</span><span class="s1"> vs </span><span class="si">{:,d}</span><span class="s1">&#39;</span><span class="o">.</span>\
                             <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">CountSampleGenotypes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">sampleCount</span><span class="p">))</span>
            <span class="c1"># valid line found, get variant info</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">af_info</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">maf</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">large_maf</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">pop_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">af_info</span><span class="p">:</span>
                        <span class="n">large_maf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">maf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">GetInfo</span><span class="p">(</span><span class="n">pop_info</span><span class="p">)))</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="n">maf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">maf</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">maf</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                            <span class="n">large_maf</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
                            <span class="n">maf</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">maf</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">large_maf</span><span class="o">=</span><span class="kc">False</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">maf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">GetInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">af_info</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">af_info</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">maf</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="k">if</span> <span class="n">maf</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                        <span class="n">large_maf</span><span class="o">=</span><span class="kc">True</span>
                        <span class="n">maf</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">maf</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;VCF line </span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2"> does not have valid allele frequency field </span><span class="si">{}</span><span class="s2">!&quot;</span><span class="o">.</span>\
                                 <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">GetChrom</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">af_info</span><span class="p">))</span>
            <span class="n">data</span><span class="o">.</span><span class="n">variants</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">GetChrom</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">maf</span><span class="p">])</span>
            <span class="c1"># for each family assign member genotype if the site is non-trivial to the family</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">:</span>
                <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">GetGenotypes</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">famsampidx</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">popidx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">af_info</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">large_maf</span><span class="p">[</span><span class="n">popidx</span><span class="p">]:</span>
                        <span class="n">tmpgs</span><span class="o">=</span><span class="p">[]</span>
                        <span class="k">for</span> <span class="n">tmpg</span> <span class="ow">in</span> <span class="n">gs</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">tmpg</span><span class="o">==</span><span class="s1">&#39;00&#39;</span><span class="p">:</span>
                                <span class="n">tmpgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpg</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">tmpgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">tg</span><span class="p">))</span> <span class="k">for</span> <span class="n">tg</span> <span class="ow">in</span> <span class="n">tmpg</span><span class="p">]))</span>
                        <span class="n">gs</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">tmpgs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">large_maf</span><span class="p">:</span>
                        <span class="n">tmpgs</span><span class="o">=</span><span class="p">[]</span>
                        <span class="k">for</span> <span class="n">tmpg</span> <span class="ow">in</span> <span class="n">gs</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">tmpg</span><span class="o">==</span><span class="s1">&#39;00&#39;</span><span class="p">:</span>
                                <span class="n">tmpgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpg</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">tmpgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">tg</span><span class="p">))</span> <span class="k">for</span> <span class="n">tg</span> <span class="ow">in</span> <span class="n">tmpg</span><span class="p">]))</span>
                        <span class="n">gs</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">tmpgs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">person</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">gs</span><span class="p">):</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">genotype_all</span><span class="p">[</span><span class="n">person</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gs</span><span class="p">)))</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># skip monomorphic gs</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gs</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;00&quot;</span><span class="p">])))</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">wtvar</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varIdx</span><span class="p">)</span>
                    <span class="c1"># this variant is found in the family</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">famvaridx</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varIdx</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">person</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">gs</span><span class="p">):</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
            <span class="n">varIdx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">varIdx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_vars_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">include_vars_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">invar_fh</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">invar_line</span> <span class="ow">in</span> <span class="n">invar_fh</span><span class="p">:</span>
                        <span class="n">chrom</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">invar_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">vidx</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variants</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">chrom</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
                                <span class="n">data</span><span class="o">.</span><span class="n">include_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
                                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">include_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">variants</span><span class="p">]</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">variants_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                <span class="n">env</span><span class="o">.</span><span class="n">variants_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="n">varIdx</span>
            <span class="k">return</span> <span class="mi">0</span>


    <span class="k">def</span> <span class="nf">getRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">startpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">region</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startpos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startpos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endpos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endpos</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;23&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xchecker</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startpos</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">xchecker</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endpos</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span> <span class="o">=</span> <span class="s1">&#39;XY&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;24&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ychecker</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startpos</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ychecker</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endpos</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span> <span class="o">=</span> <span class="s1">&#39;XY&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chr_prefix</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chr_prefix</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chr_prefix</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="5.MarkerMaker-class">5.MarkerMaker class<a class="anchor-link" href="#5.MarkerMaker-class"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">MarkerMaker</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wsize</span><span class="p">,</span> <span class="n">maf_cutoff</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">single_markers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">recomb_max</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">af_info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">freq_by_fam</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">rsq</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">mle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">rvhaplo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">recomb_perfam</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">missings</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gtconv</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recomb_max</span> <span class="o">=</span> <span class="n">recomb_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">haplotyper</span> <span class="o">=</span> <span class="n">cstatgen</span><span class="o">.</span><span class="n">HaplotypingEngine</span><span class="p">(</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">af_info</span> <span class="o">=</span> <span class="n">af_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_by_fam</span> <span class="o">=</span> <span class="n">freq_by_fam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rsq</span><span class="o">=</span><span class="n">rsq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mle</span><span class="o">=</span><span class="n">mle</span>          <span class="c1">#use MLE estimate from families for MAF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">=</span> <span class="ow">not</span> <span class="n">mle</span>   <span class="c1">#count founder alleles to estimate MAF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rvhaplo</span><span class="o">=</span><span class="n">rvhaplo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recomb_perfam</span><span class="o">=</span><span class="n">recomb_perfam</span>
        <span class="k">if</span> <span class="n">wsize</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">wsize</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r2</span> <span class="o">=</span> <span class="n">wsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coder</span> <span class="o">=</span> <span class="n">cstatgen</span><span class="o">.</span><span class="n">HaplotypeCoder</span><span class="p">(</span><span class="n">wsize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maf_cutoff</span> <span class="o">=</span> <span class="n">maf_cutoff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single_markers</span> <span class="o">=</span> <span class="n">single_markers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># temp raw haplotype, maf and variant names data</span>
        <span class="n">haplotypes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">mafs</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1">##Per fam per variant</span>
        <span class="n">uniq_vars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">exclude_vars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">varnames</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">recombPos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1">#try:</span>
            <span class="c1"># haplotyping plus collect found allele counts</span>
            <span class="c1"># and computer founder MAFS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__Haplotype</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">,</span><span class="n">recombPos</span><span class="p">,</span><span class="n">uniq_vars</span><span class="p">,</span><span class="n">exclude_vars</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;__Haplotype&#39;</span><span class="p">,</span><span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">,</span><span class="n">recombPos</span><span class="p">,</span><span class="n">uniq_vars</span><span class="p">,</span><span class="n">exclude_vars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">haplotypes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mafs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">varnames</span> <span class="o">=</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span>  <span class="c1">###anno</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span> <span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">]):</span>
                <span class="c1"># all families have only one variant</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__AssignSNVHaplotypes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># calculate LD clusters using founder haplotypes</span>
                <span class="n">clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ClusterByLD</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">varnames</span><span class="p">)</span>
                <span class="c1"># recoding the genotype of the region</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__CodeHaplotypes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">,</span> <span class="n">clusters</span><span class="p">)</span>
    <span class="c1">#except Exception as e:</span>
        <span class="c1">#    if env.debug:</span>
        <span class="c1">#        raise</span>
        <span class="c1">#    return -1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__FormatHaplotypes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">recombPos</span><span class="p">,</span><span class="n">varnames</span><span class="p">,</span><span class="n">uniq_vars</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__getMLEfreq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span> <span class="n">markers_to_analyze</span><span class="p">,</span> <span class="n">pos_all</span><span class="p">,</span> <span class="n">families</span><span class="p">,</span> <span class="n">rsq</span><span class="p">,</span> <span class="n">output_log</span><span class="p">):</span>
        <span class="n">output_sample</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">mle_mafs</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers_to_analyze</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mle_mafs</span>
        <span class="k">for</span> <span class="n">fam</span> <span class="ow">in</span> <span class="n">families</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">sort_family</span><span class="p">(</span><span class="n">fam</span><span class="p">):</span>
                <span class="n">output_sample</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="n">last_ele</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">output_sample</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">output_sample</span><span class="p">[</span><span class="n">last_ele</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">person</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">markers_to_analyze</span><span class="p">:</span>
                        <span class="n">idx</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">marker</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                        <span class="n">output_sample</span><span class="p">[</span><span class="n">last_ele</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">genotype_all</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">output_sample</span><span class="p">[</span><span class="n">last_ele</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;00&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers_to_analyze</span><span class="p">))</span>
        <span class="k">with</span> <span class="n">stdoutRedirect</span><span class="p">(</span><span class="n">to</span> <span class="o">=</span> <span class="n">output_log</span><span class="p">):</span>
            <span class="n">af</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">haplotyper</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="n">markers_to_analyze</span><span class="p">,</span> <span class="n">pos_all</span><span class="p">,</span> <span class="n">output_sample</span><span class="p">,</span> <span class="n">rsq</span><span class="p">,</span> <span class="n">output_log</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_log</span><span class="p">)</span> <span class="k">as</span> <span class="n">mle_fh</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">mle_fh</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">):</span>
                    <span class="n">tmp_eles</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tmp_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mle_mafs</span><span class="p">:</span>
                        <span class="n">freqs</span><span class="o">=</span><span class="n">tmp_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">mle_maf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">mle_maf</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">:</span>
                            <span class="n">mle_mafs</span><span class="p">[</span><span class="n">tmp_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.9f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">mle_maf</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1">#alt allele is more frequent</span>
                            <span class="n">mle_mafs</span><span class="p">[</span><span class="n">tmp_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.9f</span><span class="s2">&quot;</span><span class="o">%</span><span class="k">mle_maf</span>)
                            <span class="n">marker_idx</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">tmp_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                            <span class="k">for</span> <span class="n">fam</span> <span class="ow">in</span> <span class="n">families</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">marker_idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">famvaridx</span><span class="p">[</span><span class="n">fam</span><span class="p">]:</span>
                                    <span class="k">continue</span>
                                <span class="n">tmp_famvaridx</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">famvaridx</span><span class="p">[</span><span class="n">fam</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">marker_idx</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">fam</span><span class="p">]:</span>
                                    <span class="n">tmpg</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">genotype_all</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">marker_idx</span><span class="p">]</span>
                                    <span class="n">tmpg_switch</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">tg</span><span class="p">))</span> <span class="k">for</span> <span class="n">tg</span> <span class="ow">in</span> <span class="n">tmpg</span><span class="p">])</span> <span class="k">if</span> <span class="n">tmpg</span><span class="o">!=</span><span class="s1">&#39;00&#39;</span> <span class="k">else</span> <span class="n">tmpg</span>
                                    <span class="n">data</span><span class="o">.</span><span class="n">genotype_all</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">marker_idx</span><span class="p">]</span><span class="o">=</span><span class="n">tmpg_switch</span>
                                    <span class="n">tmpg2</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">tmp_famvaridx</span><span class="p">]</span>
                                    <span class="n">tmpg_switch2</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">tg</span><span class="p">))</span> <span class="k">for</span> <span class="n">tg</span> <span class="ow">in</span> <span class="n">tmpg2</span><span class="p">])</span> <span class="k">if</span> <span class="n">tmpg2</span><span class="o">!=</span><span class="s1">&#39;00&#39;</span> <span class="k">else</span> <span class="n">tmpg2</span>
                                    <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">tmp_famvaridx</span><span class="p">]</span><span class="o">=</span><span class="n">tmpg_switch2</span>
        <span class="k">return</span> <span class="n">mle_mafs</span>

    <span class="k">def</span> <span class="nf">__computefounderfreq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span> <span class="n">families</span><span class="p">):</span>
        <span class="c1">#count founder alleles to estimate MAF</span>
        <span class="n">total_founder_alleles</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">tmp_haplotypes</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">tmp_mafs</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">families</span><span class="p">:</span>
            <span class="n">tmp_haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__PedToHaplotype</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="c1"># count founder alleles</span>
            <span class="k">for</span> <span class="n">hap</span> <span class="ow">in</span> <span class="n">tmp_haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">is_founder</span><span class="p">(</span><span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">continue</span>
                <span class="n">total_founder_alleles</span><span class="o">+=</span><span class="mf">1.0</span>
                <span class="k">for</span> <span class="n">idxv</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getFamVariants</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;map&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_mafs</span><span class="p">:</span>
                        <span class="c1"># [#alt, #haplotypes]</span>
                        <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">gt</span> <span class="o">=</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">gt</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
                    <span class="c1">#genotyped</span>
                        <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gtconv</span><span class="p">[</span><span class="n">gt</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#genotype is missing</span>
                        <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">1.0</span>
        <span class="c1">#compute MAFs based on counts</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tmp_mafs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">total_founder_alleles</span><span class="p">)</span> <span class="k">if</span> <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">total_founder_alleles</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">tmp_mafs</span>

    <span class="k">def</span> <span class="nf">__Haplotype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">,</span><span class="n">recombPos</span><span class="p">,</span><span class="n">uniq_vars</span><span class="p">,</span><span class="n">exclude_vars</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;genetic haplotyping. haplotypes stores per family data&#39;&#39;&#39;</span>
        <span class="c1"># FIXME: it is SWIG&#39;s (2.0.12) fault not to properly destroy the object &quot;Pedigree&quot; in &quot;Execute()&quot;</span>
        <span class="c1"># So there is a memory leak here which I tried to partially handle on C++</span>
        <span class="c1">#</span>
        <span class="c1"># Per family haplotyping</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;V</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variants</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">:</span>
            <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">positions</span><span class="p">,</span> <span class="n">vcf_mafs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamVariants</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missings</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># haplotyping</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hap</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">env</span><span class="o">.</span><span class="n">prephased</span><span class="p">:</span>
                    <span class="n">tmp_log_output</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span> 
                    <span class="c1">#with stdoutRedirect(to = tmp_log_output + &#39;.log&#39;):</span>
                    <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">haplotyper</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> 
                                                                   <span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsq</span><span class="p">,</span> <span class="n">tmp_log_output</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;haplotyper execute&#39;</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hap</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__PedToHaplotype</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
           
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># C++ haplotyping implementation failed</span>
                <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                    <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># either use privided MAF or computer MAF</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">vcf_mafs</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mafs</span><span class="p">:</span>
                        <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcf_mafs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># count founder alleles</span>
                <span class="k">for</span> <span class="n">hap</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">is_founder</span><span class="p">(</span><span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">idxv</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mafs</span><span class="p">:</span>
                            <span class="c1"># [#alt, #haplotypes]</span>
                            <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">gt</span> <span class="o">=</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">gt</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
                            <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gtconv</span><span class="p">[</span><span class="n">gt</span><span class="p">]</span>
                            <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
        <span class="c1">#</span>
        <span class="c1"># Compute founder MAFs</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mafs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;variant mafs = &quot;</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Drop some variants if maf is greater than given threshold</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maf_cutoff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exclude_vars</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mafs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maf_cutoff</span><span class="p">:</span>
                    <span class="n">exclude_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">listit</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                    <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> \
                      <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">:])</span> <span class="k">if</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_vars</span><span class="p">]</span>
                <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_vars</span><span class="p">]</span>
                <span class="c1"># handle trivial data</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missings</span>
                    <span class="k">del</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># count how many variants are removed</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">commonvar_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                <span class="n">env</span><span class="o">.</span><span class="n">commonvar_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exclude_vars</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ClusterByLD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">varnames</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># get founder haplotypes</span>
        <span class="n">founder_haplotypes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">varnames</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ihap</span><span class="p">,</span> <span class="n">hap</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">is_founder</span><span class="p">(</span><span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">continue</span>
                <span class="n">gt</span> <span class="o">=</span> <span class="p">[</span><span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;?&#39;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">markers</span><span class="p">]</span>
                <span class="n">founder_haplotypes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ihap</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">])))</span>
        <span class="c1"># calculate LD blocks, use r2 measure</span>
        <span class="n">ld</span> <span class="o">=</span> <span class="n">Align</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">founder_haplotypes</span><span class="p">)</span><span class="o">.</span><span class="n">matrixLD</span><span class="p">(</span><span class="n">validCharacters</span><span class="o">=</span><span class="s2">&quot;12&quot;</span><span class="p">)[</span><span class="s2">&quot;r2&quot;</span><span class="p">]</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ld</span><span class="p">:</span>
            <span class="n">block</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ld</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ld</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2</span><span class="p">:</span>
                    <span class="n">block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ld</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">ld</span><span class="p">,</span> <span class="n">blocks</span>
        <span class="c1"># get LD clusters</span>
        <span class="n">clusters</span> <span class="o">=</span> <span class="p">[[</span><span class="n">markers</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">connected_components</span><span class="p">(</span><span class="n">blocks</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LD blocks: &quot;</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LD clusters: &quot;</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clusters</span>


    <span class="k">def</span> <span class="nf">__CodeHaplotypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">,</span> <span class="n">clusters</span><span class="p">):</span>
        <span class="c1"># apply CHP coding</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">famvaridx</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">haplotypes</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">):</span>
                <span class="c1"># when only wild-type haplotypes are present in a family, still code them instead of ignoring the family</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
                    <span class="n">pop</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span>
                        <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">total_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span>
                    <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">total_mafs</span>
                <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                    <span class="n">tmp_person</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">,</span> <span class="n">person</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s1">&#39;00&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]:</span>
                        <span class="n">tmp_person</span><span class="o">+=</span><span class="p">[</span><span class="s1">&#39;?:&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tmp_person</span><span class="o">+=</span><span class="p">[</span><span class="s1">&#39;1:&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                    <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_person</span><span class="p">)</span>
                    <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_person</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
                <span class="n">nonvar_hap_flag</span><span class="o">=</span><span class="kc">False</span>
                <span class="c1">#determine if wild-type haplotype is present in a family</span>
                <span class="k">for</span> <span class="n">hap</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                    <span class="n">tmp_genes</span><span class="o">=</span><span class="p">[]</span>
                    <span class="k">for</span> <span class="n">tmpa</span> <span class="ow">in</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                        <span class="k">if</span> <span class="s1">&#39;A&#39;</span> <span class="ow">in</span> <span class="n">tmpa</span> <span class="ow">or</span> <span class="s1">&#39;B&#39;</span> <span class="ow">in</span> <span class="n">tmpa</span><span class="p">:</span>
                            <span class="n">tmp_genes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpa</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">tmp_genes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">tmp_genes</span><span class="p">)</span><span class="o">==</span><span class="nb">set</span><span class="p">([</span><span class="s1">&#39;1&#39;</span><span class="p">]):</span>
                        <span class="c1">#non variant haplotype</span>
                        <span class="n">nonvar_hap_flag</span><span class="o">=</span><span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">nonvar_hap_flag</span><span class="p">:</span>
                    <span class="c1">#if family don&#39;t have wild-type haplotype, add a fake one to ensure correct coding</span>
                    <span class="n">var_num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                    <span class="n">fake_person</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;FAKEPERSON&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;1:&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">var_num</span>
                    <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fake_person</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">hidx</span><span class="p">,</span><span class="n">hap</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">missing_persons</span><span class="p">:</span>
                        <span class="n">missing_person</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">,</span><span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;?:&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                        <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">hidx</span><span class="p">]</span><span class="o">=</span><span class="n">missing_person</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">clusters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">clusters_idx</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clusters_idx</span> <span class="o">=</span> <span class="p">[[[]]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hap</span><span class="si">{0}</span><span class="se">\t</span><span class="si">{1}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]),</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">haplotypes</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[[</span><span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">],</span> <span class="n">clusters_idx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">clusters</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Family LD clusters: &quot;</span><span class="p">,</span> <span class="n">clusters_idx</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>
        <span class="c1"># line: [fid, sid, hap1, hap2]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">GetHaplotypes</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="c1"># this sample is not in VCF file. Every variant site should be missing</span>
                <span class="c1"># they have to be skipped for now</span>
                <span class="k">continue</span>
            <span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span> <span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
            <span class="c1">#sub-region count for each sample individual</span>
            <span class="n">superMarkerCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">superMarkerCount</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">t_Marker</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">superMarkerCount</span><span class="p">):</span>
                <span class="n">t_pat1</span><span class="o">=</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="n">t_Marker</span><span class="p">]</span>
                <span class="n">t_pat2</span><span class="o">=</span><span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="n">t_Marker</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">t_pat1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">t_Marker</span><span class="p">]:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">t_Marker</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_pat1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">t_pat2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">t_Marker</span><span class="p">]:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">t_Marker</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_pat2</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># get MAF</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">famvaridx</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span><span class="o">=</span><span class="p">([</span><span class="s1">&#39;0&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span><span class="p">,[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">GetAlleleFrequencies</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="n">data</span><span class="o">.</span><span class="n">varnames_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
            <span class="n">wt_maf</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">wt_maf</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">wt_maf</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wt_maf</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">wt_maf</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span>
            <span class="n">tmp_data_maf</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">tmp_data_maf</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">tmp_ratio</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">wt_maf</span><span class="p">)</span>
                        <span class="n">tmp_list</span><span class="o">=</span><span class="p">[</span><span class="n">wt_maf</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">tmp_ratio</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">tmp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">wt_maf</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">tmpv</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                                <span class="n">tmp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpv</span><span class="o">/</span><span class="n">tmp_ratio</span><span class="p">)</span>
                        <span class="n">tmp_data_maf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">tmp_list</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tmp_data_maf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">tmp_data_maf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;marker freqs = &quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__AssignSNVHaplotypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
            <span class="c1"># each person&#39;s haplotype</span>
            <span class="n">data</span><span class="o">.</span><span class="n">varnames_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
            <span class="n">token</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">missing_persons</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">token</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">token</span><span class="o">==</span><span class="s1">&#39;?&#39;</span><span class="p">:</span>
                            <span class="n">token</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tmp_token</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">tmp_token</span><span class="o">==</span><span class="s1">&#39;?&#39;</span><span class="p">:</span>
                            <span class="n">tmp_token</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">tmp_token</span><span class="p">)</span>

            <span class="c1"># get MAF</span>
            <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]])]</span>
            <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>
                              <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">famvaridx</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">haplotypes</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s1">&#39;00&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
                <span class="n">t_maf</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">t_maf</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">wt_maf</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                            <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">t_maf</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">wt_maf</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span>
                <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="n">t_maf</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">t_maf</span><span class="p">),)</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;marker freqs = &quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__FormatHaplotypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span><span class="n">recombPos</span><span class="p">,</span><span class="n">varnames</span><span class="p">,</span><span class="n">uniq_vars</span><span class="p">):</span>
        <span class="c1"># Reformat sample genotypes</span>
        <span class="c1">## Linhai Edit: Reformat to deal with recombination events in families</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recomb_perfam</span><span class="p">:</span>
            <span class="c1">#code recombination per family basis, no need to consider overlap across families</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missings</span>
                    <span class="k">continue</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">missings</span><span class="p">]</span> <span class="o">*</span> <span class="n">diff</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#code recombination across families to generate sub-regions that extend across families</span>
            <span class="n">tmp_combined_recombPos</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">sorted_var</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">uniq_vars</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]))</span>
            <span class="k">for</span> <span class="n">fam</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">fam</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">recombPos</span><span class="p">[</span><span class="n">fam</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:(</span><span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))):</span>
                        <span class="k">if</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">varnames</span><span class="p">[</span><span class="n">fam</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="c1">##remove recombination event if occurred at 1st RV</span>
                            <span class="k">del</span> <span class="n">recombPos</span><span class="p">[</span><span class="n">fam</span><span class="p">][</span><span class="n">pair</span><span class="p">]</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="n">fam</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_combined_recombPos</span><span class="p">:</span>
                            <span class="n">tmp_combined_recombPos</span><span class="p">[</span><span class="n">fam</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">tmp_combined_recombPos</span><span class="p">[</span><span class="n">fam</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
            <span class="n">tmp_all_recombs</span><span class="o">=</span><span class="p">[</span><span class="n">pair</span> <span class="k">for</span> <span class="n">pairs</span> <span class="ow">in</span> <span class="n">tmp_combined_recombPos</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">]</span>
            <span class="n">sorted_combined_recombPos</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tmp_all_recombs</span><span class="p">)),</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:(</span><span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="n">recomb_fams</span><span class="o">=</span><span class="n">tmp_combined_recombPos</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="c1">##get sub-regions that applies to all families</span>
            <span class="k">for</span> <span class="n">varidx</span><span class="p">,</span><span class="n">variant</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_var</span><span class="p">):</span>
                <span class="n">included_fams</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">recomb_fams</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">recomb_region</span> <span class="ow">in</span> <span class="n">sorted_combined_recombPos</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">varidx</span> <span class="o">&gt;</span> <span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">recomb_region</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">varidx</span> <span class="o">&lt;</span> <span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">recomb_region</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="c1">##if the variant is in a recombination region</span>
                        <span class="n">included_fams</span><span class="o">-=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">included_fams</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">recomb_fams</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">combined_regions</span><span class="o">==</span><span class="p">[]:</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">combined_regions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">variant</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">combined_regions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="n">varidx</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">neighbour_recomb_flag</span><span class="o">=</span><span class="kc">False</span>
                            <span class="k">for</span> <span class="n">recomb_region</span> <span class="ow">in</span> <span class="n">sorted_combined_recombPos</span><span class="p">:</span>
                                <span class="n">recomb_idx</span><span class="o">=</span><span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">recomb_region</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">recomb_idx</span><span class="o">==</span><span class="n">varidx</span><span class="p">:</span>
                                    <span class="n">neighbour_recomb_flag</span><span class="o">=</span><span class="kc">True</span>
                                    <span class="k">break</span>
                                <span class="k">elif</span> <span class="n">recomb_idx</span><span class="o">&gt;</span><span class="n">varidx</span><span class="p">:</span>
                                    <span class="k">break</span>
                            <span class="k">if</span> <span class="n">neighbour_recomb_flag</span><span class="p">:</span>
                                <span class="n">data</span><span class="o">.</span><span class="n">combined_regions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">variant</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">data</span><span class="o">.</span><span class="n">combined_regions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variant</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">data</span><span class="o">.</span><span class="n">combined_regions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">variant</span><span class="p">])</span>
            <span class="c1">##Get the markers in families compliant with the sub_regions</span>
            <span class="k">for</span> <span class="n">sub_region</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">combined_regions</span><span class="p">:</span>
                <span class="n">markers</span><span class="o">=</span><span class="p">{}</span>
                <span class="k">for</span> <span class="n">fam</span> <span class="ow">in</span> <span class="n">recomb_fams</span><span class="p">:</span>
                    <span class="n">pidx</span><span class="o">=</span><span class="mi">0</span>
                    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">recombPos</span><span class="p">[</span><span class="n">fam</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:(</span><span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))):</span>
                        <span class="n">sub_region_start</span><span class="o">=</span><span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sub_region</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">sub_region_end</span><span class="o">=</span><span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sub_region</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">recomb_start</span><span class="o">=</span><span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">recomb_end</span><span class="o">=</span><span class="n">sorted_var</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">sub_region_end</span> <span class="o">&lt;=</span> <span class="n">recomb_start</span><span class="p">:</span>
                            <span class="n">markers</span><span class="p">[</span><span class="n">fam</span><span class="p">]</span><span class="o">=</span><span class="n">pidx</span>
                            <span class="k">break</span>
                        <span class="k">elif</span> <span class="n">sub_region_end</span> <span class="o">&gt;</span> <span class="n">recomb_start</span> <span class="ow">and</span> <span class="n">sub_region_start</span><span class="o">&gt;</span><span class="n">recomb_start</span> <span class="ow">and</span> <span class="n">sub_region_end</span><span class="o">&lt;</span><span class="n">recomb_end</span><span class="p">:</span>
                            <span class="c1">##within the recombination region</span>
                            <span class="n">markers</span><span class="p">[</span><span class="n">fam</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
                            <span class="k">break</span>
                        <span class="n">pidx</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">fam</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">markers</span><span class="p">:</span>
                        <span class="n">markers</span><span class="p">[</span><span class="n">fam</span><span class="p">]</span><span class="o">=</span><span class="n">pidx</span>
                <span class="n">data</span><span class="o">.</span><span class="n">complied_markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">markers</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">combined_regions</span><span class="p">)</span>
            <span class="c1">#coordinates for sub_regions</span>
            <span class="n">data</span><span class="o">.</span><span class="n">coordinates_by_region</span><span class="o">=</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">sub_region</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">sub_region</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span> <span class="k">for</span> <span class="n">sub_region</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">combined_regions</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missings</span>
                    <span class="k">continue</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1">##only one whole region with no recombination</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">*</span> <span class="n">diff</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">famid</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
                        <span class="k">for</span> <span class="n">fam</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">complied_markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">fam</span><span class="p">]:</span>
                                <span class="n">famid</span><span class="o">=</span><span class="n">fam</span>
                        <span class="n">complied_data</span><span class="o">=</span><span class="p">[]</span>
                        <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">complied_markers</span><span class="p">:</span>
                            <span class="n">complied_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">marker</span><span class="p">[</span><span class="n">famid</span><span class="p">]])</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span><span class="o">=</span><span class="n">complied_data</span>

    <span class="k">def</span> <span class="nf">__PedToHaplotype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ped</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;convert prephased ped format to haplotype format.</span>
<span class="sd">        Input: e.g. [[&#39;13346&#39;, &#39;5888&#39;, &#39;0&#39;, &#39;0&#39;, &#39;1&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;], [&#39;13346&#39;, &#39;5856&#39;, &#39;0&#39;, &#39;0&#39;, &#39;2&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;], [&#39;13346&#39;, &#39;5920&#39;, &#39;5888&#39;, &#39;5856&#39;, &#39;1&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;], [&#39;13346&#39;, &#39;6589&#39;, &#39;5888&#39;, &#39;5856&#39;, &#39;1&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;]]</span>
<span class="sd">        Output: e.g. ((&#39;13346&#39;, &#39;5856&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;), (&#39;13346&#39;, &#39;5856&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;2:&#39;), (&#39;13346&#39;, &#39;5888&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;), (&#39;13346&#39;, &#39;5888&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;), (&#39;13346&#39;, &#39;6589&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;), (&#39;13346&#39;, &#39;6589&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;), (&#39;13346&#39;, &#39;5920&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;2|&#39;), (&#39;13346&#39;, &#39;5920&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;))</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">haps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ped</span><span class="p">:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span> <span class="k">else</span> <span class="s1">&#39;?:&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">:]]</span>
            <span class="n">haps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span> <span class="k">else</span> <span class="s1">&#39;?:&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">:]]</span>
            <span class="n">haps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">haps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="6.LinkageWriter-class">6.LinkageWriter class<a class="anchor-link" href="#6.LinkageWriter-class"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">LinkageWriter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_missing_append</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_chrom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_avg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_f</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_by_region</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mid_position</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">missings</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_missing</span> <span class="o">=</span> <span class="n">num_missing_append</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_chrom</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_chrom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prev_chrom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># new chrom entered,</span>
                <span class="c1"># commit whatever is in buffer before accepting new data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="c1"># write tped output</span>
        <span class="n">position</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getMidPosition</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># genotypes</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">gs</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># everyone&#39;s genotype is the same (most likely missing or monomorphic)</span>
                <span class="k">return</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tped</span> <span class="o">+=</span> <span class="n">env</span><span class="o">.</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">position</span><span class="p">]</span> <span class="o">+</span> \
                <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">gs</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">missings</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_missing</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="c1"># freqs</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">+=</span> <span class="n">env</span><span class="o">.</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># have to expand each region into mutiple chunks to account for different recomb points</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="p">])</span>
            <span class="c1"># sub-chunk id</span>
            <span class="n">cid</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">skipped_chunk</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distance_by_region</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">distance_converter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">position</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">coordinates_by_region</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gs</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">skipped_chunk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">cid</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tped</span> <span class="o">+=</span> \
                  <span class="n">env</span><span class="o">.</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cid</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_by_region</span><span class="p">[</span><span class="n">cid</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">position</span><span class="p">]</span> <span class="o">+</span> \
                  <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">g</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">missings</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_missing</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">cid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># everyone&#39;s genotype is the same (most likely missing or monomorphic)</span>
                <span class="k">return</span> <span class="mi">2</span>
            <span class="c1"># freqs</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">:</span>
                <span class="n">cid</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">skipped_chunk</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">complied_markers</span><span class="p">:</span>
                        <span class="c1">#if recombination coded per family instead of across families</span>
                        <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                            <span class="k">break</span>
                        <span class="n">cid</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">+=</span> <span class="n">env</span><span class="o">.</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cid</span><span class="p">)]</span> <span class="o">+</span> \
                                                    <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">idx</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">matched_idx</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">complied_markers</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                            <span class="n">cid</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">+=</span> <span class="n">env</span><span class="o">.</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cid</span><span class="p">)]</span> <span class="o">+</span> \
                                                <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">matched_idx</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">cid</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">+=</span> <span class="n">env</span><span class="o">.</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cid</span><span class="p">)]</span> <span class="o">+</span> \
                                                <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">combined_regions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chp</span> <span class="o">+=</span> <span class="s2">&quot;CHP Super Marker positions: &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">combined_regions</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">varnames_by_fam</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pattern_txt</span><span class="o">=</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">tmarker</span><span class="p">],</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">)</span> <span class="p">))</span> <span class="k">for</span> <span class="n">tmarker</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">[</span><span class="n">item</span><span class="p">]))]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">pattern_txt</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">varfam</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">varnames_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">],</span><span class="n">pattern_txt</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="n">env</span><span class="o">.</span><span class="n">batch</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tped</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.chr</span><span class="si">{}</span><span class="s1">.tped&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_chrom</span><span class="p">)),</span>
                          <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tped</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.chr</span><span class="si">{}</span><span class="s1">.freq&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_chrom</span><span class="p">)),</span>
                          <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chp</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.chr</span><span class="si">{}</span><span class="s1">.chp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_chrom</span><span class="p">)),</span>
                          <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chp</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">varfam</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.chr</span><span class="si">{}</span><span class="s1">.var&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_chrom</span><span class="p">)),</span>
                          <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varfam</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tped</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chp</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varfam</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_chrom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span>

    <span class="k">def</span> <span class="nf">distance_converter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mid_position</span><span class="p">):</span>
        <span class="n">delta</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">mid_position</span><span class="p">)</span><span class="o">/</span><span class="mf">1000000.0</span>
        <span class="n">distance</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.5f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distance_avg</span><span class="p">)</span><span class="o">+</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">distance_m</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.5f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distance_m</span><span class="p">)</span><span class="o">+</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">distance_f</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.5f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distance_f</span><span class="p">)</span><span class="o">+</span><span class="n">delta</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">distance</span><span class="p">,</span><span class="n">distance_m</span><span class="p">,</span><span class="n">distance_f</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">getRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_avg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_f</span> <span class="o">=</span> <span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">distance_avg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_f</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="7.EncoderWorker-class">7.EncoderWorker class<a class="anchor-link" href="#7.EncoderWorker-class"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">EncoderWorker</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">extractor</span><span class="p">,</span> <span class="n">coder</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
        <span class="n">Process</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numGrps</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extractor</span> <span class="o">=</span> <span class="n">extractor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maker</span> <span class="o">=</span> <span class="n">coder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">writer</span>

    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units processed {{</span><span class="si">{:.2%}</span><span class="s1">}} ...&#39;</span><span class="o">.</span>\
                <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">success_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">total_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">numGrps</span><span class="p">),</span> <span class="n">flush</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
                    <span class="c1"># total mendelian errors found</span>
                    <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">mendelerror_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                        <span class="n">env</span><span class="o">.</span><span class="n">mendelerror_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maker</span><span class="o">.</span><span class="n">haplotyper</span><span class="o">.</span><span class="n">CountMendelianErrors</span><span class="p">()</span>
                    <span class="c1"># total recombination events found</span>
                    <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">recomb_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                        <span class="n">env</span><span class="o">.</span><span class="n">recomb_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maker</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">CountRecombinations</span><span class="p">()</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">total_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                        <span class="n">env</span><span class="o">.</span><span class="n">total_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">extractor</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">maker</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
                    <span class="n">isSuccess</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">extractor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">]:</span>
                        <span class="n">status</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                                <span class="c1"># previous module failed</span>
                                <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">null_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                                <span class="n">env</span><span class="o">.</span><span class="n">null_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">trivial_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                                <span class="n">env</span><span class="o">.</span><span class="n">trivial_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">isSuccess</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">isSuccess</span><span class="p">:</span>
                        <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">success_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                            <span class="n">env</span><span class="o">.</span><span class="n">success_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">total_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">%</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">batch</span> <span class="o">*</span> <span class="n">env</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
                <span class="k">break</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Old-version">Old version<a class="anchor-link" href="#Old-version"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">RData</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples_vcf</span><span class="p">,</span> <span class="n">tfam</span><span class="p">):</span>
        <span class="c1"># tfam.samples: a dict of {sid:[fid, pid, mid, sex, trait], ...}</span>
        <span class="c1"># tfam.families: a dict of {fid:[s1, s2 ...], ...}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tfam</span> <span class="o">=</span> <span class="n">tfam</span>
        <span class="c1"># samples have to be in both vcf and tfam data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">tfam</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">samples_vcf</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tfam</span><span class="o">.</span><span class="n">samples</span><span class="p">])</span>
        <span class="c1"># a dict of {fid:[member names], ...}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">families</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="p">:</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tfam</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tfam</span><span class="o">.</span><span class="n">families</span><span class="p">}</span>
        <span class="c1"># a dict of {fid:[idx ...], ...}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">famsampidx</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># a dict of {fid:[maf1, maf2 ...]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maf</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="c1"># reorder family samples based on order of VCF file</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># skip families having no samples in VCF file</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">famsampidx</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">samples_vcf</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
        <span class="c1"># a dict of {fid:[idx ...], ...}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">famvaridx</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gss</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#test line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variants</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">families</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">famvaridx</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maf</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="c1"># superMarkerCount is the max num. of recombinant fragments among all fams</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">superMarkerCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gss</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#test line</span>

    <span class="k">def</span> <span class="nf">getMidPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variants</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variants</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variants</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getFamVariants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fam</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variants</span><span class="p">)</span> <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">famvaridx</span><span class="p">[</span><span class="n">fam</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;map&quot;</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">mafs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">famvaridx</span><span class="p">[</span><span class="n">fam</span><span class="p">]:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;V</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variants</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variants</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">mafs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variants</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">names</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">mafs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown style &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getFamSamples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fam</span><span class="p">):</span>
        <span class="n">nvar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variants</span><span class="p">)</span> <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">famvaridx</span><span class="p">[</span><span class="n">fam</span><span class="p">]])</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[[]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">fam</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">sort_family</span><span class="p">(</span><span class="n">fam</span><span class="p">)):</span>
            <span class="c1"># sample info, first 5 columns of ped</span>
            <span class="n">output</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">item</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># sample genotypes</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">:</span>
                <span class="n">output</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;00&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">nvar</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Old-maker">Old maker<a class="anchor-link" href="#Old-maker"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RegionExtractor" class="doc_header"><code>class</code> <code>RegionExtractor</code><a href="https://github.com/changebio/SEQLinkage/tree/master/SEQLinkage/Core.py#L145" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RegionExtractor</code>(<strong><code>filename</code></strong>, <strong><code>build</code></strong>=<em><code>'hg38'</code></em>, <strong><code>chr_prefix</code></strong>=<em><code>None</code></em>, <strong><code>allele_freq_info</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Extract given genomic region from VCF
converting genotypes into dictionary of
genotype list</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MarkerMaker" class="doc_header"><code>class</code> <code>MarkerMaker</code><a href="https://github.com/changebio/SEQLinkage/tree/master/SEQLinkage/Core.py#L226" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MarkerMaker</code>(<strong><code>wsize</code></strong>, <strong><code>maf_cutoff</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="LinkageWriter" class="doc_header"><code>class</code> <code>LinkageWriter</code><a href="https://github.com/changebio/SEQLinkage/tree/master/SEQLinkage/Core.py#L496" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>LinkageWriter</code>(<strong><code>num_missing_append</code></strong>=<em><code>0</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="EncoderWorker" class="doc_header"><code>class</code> <code>EncoderWorker</code><a href="https://github.com/changebio/SEQLinkage/tree/master/SEQLinkage/Core.py#L583" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>EncoderWorker</code>(<strong><code>queue</code></strong>, <strong><code>length</code></strong>, <strong><code>data</code></strong>, <strong><code>extractor</code></strong>, <strong><code>coder</code></strong>, <strong><code>writer</code></strong>) :: <code>Process</code></p>
</blockquote>
<p>Process objects represent activity that is run in a separate process</p>
<p>The class is analogous to <code>threading.Thread</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Main-function">Main function<a class="anchor-link" href="#Main-function"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">checkParams</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: Binary trait detected in [/mnt/mfs/statgen/yin/Github/linkage/SEQpy3/data/mwe_normal_fam.csv]</span>
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">args</span><span class="o">.</span><span class="n">freq</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;AF&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">no_save</span><span class="p">:</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="n">NoCache</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
<span class="n">cache</span><span class="o">.</span><span class="n">setID</span><span class="p">(</span><span class="s1">&#39;vcf&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">vanilla</span> <span class="ow">and</span> <span class="n">cache</span><span class="o">.</span><span class="n">check</span><span class="p">():</span>
    <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Loading regional marker data from archive ...&#39;</span><span class="p">)</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">target_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CACHE&#39;</span><span class="p">])</span>
    <span class="n">env</span><span class="o">.</span><span class="n">success_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">fileLinesCount</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/*.tped&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">))))</span>
    <span class="n">env</span><span class="o">.</span><span class="n">batch</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># load VCF file header</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">RData</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">vcf</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">tfam</span><span class="p">)</span>
    <span class="n">vs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">vs</span>
    <span class="n">samples_vcf</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">samples_vcf</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples_vcf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Fail to extract samples from [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">vcf</span><span class="p">),</span> <span class="n">exit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> samples found in [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples_vcf</span><span class="p">),</span> <span class="n">args</span><span class="o">.</span><span class="n">vcf</span><span class="p">))</span>
<span class="n">samples_not_vcf</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">samples_not_vcf</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 7 samples found in FAM file but not in VCF file:
1036_2, 22_1_10, 22_1_20, 28_9_186, 1036_1, 28_9_100, 28_9_101</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 3,461 samples in VCF file will be ignored due to absence in FAM file</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 3,479 samples found in [/mnt/mfs/statgen/yin/Github/linkage/SEQpy3/data/first1000snp_full_samples.vcf.gz]</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">samples_not_vcf</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">samples_vcf</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(7, 3479)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No valid family to process. &#39;</span> \
              <span class="s1">&#39;Families have to be at least trio with at least one member in VCF file.&#39;</span><span class="p">,</span> <span class="n">exit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No valid sample to process. &#39;</span> \
              <span class="s1">&#39;Samples have to be in families, and present in both TFAM and VCF files.&#39;</span><span class="p">,</span> <span class="n">exit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">rewriteFamfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.tfam&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">)),</span>
               <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="n">samples_not_vcf</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">single_markers</span><span class="p">:</span>
    <span class="n">regions</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vs</span><span class="o">.</span><span class="n">GetGenomeCoordinates</span><span class="p">():</span>
        <span class="n">region_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">region_info</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
            <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region_info</span><span class="p">)</span>
    <span class="n">args</span><span class="o">.</span><span class="n">blueprint</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># load blueprint</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">blueprint</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">regions</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Cannot load regional marker blueprint [</span><span class="si">{}</span><span class="s2">]. &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">blueprint</span><span class="p">),</span> <span class="n">exit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> families with a total of </span><span class="si">{:,d}</span><span class="s1"> samples will be scanned for </span><span class="si">{:,d}</span><span class="s1"> pre-defined units&#39;</span><span class="o">.</span>\
        <span class="nb">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">)))</span>
<span class="n">env</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">jobs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">regions</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">env</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span>
<span class="n">queue</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">jobs</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">Queue</span><span class="p">()</span>  
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 3 families with a total of 18 samples will be scanned for 28,325 pre-defined units</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Testing">Testing<a class="anchor-link" href="#Testing"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">extractor</span> <span class="o">=</span><span class="n">RegionExtractor</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">vcf</span><span class="p">,</span> <span class="n">chr_prefix</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">chr_prefix</span><span class="p">,</span> <span class="n">allele_freq_info</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>
<span class="n">maker</span> <span class="o">=</span>            <span class="n">MarkerMaker</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">bin</span><span class="p">,</span> <span class="n">maf_cutoff</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">maf_cutoff</span><span class="p">)</span>
<span class="n">writer</span> <span class="o">=</span>             <span class="n">LinkageWriter</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples_not_vcf</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">regions</span><span class="p">[:</span><span class="mi">20</span><span class="p">]):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#for region in rg:</span>
    <span class="n">extractor</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
    <span class="n">maker</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
    <span class="n">isSuccess</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">[</span><span class="n">extractor</span><span class="p">,</span> <span class="n">maker</span><span class="p">,</span> <span class="n">writer</span><span class="p">]:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1">#print(data,data.genotype_all)</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                <span class="c1"># previous module failed</span>
                <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">null_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                <span class="n">env</span><span class="o">.</span><span class="n">null_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">trivial_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
                <span class="n">env</span><span class="o">.</span><span class="n">trivial_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">isSuccess</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">isSuccess</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">success_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
            <span class="n">env</span><span class="o">.</span><span class="n">success_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">j</span><span class="o">%</span><span class="k">1000</span>==0:
        <span class="nb">print</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variants</span><span class="p">),</span><span class="n">region</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>in Haplotype
running family 1036
running family Estimating allele frequencies... [using maximum likelihood]0
   V8-13273 V12-13302 V17-13417 V22-13687 

V8-13273: 0 0.707106 0.292894 
total familyCount:1
V12-13302: 0 0.75 0.25 
total familyCount:1
V17-13417: 0 0.75 0.25 
total familyCount:1
V22-13687: 0 0.75 0.25 
total familyCount:1
22_1
running family 28_9
Estimating allele frequencies... [using maximum likelihood]0
   V8-13273 V15-13380 V17-13417 

V8-13273: 0 0.744757 0.255243 
total familyCount:1
V15-13380: 0 0.744757 0.255243 
total familyCount:1
V17-13417: 0 0.744757 0.255243 
total familyCount:1
0 3 25 [&#39;1&#39;, &#39;11868&#39;, &#39;14362&#39;, &#39;LOC102725121@1&#39;, &#39;9.177127474362311e-07&#39;, &#39;1.1657192989882668e-06&#39;, &#39;6.814189157634088e-07&#39;]
in Haplotype
running family 1036
running familyEstimating allele frequencies... [using maximum likelihood]0
   V8-13273 V12-13302 V17-13417 V22-13687 

V8-13273: 0 0.707106 0.292894 
total familyCount:1
 22_1
running familyV12-13302: 0 0.75 0.25 
total familyCount:1
V17-13417: 0 0.75 0.25 
total familyCount:1
V22-13687: 0 0.75 0.25 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0
   V8-13273 V15-13380 V17-13417 

V8-13273: 0 0.744757 0.255243 
total familyCount:1
V15-13380: 0 0.744757 0.255243 
total familyCount:1
V17-13417: 0 0.744757 0.255243 
total familyCount:1
 28_9
in Haplotype
running family 1036
running family 22_1
running family 28_9
in Haplotype
running family 1036
Estimating allele frequencies... [using maximum likelihood]0
   V3-14464 V8-14653 V18-14907 V19-14930 V20-14933 V40-16103 V50-16378 
   V55-16487 V69-17147 V79-17358 V85-17385 V89-17407 V124-17697 V151-17928 
   V152-17929 V159-20184 V160-20191 V162-20212 V165-20227 V169-20235 
   V171-20250 V178-20316 V180-20485 V182-20522 V184-20547 V194-29368 

V3-14464: 0 0.75 0.25 
total familyCount:1
V8-14653: 0 0.75 0.25 
total familyCount:1
V18-14907: 0 0.5 0.5 
total familyCount:1
V19-14930: 0 0.5 0.5 
total familyCount:1
V20-14933: 0 1 
total familyCount:1
V40-16103: 0 0.707106 0.292894 
total familyCount:1
V50-16378: 0 0.5 0.5 
total familyCount:1
V55-16487: 0 0.75 0.25 
total familyCount:1
running family V69-17147: 0 0.5 0.5 
total familyCount:1
V79-17358: 0 1 
total familyCount:1
V85-17385: 0 1 
total familyCount:1
V89-17407: 0 0.5 0.5 
total familyCount:1
V124-17697: 0 0.5 0.5 
total familyCount:1
V151-17928: 0 0.5 0.5 
total familyCount:1
V152-17929: 0 0.5 0.5 
total familyCount:1
V159-20184: 0 0.5 0.5 
total familyCount:1
V160-20191: 0 1 
total familyCount:1
V162-20212: 0 1 
total familyCount:1
V165-20227: 0 1 
total familyCount:1
V169-20235: 0 1 
total familyCount:1
V171-20250: 0 1 
total familyCount:1
V178-20316: 0 1 
total familyCount:1
V180-20485: 0 1 
total familyCount:1
V182-20522: 0 1 
total familyCount:1
V184-20547: 0 0.75 0.25 
total familyCount:1
V194-29368: 0 1 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0
   V3-14464 V8-14653 V10-14677 V18-14907 V19-14930 V40-16103 V50-16378 
   V55-16487 V69-17147 V80-17365 V85-17385 V86-17398 V89-17407 V95-17479 
   V108-17559 V112-17589 V124-17697 V129-17722 V131-17746 V142-17829 
   V155-19190 V1522_1
running family9-20184 V160-20191 V162-20212 V165-20227 V169-20235 
   V171-20250 V178-20316 V184-20547 

V3-14464: 0 0.739454 0.260546 
total familyCount:1
V8-14653: 0 0.707103 0.292897 
total familyCount:1
V10-14677: 0 0.739454 0.260546 
total familyCount:1
V18-14907: 0 0.707103 0.292897 
total familyCount:1
V19-14930: 0 0.728713 0.271287 
total familyCount:1
V40-16103: 0 0.5 0.5 
total familyCount:1
V50-16378: 0 0.5 0.5 
total familyCount:1
V55-16487: 0 0.744757 0.255243 
total familyCount:1
V69-17147: 0 0.744757 0.255243 
total familyCount:1
V80-17365: 0 0.744757 0.255243 
total familyCount:1
V85-17385: 0 0.739454 0.260546 
total familyCount:1
V86-17398: 0 0.744757 0.255243 
total familyCount:1
V89-17407: 0 0.744757 0.255243 
total familyCount:1
V95-17479: 0 0.744757 0.255243 
total familyCount:1
V108-17559: 0 0.744757 0.255243 
total familyCount:1
V112-17589: 0 0.744757 0.255243 
total familyCount:1
V124-17697: 0 0.739454 0.260546 
total familyCount:1
V129-17722: 0 0.744757 0.255243 
total famil 28_9
yCount:1
V131-17746: 0 0.739454 0.260546 
total familyCount:1
V142-17829: 0 0.744757 0.255243 
total familyCount:1
V155-19190: 0 0.739454 0.260546 
total familyCount:1
V159-20184: 0 0.744757 0.255243 
total familyCount:1
V160-20191: 0 0.744757 0.255243 
total familyCount:1
V162-20212: 0 0.744757 0.255243 
total familyCount:1
V165-20227: 0 0.744757 0.255243 
total familyCount:1
V169-20235: 0 0.744757 0.255243 
total familyCount:1
V171-20250: 0 0.739454 0.260546 
total familyCount:1
V178-20316: 0 0.739454 0.260546 
total familyCount:1
V184-20547: 0 0.739454 0.260546 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0
   V3-14464 V5-14470 V8-14653 V10-14677 V18-14907 V19-14930 V34-16068 
   V40-16103 V50-16378 V84-17379 V85-17385 V90-17408 V105-17519 V107-17556 
   V116-17614 V155-19190 V158-20166 V160-20191 V162-20212 V165-20227 
   V166-20227 V168-20231 V169-20235 V171-20250 V174-20254 V178-20316 
   V183-20545 V184-20547 V194-29368 

V3-14464: 0 0.646634 0.353366 
total familyCount:1
V5-14470: 0 0.824706 0.175294 
total familyCount:1
V8-14653: 0 0.452863 0.547137 
total familyCount:1
V10-14677: 0 0.656432 0.343568 
total familyCount:1
V18-14907: 0 0.5 0.5 
total familyCount:1
V19-14930: 0 0.628665 0.371335 
total familyCount:1
V34-16068: 0 0.5 0.5 
total familyCount:1
V40-16103: 0 0.628667 0.371333 
total familyCount:1
V50-16378: 0 0.617751 0.382249 
total familyCount:1
V84-17379: 0 0.824706 0.175294 
total familyCount:1
V85-17385: 0 0.5 0.5 
total familyCount:1
V90-17408: 0 0.824706 0.175294 
total familyCount:1
V105-17519: 0 0.824706 0.175294 
total familyCount:1
V107-17556: 0 0.820231 0.179769 
total familyCount:1
V116-17614: 0 0.824706 0.175294 
total familyCount:1
V155-19190: 0 0.6 0.4 
total familyCount:1
V158-20166: 0 0.628665 0.371335 
total familyCount:1
V160-20191: 0 0.628665 0.371335 
total familyCount:1
V162-20212: 0 0.628665 0.371335 
total familyCount:1
V165-20227: 0 0.656432 0.343568 
total familyCount:1
V166-20227: 0 0.646634 0.353366 
total familyCount:1
V168-20231: 0 0.811255 0.188745 
total familyCount:1
V169-20235: 0 0.824706 0.175294 
total familyCount:1
V171-20250: 0 0.628665 0.371335 
total familyCount:1
V174-20254: 0 0.824706 0.175294 
total familyCount:1
V178-20316: 0 0.628665 0.371335 
total familyCount:1
V183-20545: 0 0.820231 0.179769 
total familyCount:1
V184-20547: 0 0.617751 0.382249 
total familyCount:1
V194-29368: 0 0.656432 0.343568 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0          
   V4-17385 V8-17407 

V4-17385: 0 1 
total familyCount:1
V8-17407: 0 0.5 0.5 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0
   V4-17385 V5-17398 V8-17407 

V4-17385: 0 0.739454 0.260546 
total familyCount:1
V5-17398: 0 0.744757 0.255243 
total familyCount:1
V8-17407: 0 0.744757 0.255243 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0
   V3-17379 V4-17385 V9-17408 

V3-17379: 0 0.824706 0.175294 
total familyCount:1
V4-17385: 0 0.5 0.5 
total familyCount:1
V9-17408: 0 0.824706 0.175294 
total familyCount:1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">dtest</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dict_keys([&#39;LOC102725121@1&#39;, &#39;DDX11L1&#39;, &#39;WASH7P&#39;, &#39;MIR6859-1@1,MIR6859-2@1,MIR6859-3@1,MIR6859-4@1&#39;, &#39;MIR1302-10@1,MIR1302-11@1,MIR1302-2@1,MIR1302-9@1&#39;, &#39;FAM138A@1,FAM138C@1,FAM138F@1&#39;, &#39;OR4F5&#39;, &#39;LOC729737&#39;, &#39;LOC100132062@1,LOC100132287@1&#39;, &#39;OR4F16@1,OR4F29@1,OR4F3@1&#39;, &#39;LOC101928626&#39;, &#39;MIR12136&#39;, &#39;OR4F16@2,OR4F29@2,OR4F3@2&#39;, &#39;LOC100133331&#39;, &#39;LOC100288069&#39;, &#39;FAM87B&#39;, &#39;LINC00115&#39;, &#39;LINC01128&#39;, &#39;FAM41C&#39;, &#39;LINC02593&#39;])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">dtest</span><span class="p">[</span><span class="s1">&#39;LOC102725121@1&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>OrderedDict([(&#39;dregions&#39;,
              [[&#39;1&#39;,
                &#39;11868&#39;,
                &#39;14362&#39;,
                &#39;LOC102725121@1&#39;,
                &#39;9.177127474362311e-07&#39;,
                &#39;1.1657192989882668e-06&#39;,
                &#39;6.814189157634088e-07&#39;]]),
             (&#39;dvariants&#39;,
              [[[&#39;1&#39;, 13035, &#39;LOC102725121@1&#39;, 0.0002],
                [&#39;1&#39;, 13053, &#39;LOC102725121@1&#39;, 0.0004],
                [&#39;1&#39;, 13080, &#39;LOC102725121@1&#39;, 1e-05],
                [&#39;1&#39;, 13115, &#39;LOC102725121@1&#39;, 1e-05],
                [&#39;1&#39;, 13151, &#39;LOC102725121@1&#39;, 0.0001],
                [&#39;1&#39;, 13169, &#39;LOC102725121@1&#39;, 0.0001],
                [&#39;1&#39;, 13244, &#39;LOC102725121@1&#39;, 0.0002],
                [&#39;1&#39;, 13248, &#39;LOC102725121@1&#39;, 0.0006],
                [&#39;1&#39;, 13273, &#39;LOC102725121@1&#39;, 0.1548],
                [&#39;1&#39;, 13289, &#39;LOC102725121@1&#39;, 0.0029],
                [&#39;1&#39;, 13298, &#39;LOC102725121@1&#39;, 2.531e-05],
                [&#39;1&#39;, 13302, &#39;LOC102725121@1&#39;, 0.0103],
                [&#39;1&#39;, 13302, &#39;LOC102725121@1&#39;, 9.451e-05],
                [&#39;1&#39;, 13303, &#39;LOC102725121@1&#39;, 0.0002],
                [&#39;1&#39;, 13379, &#39;LOC102725121@1&#39;, 7.851e-05],
                [&#39;1&#39;, 13380, &#39;LOC102725121@1&#39;, 0.0088],
                [&#39;1&#39;, 13393, &#39;LOC102725121@1&#39;, 0.0002],
                [&#39;1&#39;, 13417, &#39;LOC102725121@1&#39;, 0.1197],
                [&#39;1&#39;, 13453, &#39;LOC102725121@1&#39;, 0.0003],
                [&#39;1&#39;, 13494, &#39;LOC102725121@1&#39;, 0.0015],
                [&#39;1&#39;, 13504, &#39;LOC102725121@1&#39;, 0.0026],
                [&#39;1&#39;, 13687, &#39;LOC102725121@1&#39;, 0.0049],
                [&#39;1&#39;, 13687, &#39;LOC102725121@1&#39;, 0.0001],
                [&#39;1&#39;, 14159, &#39;LOC102725121@1&#39;, 0.0021],
                [&#39;1&#39;, 14345, &#39;LOC102725121@1&#39;, 0.0001]]]),
             (&#39;dfamvaridx&#39;,
              [{&#39;1036&#39;: [8, 12, 17, 22], &#39;22_1&#39;: [8, 15, 17], &#39;28_9&#39;: []}]),
             (&#39;dgeno&#39;,
              [{&#39;28_9_103&#39;: [],
                &#39;28_9_106&#39;: [],
                &#39;28_9_108&#39;: [],
                &#39;28_9_109&#39;: [],
                &#39;28_9_111&#39;: [],
                &#39;28_9_105&#39;: [],
                &#39;28_9_114&#39;: [],
                &#39;28_9_110&#39;: [],
                &#39;1036_5&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;],
                &#39;1036_99&#39;: [&#39;12&#39;, &#39;11&#39;, &#39;12&#39;, &#39;11&#39;],
                &#39;1036_6&#39;: [&#39;00&#39;, &#39;00&#39;, &#39;11&#39;, &#39;12&#39;],
                &#39;1036_4&#39;: [&#39;11&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;],
                &#39;1036_3&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;],
                &#39;22_1_2&#39;: [&#39;11&#39;, &#39;12&#39;, &#39;11&#39;],
                &#39;22_1_3&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;],
                &#39;22_1_4&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;],
                &#39;22_1_5&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;],
                &#39;22_1_99&#39;: [&#39;12&#39;, &#39;11&#39;, &#39;12&#39;]}]),
             (&#39;gss&#39;,
              [{0: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                1: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                2: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                3: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                4: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                5: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                6: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                7: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                8: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                9: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                10: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                11: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                12: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                13: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                14: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                15: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                16: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                17: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                18: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                19: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                20: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                21: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                22: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                23: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)},
                24: {&#39;1036&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;22_1&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;),
                 &#39;28_9&#39;: (&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;)}}]),
             (&#39;hapimp&#39;,
              {&#39;1036&#39;: [&#39;1036&#39;,
                [&#39;V8-13273&#39;, &#39;V12-13302&#39;, &#39;V17-13417&#39;, &#39;V22-13687&#39;],
                [13273, 13302, 13417, 13687],
                [0.1548, 9.451e-05, 0.1197, 0.0001],
                ((&#39;1036&#39;, &#39;1036_1&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;),
                 (&#39;1036&#39;, &#39;1036_1&#39;, &#39;?:&#39;, &#39;?:&#39;, &#39;?:&#39;, &#39;?:&#39;),
                 (&#39;1036&#39;, &#39;1036_2&#39;, &#39;2:&#39;, &#39;1:&#39;, &#39;2:&#39;, &#39;1:&#39;),
                 (&#39;1036&#39;, &#39;1036_2&#39;, &#39;?:&#39;, &#39;?:&#39;, &#39;?:&#39;, &#39;?:&#39;),
                 (&#39;1036&#39;, &#39;1036_6&#39;, &#39;1:&#39;, &#39;2:&#39;, &#39;1:&#39;, &#39;1:&#39;),
                 (&#39;1036&#39;, &#39;1036_6&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2:&#39;),
                 (&#39;1036&#39;, &#39;1036_99&#39;, &#39;2:&#39;, &#39;1|&#39;, &#39;2|&#39;, &#39;1|&#39;),
                 (&#39;1036&#39;, &#39;1036_99&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;),
                 (&#39;1036&#39;, &#39;1036_5&#39;, &#39;2:&#39;, &#39;1|&#39;, &#39;2|&#39;, &#39;1|&#39;),
                 (&#39;1036&#39;, &#39;1036_5&#39;, &#39;1:&#39;, &#39;2|&#39;, &#39;1|&#39;, &#39;1|&#39;),
                 (&#39;1036&#39;, &#39;1036_4&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;),
                 (&#39;1036&#39;, &#39;1036_4&#39;, &#39;1:&#39;, &#39;2|&#39;, &#39;1|&#39;, &#39;1|&#39;),
                 (&#39;1036&#39;, &#39;1036_3&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1\\&#39;),
                 (&#39;1036&#39;, &#39;1036_3&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1\\&#39;))],
               &#39;22_1&#39;: [&#39;22_1&#39;,
                [&#39;V8-13273&#39;, &#39;V15-13380&#39;, &#39;V17-13417&#39;],
                [13273, 13380, 13417],
                [0.1548, 0.0088, 0.1197],
                ((&#39;22_1&#39;, &#39;22_1_10&#39;, &#39;2:&#39;, &#39;1:&#39;, &#39;2:&#39;),
                 (&#39;22_1&#39;, &#39;22_1_10&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;),
                 (&#39;22_1&#39;, &#39;22_1_20&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;),
                 (&#39;22_1&#39;, &#39;22_1_20&#39;, &#39;1:&#39;, &#39;2:&#39;, &#39;1:&#39;),
                 (&#39;22_1&#39;, &#39;22_1_99&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;),
                 (&#39;22_1&#39;, &#39;22_1_99&#39;, &#39;2:&#39;, &#39;1|&#39;, &#39;2|&#39;),
                 (&#39;22_1&#39;, &#39;22_1_5&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;),
                 (&#39;22_1&#39;, &#39;22_1_5&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;),
                 (&#39;22_1&#39;, &#39;22_1_4&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;),
                 (&#39;22_1&#39;, &#39;22_1_4&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;),
                 (&#39;22_1&#39;, &#39;22_1_3&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;),
                 (&#39;22_1&#39;, &#39;22_1_3&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;),
                 (&#39;22_1&#39;, &#39;22_1_2&#39;, &#39;1:&#39;, &#39;2|&#39;, &#39;1|&#39;),
                 (&#39;22_1&#39;, &#39;22_1_2&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;))],
               &#39;28_9&#39;: [&#39;28_9&#39;,
                [],
                [],
                [],
                {&#39;V8-13273&#39;: 0.1548,
                 &#39;V12-13302&#39;: 9.451e-05,
                 &#39;V17-13417&#39;: 0.1197,
                 &#39;V22-13687&#39;: 0.0001,
                 &#39;V15-13380&#39;: 0.0088}]}),
             (&#39;ld&#39;, []),
             (&#39;coder&#39;,
              {&#39;input&#39;: [{&#39;28_9_103&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_106&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_108&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_109&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_111&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_105&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_114&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_110&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;1036_5&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;],
                 &#39;1036_99&#39;: [&#39;12&#39;, &#39;11&#39;, &#39;12&#39;, &#39;11&#39;],
                 &#39;1036_6&#39;: [&#39;00&#39;, &#39;00&#39;, &#39;11&#39;, &#39;12&#39;],
                 &#39;1036_4&#39;: [&#39;11&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;],
                 &#39;1036_3&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;],
                 &#39;22_1_2&#39;: [&#39;11&#39;, &#39;12&#39;, &#39;11&#39;],
                 &#39;22_1_3&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;],
                 &#39;22_1_4&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;],
                 &#39;22_1_5&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;],
                 &#39;22_1_99&#39;: [&#39;12&#39;, &#39;11&#39;, &#39;12&#39;]},
                OrderedDict([(&#39;1036&#39;,
                              [[&#39;1036&#39;, &#39;1036_1&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;],
                               [&#39;1036&#39;, &#39;1036_1&#39;, &#39;?:&#39;, &#39;?:&#39;, &#39;?:&#39;, &#39;?:&#39;],
                               [&#39;1036&#39;, &#39;1036_2&#39;, &#39;2:&#39;, &#39;1:&#39;, &#39;2:&#39;, &#39;1:&#39;],
                               [&#39;1036&#39;, &#39;1036_2&#39;, &#39;?:&#39;, &#39;?:&#39;, &#39;?:&#39;, &#39;?:&#39;],
                               [&#39;1036&#39;, &#39;1036_6&#39;, &#39;1:&#39;, &#39;2:&#39;, &#39;1:&#39;, &#39;1:&#39;],
                               [&#39;1036&#39;, &#39;1036_6&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2:&#39;],
                               [&#39;1036&#39;, &#39;1036_99&#39;, &#39;2:&#39;, &#39;1|&#39;, &#39;2|&#39;, &#39;1|&#39;],
                               [&#39;1036&#39;, &#39;1036_99&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;],
                               [&#39;1036&#39;, &#39;1036_5&#39;, &#39;2:&#39;, &#39;1|&#39;, &#39;2|&#39;, &#39;1|&#39;],
                               [&#39;1036&#39;, &#39;1036_5&#39;, &#39;1:&#39;, &#39;2|&#39;, &#39;1|&#39;, &#39;1|&#39;],
                               [&#39;1036&#39;, &#39;1036_4&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;],
                               [&#39;1036&#39;, &#39;1036_4&#39;, &#39;1:&#39;, &#39;2|&#39;, &#39;1|&#39;, &#39;1|&#39;],
                               [&#39;1036&#39;, &#39;1036_3&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1\\&#39;],
                               [&#39;1036&#39;, &#39;1036_3&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1\\&#39;]]),
                             (&#39;22_1&#39;,
                              [[&#39;22_1&#39;, &#39;22_1_10&#39;, &#39;2:&#39;, &#39;1:&#39;, &#39;2:&#39;],
                               [&#39;22_1&#39;, &#39;22_1_10&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;],
                               [&#39;22_1&#39;, &#39;22_1_20&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;],
                               [&#39;22_1&#39;, &#39;22_1_20&#39;, &#39;1:&#39;, &#39;2:&#39;, &#39;1:&#39;],
                               [&#39;22_1&#39;, &#39;22_1_99&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;],
                               [&#39;22_1&#39;, &#39;22_1_99&#39;, &#39;2:&#39;, &#39;1|&#39;, &#39;2|&#39;],
                               [&#39;22_1&#39;, &#39;22_1_5&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;],
                               [&#39;22_1&#39;, &#39;22_1_5&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;],
                               [&#39;22_1&#39;, &#39;22_1_4&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;],
                               [&#39;22_1&#39;, &#39;22_1_4&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;],
                               [&#39;22_1&#39;, &#39;22_1_3&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;],
                               [&#39;22_1&#39;, &#39;22_1_3&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;],
                               [&#39;22_1&#39;, &#39;22_1_2&#39;, &#39;1:&#39;, &#39;2|&#39;, &#39;1|&#39;],
                               [&#39;22_1&#39;, &#39;22_1_2&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;]])]),
                {&#39;V8-13273&#39;: 0.1548,
                 &#39;V12-13302&#39;: 9.451e-05,
                 &#39;V17-13417&#39;: 0.1197,
                 &#39;V22-13687&#39;: 0.0001,
                 &#39;V15-13380&#39;: 0.0088},
                {&#39;1036&#39;: [&#39;V8-13273&#39;, &#39;V12-13302&#39;, &#39;V17-13417&#39;, &#39;V22-13687&#39;],
                 &#39;22_1&#39;: [&#39;V8-13273&#39;, &#39;V15-13380&#39;, &#39;V17-13417&#39;],
                 &#39;28_9&#39;: []},
                []],
               &#39;output&#39;: [((&#39;1036&#39;,
                  &#39;1036_1&#39;,
                  &#39;1,1&#39;,
                  &#39;111,1&#39;,
                  &#39;0,0&#39;,
                  &#39;NULL,NULL&#39;),
                 (&#39;1036&#39;, &#39;1036_2&#39;, &#39;3,1&#39;, &#39;212,1&#39;, &#39;0,0&#39;, &#39;NULL,NULL&#39;),
                 (&#39;1036&#39;, &#39;1036_6&#39;, &#39;2,1&#39;, &#39;121,1&#39;, &#39;1,2&#39;, &#39;111,2&#39;),
                 (&#39;1036&#39;, &#39;1036_99&#39;, &#39;3,1&#39;, &#39;212,1&#39;, &#39;1,1&#39;, &#39;111,1&#39;),
                 (&#39;1036&#39;, &#39;1036_5&#39;, &#39;3,1&#39;, &#39;212,1&#39;, &#39;2,1&#39;, &#39;121,1&#39;),
                 (&#39;1036&#39;, &#39;1036_4&#39;, &#39;1,1&#39;, &#39;111,1&#39;, &#39;2,1&#39;, &#39;121,1&#39;),
                 (&#39;1036&#39;, &#39;1036_3&#39;, &#39;1,1&#39;, &#39;111,1&#39;, &#39;1,1&#39;, &#39;111,1&#39;),
                 (&#39;22_1&#39;, &#39;22_1_10&#39;, &#39;3&#39;, &#39;212&#39;, &#39;1&#39;, &#39;111&#39;),
                 (&#39;22_1&#39;, &#39;22_1_20&#39;, &#39;1&#39;, &#39;111&#39;, &#39;2&#39;, &#39;121&#39;),
                 (&#39;22_1&#39;, &#39;22_1_99&#39;, &#39;1&#39;, &#39;111&#39;, &#39;3&#39;, &#39;212&#39;),
                 (&#39;22_1&#39;, &#39;22_1_5&#39;, &#39;1&#39;, &#39;111&#39;, &#39;1&#39;, &#39;111&#39;),
                 (&#39;22_1&#39;, &#39;22_1_4&#39;, &#39;1&#39;, &#39;111&#39;, &#39;1&#39;, &#39;111&#39;),
                 (&#39;22_1&#39;, &#39;22_1_3&#39;, &#39;1&#39;, &#39;111&#39;, &#39;1&#39;, &#39;111&#39;),
                 (&#39;22_1&#39;, &#39;22_1_2&#39;, &#39;2&#39;, &#39;121&#39;, &#39;1&#39;, &#39;111&#39;)),
                {&#39;28_9_103&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_106&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_108&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_109&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_111&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_105&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_114&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;28_9_110&#39;: (&#39;0&#39;, &#39;0&#39;),
                 &#39;1036_5&#39;: ([&#39;3&#39;, &#39;1&#39;], [&#39;2&#39;, &#39;1&#39;]),
                 &#39;1036_99&#39;: ([&#39;3&#39;, &#39;1&#39;], [&#39;1&#39;, &#39;1&#39;]),
                 &#39;1036_6&#39;: ([&#39;2&#39;, &#39;1&#39;], [&#39;1&#39;, &#39;2&#39;]),
                 &#39;1036_4&#39;: ([&#39;1&#39;, &#39;1&#39;], [&#39;2&#39;, &#39;1&#39;]),
                 &#39;1036_3&#39;: ([&#39;1&#39;, &#39;1&#39;], [&#39;1&#39;, &#39;1&#39;]),
                 &#39;22_1_2&#39;: ([&#39;2&#39;], [&#39;1&#39;]),
                 &#39;22_1_3&#39;: ([&#39;1&#39;], [&#39;1&#39;]),
                 &#39;22_1_4&#39;: ([&#39;1&#39;], [&#39;1&#39;]),
                 &#39;22_1_5&#39;: ([&#39;1&#39;], [&#39;1&#39;]),
                 &#39;22_1_99&#39;: ([&#39;1&#39;], [&#39;3&#39;]),
                 &#39;1036_1&#39;: ([&#39;1&#39;, &#39;1&#39;], [&#39;0&#39;, &#39;0&#39;]),
                 &#39;1036_2&#39;: ([&#39;3&#39;, &#39;1&#39;], [&#39;0&#39;, &#39;0&#39;]),
                 &#39;22_1_10&#39;: ([&#39;3&#39;], [&#39;1&#39;]),
                 &#39;22_1_20&#39;: ([&#39;1&#39;], [&#39;2&#39;])},
                2,
                OrderedDict([(&#39;1036&#39;,
                              ((0.9756108487483803,
                                9.22136964316592e-05,
                                0.02429693755518805),
                               (0.9999, 0.0001))),
                             (&#39;22_1&#39;,
                              ((0.9673214995311192,
                                0.008588003627798477,
                                0.02409049684108229),))])]}),
             (&#39;format&#39;,
              {&#39;28_9_103&#39;: [(&#39;0&#39;, &#39;0&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;28_9_106&#39;: [(&#39;0&#39;, &#39;0&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;28_9_108&#39;: [(&#39;0&#39;, &#39;0&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;28_9_109&#39;: [(&#39;0&#39;, &#39;0&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;28_9_111&#39;: [(&#39;0&#39;, &#39;0&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;28_9_105&#39;: [(&#39;0&#39;, &#39;0&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;28_9_114&#39;: [(&#39;0&#39;, &#39;0&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;28_9_110&#39;: [(&#39;0&#39;, &#39;0&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;1036_5&#39;: [(&#39;3&#39;, &#39;2&#39;), (&#39;1&#39;, &#39;1&#39;)],
               &#39;1036_99&#39;: [(&#39;3&#39;, &#39;1&#39;), (&#39;1&#39;, &#39;1&#39;)],
               &#39;1036_6&#39;: [(&#39;2&#39;, &#39;1&#39;), (&#39;1&#39;, &#39;2&#39;)],
               &#39;1036_4&#39;: [(&#39;1&#39;, &#39;2&#39;), (&#39;1&#39;, &#39;1&#39;)],
               &#39;1036_3&#39;: [(&#39;1&#39;, &#39;1&#39;), (&#39;1&#39;, &#39;1&#39;)],
               &#39;22_1_2&#39;: [(&#39;2&#39;, &#39;1&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;22_1_3&#39;: [(&#39;1&#39;, &#39;1&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;22_1_4&#39;: [(&#39;1&#39;, &#39;1&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;22_1_5&#39;: [(&#39;1&#39;, &#39;1&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;22_1_99&#39;: [(&#39;1&#39;, &#39;3&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;1036_1&#39;: [(&#39;1&#39;, &#39;0&#39;), (&#39;1&#39;, &#39;0&#39;)],
               &#39;1036_2&#39;: [(&#39;3&#39;, &#39;0&#39;), (&#39;1&#39;, &#39;0&#39;)],
               &#39;22_1_10&#39;: [(&#39;3&#39;, &#39;1&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;22_1_20&#39;: [(&#39;1&#39;, &#39;2&#39;), (&#39;0&#39;, &#39;0&#39;)]})])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a1</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">env</span><span class="o">.</span><span class="n">dtest</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;MC1R&#39;</span><span class="p">,</span><span class="s1">&#39;PAPPA2&#39;</span><span class="p">]}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;dtestpy3_fixedcoder.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

<span class="c1">#with open(&#39;dtestpy3_fixedcoder.pickle&#39;, &#39;rb&#39;) as handle:</span>
<span class="c1">#    b = pickle.load(handle)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">env</span><span class="o">.</span><span class="n">dtest</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;MC1R&#39;</span><span class="p">,</span><span class="s1">&#39;PAPPA2&#39;</span><span class="p">]}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;dtestpy3.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

<span class="c1">#with open(&#39;dtestpy3.pickle&#39;, &#39;rb&#39;) as handle:</span>
<span class="c1">#    b = pickle.load(handle)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;MC1R&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>OrderedDict([(&#39;dregions&#39;,
              [[&#39;16&#39;,
                &#39;89984286&#39;,
                &#39;89987385&#39;,
                &#39;MC1R&#39;,
                &#39;133.689089888&#39;,
                &#39;159.050776809&#39;,
                &#39;111.195245154&#39;]]),
             (&#39;dvariants&#39;,
              [[[&#39;16&#39;, 89984370, &#39;MC1R&#39;, 0.00015],
                [&#39;16&#39;, 89984604, &#39;MC1R&#39;, 0.00015],
                [&#39;16&#39;, 89984739, &#39;MC1R&#39;, 0.00015],
                [&#39;16&#39;, 89985940, &#39;MC1R&#39;, 0.085784],
                [&#39;16&#39;, 89986608, &#39;MC1R&#39;, 0.107936],
                [&#39;16&#39;, 89986760, &#39;MC1R&#39;, 0.00015],
                [&#39;16&#39;, 89987201, &#39;MC1R&#39;, 0.00015]]]),
             (&#39;dfamvaridx&#39;,
              [{&#39;1&#39;: [0, 1, 2, 3, 4, 5, 6], &#39;2&#39;: [0, 1, 2, 3, 4, 5, 6]}]),
             (&#39;dgeno&#39;,
              [{&#39;II:2&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;],
                &#39;I:2&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;],
                &#39;I:1&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;],
                &#39;II:3&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;],
                &#39;II:4&#39;: [&#39;20&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;22&#39;],
                &#39;II:1&#39;: [&#39;22&#39;, &#39;22&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;22&#39;],
                &#39;II:B&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;],
                &#39;I:B&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;],
                &#39;I:A&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;22&#39;],
                &#39;II:C&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;],
                &#39;II:D&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;],
                &#39;II:A&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;]}]),
             (&#39;gss&#39;,
              [{0: {&#39;1&#39;: (&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;22&#39;, &#39;22&#39;),
                 &#39;2&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;22&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;)},
                1: {&#39;1&#39;: (&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;22&#39;, &#39;22&#39;),
                 &#39;2&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;22&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;)},
                2: {&#39;1&#39;: (&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;22&#39;, &#39;22&#39;),
                 &#39;2&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;22&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;)},
                3: {&#39;1&#39;: (&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;22&#39;, &#39;22&#39;),
                 &#39;2&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;22&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;)},
                4: {&#39;1&#39;: (&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;22&#39;, &#39;22&#39;),
                 &#39;2&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;22&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;)},
                5: {&#39;1&#39;: (&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;22&#39;, &#39;22&#39;),
                 &#39;2&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;22&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;)},
                6: {&#39;1&#39;: (&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;22&#39;, &#39;22&#39;),
                 &#39;2&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;22&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;)}}]),
             (&#39;hapimp&#39;,
              {&#39;1&#39;: [&#39;1&#39;,
                [&#39;V0-89984370&#39;,
                 &#39;V1-89984604&#39;,
                 &#39;V2-89984739&#39;,
                 &#39;V3-89985940&#39;,
                 &#39;V4-89986608&#39;,
                 &#39;V5-89986760&#39;,
                 &#39;V6-89987201&#39;],
                [89984370,
                 89984604,
                 89984739,
                 89985940,
                 89986608,
                 89986760,
                 89987201],
                [0.00015,
                 0.00015,
                 0.00015,
                 0.085784,
                 0.107936,
                 0.00015,
                 0.00015],
                ((&#39;1&#39;, &#39;I:1&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;),
                 (&#39;1&#39;, &#39;I:1&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2:&#39;),
                 (&#39;1&#39;, &#39;I:2&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2:&#39;, &#39;2:&#39;),
                 (&#39;1&#39;, &#39;I:2&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;),
                 (&#39;1&#39;, &#39;II:3&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2|&#39;, &#39;2|&#39;),
                 (&#39;1&#39;, &#39;II:3&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;),
                 (&#39;1&#39;, &#39;II:2&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2|&#39;, &#39;2|&#39;),
                 (&#39;1&#39;, &#39;II:2&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;),
                 (&#39;1&#39;, &#39;II:1&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2|&#39;, &#39;2|&#39;),
                 (&#39;1&#39;, &#39;II:1&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;2|&#39;),
                 (&#39;1&#39;, &#39;II:4&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2\\&#39;, &#39;2|&#39;),
                 (&#39;1&#39;, &#39;II:4&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1\\&#39;, &#39;2|&#39;))],
               &#39;2&#39;: [&#39;2&#39;,
                [&#39;V0-89984370&#39;,
                 &#39;V1-89984604&#39;,
                 &#39;V2-89984739&#39;,
                 &#39;V3-89985940&#39;,
                 &#39;V4-89986608&#39;,
                 &#39;V5-89986760&#39;,
                 &#39;V6-89987201&#39;],
                [89984370,
                 89984604,
                 89984739,
                 89985940,
                 89986608,
                 89986760,
                 89987201],
                [0.00015,
                 0.00015,
                 0.00015,
                 0.085784,
                 0.107936,
                 0.00015,
                 0.00015],
                ((&#39;2&#39;, &#39;I:A&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2:&#39;),
                 (&#39;2&#39;, &#39;I:A&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2:&#39;),
                 (&#39;2&#39;, &#39;I:B&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;1:&#39;),
                 (&#39;2&#39;, &#39;I:B&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;),
                 (&#39;2&#39;, &#39;II:D&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;1:&#39;),
                 (&#39;2&#39;, &#39;II:D&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;2:&#39;),
                 (&#39;2&#39;, &#39;II:C&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1:&#39;),
                 (&#39;2&#39;, &#39;II:C&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;2:&#39;),
                 (&#39;2&#39;, &#39;II:B&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1:&#39;),
                 (&#39;2&#39;, &#39;II:B&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;2:&#39;),
                 (&#39;2&#39;, &#39;II:A&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;1:&#39;),
                 (&#39;2&#39;, &#39;II:A&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;2:&#39;)),
                {&#39;V0-89984370&#39;: 0.00015,
                 &#39;V1-89984604&#39;: 0.00015,
                 &#39;V2-89984739&#39;: 0.00015,
                 &#39;V3-89985940&#39;: 0.085784,
                 &#39;V4-89986608&#39;: 0.107936,
                 &#39;V5-89986760&#39;: 0.00015,
                 &#39;V6-89987201&#39;: 0.00015}]}),
             (&#39;ld&#39;,
              [[[None],
                [1.0, None],
                [0.2380952380952381, 0.2380952380952381, None],
                [0.2380952380952381, 0.2380952380952381, 1.0, None],
                [0.2380952380952381, 0.2380952380952381, 1.0, 1.0, None],
                [0.5555555555555556,
                 0.5555555555555556,
                 0.42857142857142866,
                 0.42857142857142866,
                 0.42857142857142866,
                 None],
                [0.06666666666666665,
                 0.06666666666666665,
                 0.14285714285714282,
                 0.14285714285714282,
                 0.14285714285714282,
                 0.0,
                 None]],
               [[0, 1], [2, 3, 4], [3, 4]],
               [[&#39;V0-89984370&#39;, &#39;V1-89984604&#39;],
                [&#39;V2-89984739&#39;, &#39;V3-89985940&#39;, &#39;V4-89986608&#39;]]]),
             (&#39;coder&#39;,
              {&#39;input&#39;: [{&#39;II:2&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;],
                 &#39;I:2&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;],
                 &#39;I:1&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;],
                 &#39;II:3&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;],
                 &#39;II:4&#39;: [&#39;20&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;22&#39;],
                 &#39;II:1&#39;: [&#39;22&#39;, &#39;22&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;22&#39;],
                 &#39;II:B&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;],
                 &#39;I:B&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;],
                 &#39;I:A&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;22&#39;],
                 &#39;II:C&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;],
                 &#39;II:D&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;],
                 &#39;II:A&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;]},
                OrderedDict([(&#39;1&#39;,
                              [[&#39;1&#39;,
                                &#39;I:1&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;],
                               [&#39;1&#39;,
                                &#39;I:1&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;],
                               [&#39;1&#39;,
                                &#39;I:2&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;],
                               [&#39;1&#39;,
                                &#39;I:2&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;],
                               [&#39;1&#39;,
                                &#39;II:3&#39;,
                                &#39;2:&#39;,
                                &#39;2|&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;],
                               [&#39;1&#39;,
                                &#39;II:3&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;],
                               [&#39;1&#39;,
                                &#39;II:2&#39;,
                                &#39;2:&#39;,
                                &#39;2|&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;],
                               [&#39;1&#39;,
                                &#39;II:2&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;],
                               [&#39;1&#39;,
                                &#39;II:1&#39;,
                                &#39;2:&#39;,
                                &#39;2|&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;],
                               [&#39;1&#39;,
                                &#39;II:1&#39;,
                                &#39;2:&#39;,
                                &#39;2|&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;],
                               [&#39;1&#39;,
                                &#39;II:4&#39;,
                                &#39;2:&#39;,
                                &#39;2|&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;2\\&#39;,
                                &#39;2|&#39;],
                               [&#39;1&#39;,
                                &#39;II:4&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1\\&#39;,
                                &#39;2|&#39;]]),
                             (&#39;2&#39;,
                              [[&#39;2&#39;,
                                &#39;I:A&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;],
                               [&#39;2&#39;,
                                &#39;I:A&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;],
                               [&#39;2&#39;,
                                &#39;I:B&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;],
                               [&#39;2&#39;,
                                &#39;I:B&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;],
                               [&#39;2&#39;,
                                &#39;II:D&#39;,
                                &#39;2:&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;1:&#39;],
                               [&#39;2&#39;,
                                &#39;II:D&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;2:&#39;],
                               [&#39;2&#39;,
                                &#39;II:C&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;],
                               [&#39;2&#39;,
                                &#39;II:C&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;2:&#39;],
                               [&#39;2&#39;,
                                &#39;II:B&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;],
                               [&#39;2&#39;,
                                &#39;II:B&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;2:&#39;],
                               [&#39;2&#39;,
                                &#39;II:A&#39;,
                                &#39;2:&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;1:&#39;],
                               [&#39;2&#39;,
                                &#39;II:A&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;2:&#39;]])]),
                {&#39;V0-89984370&#39;: 0.00015,
                 &#39;V1-89984604&#39;: 0.00015,
                 &#39;V2-89984739&#39;: 0.00015,
                 &#39;V3-89985940&#39;: 0.085784,
                 &#39;V4-89986608&#39;: 0.107936,
                 &#39;V5-89986760&#39;: 0.00015,
                 &#39;V6-89987201&#39;: 0.00015},
                {&#39;1&#39;: [&#39;V0-89984370&#39;,
                  &#39;V1-89984604&#39;,
                  &#39;V2-89984739&#39;,
                  &#39;V3-89985940&#39;,
                  &#39;V4-89986608&#39;,
                  &#39;V5-89986760&#39;,
                  &#39;V6-89987201&#39;],
                 &#39;2&#39;: [&#39;V0-89984370&#39;,
                  &#39;V1-89984604&#39;,
                  &#39;V2-89984739&#39;,
                  &#39;V3-89985940&#39;,
                  &#39;V4-89986608&#39;,
                  &#39;V5-89986760&#39;,
                  &#39;V6-89987201&#39;]},
                [[&#39;V0-89984370&#39;, &#39;V1-89984604&#39;],
                 [&#39;V2-89984739&#39;, &#39;V3-89985940&#39;, &#39;V4-89986608&#39;]]],
               &#39;output&#39;: [((&#39;1&#39;, &#39;I:1&#39;, &#39;1,1&#39;, &#39;1111,11&#39;, &#39;2,2&#39;, &#39;2222,12&#39;),
                 (&#39;1&#39;, &#39;I:2&#39;, &#39;2,3&#39;, &#39;2222,22&#39;, &#39;1,1&#39;, &#39;1111,11&#39;),
                 (&#39;1&#39;, &#39;II:3&#39;, &#39;2,3&#39;, &#39;2222,22&#39;, &#39;1,1&#39;, &#39;1111,11&#39;),
                 (&#39;1&#39;, &#39;II:2&#39;, &#39;2,3&#39;, &#39;2222,22&#39;, &#39;1,1&#39;, &#39;1111,11&#39;),
                 (&#39;1&#39;, &#39;II:1&#39;, &#39;2,3&#39;, &#39;2222,22&#39;, &#39;2,2&#39;, &#39;2222,12&#39;),
                 (&#39;1&#39;, &#39;II:4&#39;, &#39;2,3&#39;, &#39;2222,22&#39;, &#39;1,2&#39;, &#39;1111,12&#39;),
                 (&#39;2&#39;, &#39;I:A&#39;, &#39;2&#39;, &#39;111112&#39;, &#39;2&#39;, &#39;111112&#39;),
                 (&#39;2&#39;, &#39;I:B&#39;, &#39;3&#39;, &#39;222221&#39;, &#39;1&#39;, &#39;111111&#39;),
                 (&#39;2&#39;, &#39;II:D&#39;, &#39;3&#39;, &#39;222221&#39;, &#39;2&#39;, &#39;111112&#39;),
                 (&#39;2&#39;, &#39;II:C&#39;, &#39;1&#39;, &#39;111111&#39;, &#39;2&#39;, &#39;111112&#39;),
                 (&#39;2&#39;, &#39;II:B&#39;, &#39;1&#39;, &#39;111111&#39;, &#39;2&#39;, &#39;111112&#39;),
                 (&#39;2&#39;, &#39;II:A&#39;, &#39;3&#39;, &#39;222221&#39;, &#39;2&#39;, &#39;111112&#39;)),
                {&#39;II:2&#39;: ([&#39;2&#39;, &#39;3&#39;], [&#39;2222&#39;, &#39;22&#39;]),
                 &#39;I:2&#39;: ([&#39;2&#39;, &#39;3&#39;], [&#39;2222&#39;, &#39;22&#39;]),
                 &#39;I:1&#39;: ([&#39;1&#39;, &#39;1&#39;], [&#39;1111&#39;, &#39;11&#39;]),
                 &#39;II:3&#39;: ([&#39;2&#39;, &#39;3&#39;], [&#39;2222&#39;, &#39;22&#39;]),
                 &#39;II:4&#39;: ([&#39;2&#39;, &#39;3&#39;], [&#39;2222&#39;, &#39;22&#39;]),
                 &#39;II:1&#39;: ([&#39;2&#39;, &#39;3&#39;], [&#39;2222&#39;, &#39;22&#39;]),
                 &#39;II:B&#39;: ([&#39;1&#39;], [&#39;111111&#39;]),
                 &#39;I:B&#39;: ([&#39;3&#39;], [&#39;222221&#39;]),
                 &#39;I:A&#39;: ([&#39;2&#39;], [&#39;111112&#39;]),
                 &#39;II:C&#39;: ([&#39;1&#39;], [&#39;111111&#39;]),
                 &#39;II:D&#39;: ([&#39;3&#39;], [&#39;222221&#39;]),
                 &#39;II:A&#39;: ([&#39;3&#39;], [&#39;222221&#39;])},
                2,
                OrderedDict([(&#39;1&#39;,
                              ((0.999999999999997, 3.0400071909574507e-15),
                               (0.9995498650574084,
                                0.000449932412250011,
                                2.0253034157679256e-07))),
                             (&#39;2&#39;,
                              ((0.999550067496625,
                                0.0004499325033749946,
                                1.3677980457054751e-18),))])]}),
             (&#39;format&#39;,
              {&#39;II:2&#39;: [(&#39;2&#39;, &#39;2222&#39;), (&#39;3&#39;, &#39;22&#39;)],
               &#39;I:2&#39;: [(&#39;2&#39;, &#39;2222&#39;), (&#39;3&#39;, &#39;22&#39;)],
               &#39;I:1&#39;: [(&#39;1&#39;, &#39;1111&#39;), (&#39;1&#39;, &#39;11&#39;)],
               &#39;II:3&#39;: [(&#39;2&#39;, &#39;2222&#39;), (&#39;3&#39;, &#39;22&#39;)],
               &#39;II:4&#39;: [(&#39;2&#39;, &#39;2222&#39;), (&#39;3&#39;, &#39;22&#39;)],
               &#39;II:1&#39;: [(&#39;2&#39;, &#39;2222&#39;), (&#39;3&#39;, &#39;22&#39;)],
               &#39;II:B&#39;: [(&#39;1&#39;, &#39;111111&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;I:B&#39;: [(&#39;3&#39;, &#39;222221&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;I:A&#39;: [(&#39;2&#39;, &#39;111112&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;II:C&#39;: [(&#39;1&#39;, &#39;111111&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;II:D&#39;: [(&#39;3&#39;, &#39;222221&#39;), (&#39;0&#39;, &#39;0&#39;)],
               &#39;II:A&#39;: [(&#39;3&#39;, &#39;222221&#39;), (&#39;0&#39;, &#39;0&#39;)]})])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;PAPPA2&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>OrderedDict([(&#39;dregions&#39;,
              [[&#39;1&#39;,
                &#39;176432306&#39;,
                &#39;176811970&#39;,
                &#39;PAPPA2&#39;,
                &#39;186.278964324&#39;,
                &#39;238.991541401&#39;,
                &#39;136.402021932&#39;]]),
             (&#39;dvariants&#39;,
              [[[&#39;1&#39;, 176659933, &#39;PAPPA2&#39;, 0.00015],
                [&#39;1&#39;, 176660247, &#39;PAPPA2&#39;, 0.00015],
                [&#39;1&#39;, 176660371, &#39;PAPPA2&#39;, 0.00015],
                [&#39;1&#39;, 176664842, &#39;PAPPA2&#39;, 0.241943],
                [&#39;1&#39;, 176668823, &#39;PAPPA2&#39;, 0.00015],
                [&#39;1&#39;, 176671914, &#39;PAPPA2&#39;, 0.00015],
                [&#39;1&#39;, 176679384, &#39;PAPPA2&#39;, 0.00015],
                [&#39;1&#39;, 176734756, &#39;PAPPA2&#39;, 0.352899],
                [&#39;1&#39;, 176811754, &#39;PAPPA2&#39;, 0.00015],
                [&#39;1&#39;, 176811873, &#39;PAPPA2&#39;, 0.00015]]]),
             (&#39;dfamvaridx&#39;,
              [{&#39;1&#39;: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
                &#39;2&#39;: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]}]),
             (&#39;dgeno&#39;,
              [{&#39;II:2&#39;: [&#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;],
                &#39;I:2&#39;: [&#39;11&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;],
                &#39;I:1&#39;: [&#39;12&#39;,
                 &#39;12&#39;,
                 &#39;22&#39;,
                 &#39;12&#39;,
                 &#39;22&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;22&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;],
                &#39;II:3&#39;: [&#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;],
                &#39;II:4&#39;: [&#39;11&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;22&#39;,
                 &#39;22&#39;,
                 &#39;11&#39;],
                &#39;II:1&#39;: [&#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;],
                &#39;II:B&#39;: [&#39;12&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;],
                &#39;I:B&#39;: [&#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;22&#39;,
                 &#39;22&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;],
                &#39;I:A&#39;: [&#39;11&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;],
                &#39;II:C&#39;: [&#39;12&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;,
                 &#39;11&#39;],
                &#39;II:D&#39;: [&#39;11&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;],
                &#39;II:A&#39;: [&#39;11&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;11&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;,
                 &#39;12&#39;]}]),
             (&#39;gss&#39;,
              [{0: {&#39;1&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;12&#39;),
                 &#39;2&#39;: (&#39;11&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;)},
                1: {&#39;1&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;12&#39;),
                 &#39;2&#39;: (&#39;11&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;)},
                2: {&#39;1&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;12&#39;),
                 &#39;2&#39;: (&#39;11&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;)},
                3: {&#39;1&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;12&#39;),
                 &#39;2&#39;: (&#39;11&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;)},
                4: {&#39;1&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;12&#39;),
                 &#39;2&#39;: (&#39;11&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;)},
                5: {&#39;1&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;12&#39;),
                 &#39;2&#39;: (&#39;11&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;)},
                6: {&#39;1&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;12&#39;),
                 &#39;2&#39;: (&#39;11&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;)},
                7: {&#39;1&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;12&#39;),
                 &#39;2&#39;: (&#39;11&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;)},
                8: {&#39;1&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;12&#39;),
                 &#39;2&#39;: (&#39;11&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;)},
                9: {&#39;1&#39;: (&#39;12&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;12&#39;),
                 &#39;2&#39;: (&#39;11&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;)}}]),
             (&#39;hapimp&#39;,
              {&#39;1&#39;: [&#39;1&#39;,
                [&#39;V0-176659933&#39;,
                 &#39;V1-176660247&#39;,
                 &#39;V2-176660371&#39;,
                 &#39;V3-176664842&#39;,
                 &#39;V4-176668823&#39;,
                 &#39;V5-176671914&#39;,
                 &#39;V6-176679384&#39;,
                 &#39;V7-176734756&#39;,
                 &#39;V8-176811754&#39;,
                 &#39;V9-176811873&#39;],
                [176659933,
                 176660247,
                 176660371,
                 176664842,
                 176668823,
                 176671914,
                 176679384,
                 176734756,
                 176811754,
                 176811873],
                [0.00015,
                 0.00015,
                 0.00015,
                 0.241943,
                 0.00015,
                 0.00015,
                 0.00015,
                 0.352899,
                 0.00015,
                 0.00015],
                ((&#39;1&#39;,
                  &#39;I:1&#39;,
                  &#39;1:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;1:&#39;),
                 (&#39;1&#39;,
                  &#39;I:1&#39;,
                  &#39;2:&#39;,
                  &#39;1:&#39;,
                  &#39;2:&#39;,
                  &#39;1:&#39;,
                  &#39;2:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;2:&#39;,
                  &#39;1:&#39;,
                  &#39;2:&#39;),
                 (&#39;1&#39;,
                  &#39;I:2&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;1:&#39;),
                 (&#39;1&#39;,
                  &#39;I:2&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;),
                 (&#39;1&#39;,
                  &#39;II:4&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;2|&#39;,
                  &#39;2|&#39;,
                  &#39;1|&#39;),
                 (&#39;1&#39;,
                  &#39;II:4&#39;,
                  &#39;1:&#39;,
                  &#39;2|&#39;,
                  &#39;2:&#39;,
                  &#39;2|&#39;,
                  &#39;2:&#39;,
                  &#39;2|&#39;,
                  &#39;2|&#39;,
                  &#39;2|&#39;,
                  &#39;2|&#39;,
                  &#39;1|&#39;),
                 (&#39;1&#39;,
                  &#39;II:3&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;),
                 (&#39;1&#39;,
                  &#39;II:3&#39;,
                  &#39;2:&#39;,
                  &#39;1|&#39;,
                  &#39;2:&#39;,
                  &#39;1|&#39;,
                  &#39;2:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;2|&#39;,
                  &#39;1|&#39;,
                  &#39;2|&#39;),
                 (&#39;1&#39;,
                  &#39;II:2&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;),
                 (&#39;1&#39;,
                  &#39;II:2&#39;,
                  &#39;2:&#39;,
                  &#39;1|&#39;,
                  &#39;2:&#39;,
                  &#39;1|&#39;,
                  &#39;2:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;2|&#39;,
                  &#39;1|&#39;,
                  &#39;2|&#39;),
                 (&#39;1&#39;,
                  &#39;II:1&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;),
                 (&#39;1&#39;,
                  &#39;II:1&#39;,
                  &#39;2:&#39;,
                  &#39;1|&#39;,
                  &#39;2:&#39;,
                  &#39;1|&#39;,
                  &#39;2:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;2|&#39;,
                  &#39;1|&#39;,
                  &#39;2|&#39;))],
               &#39;2&#39;: [&#39;2&#39;,
                [&#39;V0-176659933&#39;,
                 &#39;V1-176660247&#39;,
                 &#39;V2-176660371&#39;,
                 &#39;V3-176664842&#39;,
                 &#39;V4-176668823&#39;,
                 &#39;V5-176671914&#39;,
                 &#39;V6-176679384&#39;,
                 &#39;V7-176734756&#39;,
                 &#39;V8-176811754&#39;,
                 &#39;V9-176811873&#39;],
                [176659933,
                 176660247,
                 176660371,
                 176664842,
                 176668823,
                 176671914,
                 176679384,
                 176734756,
                 176811754,
                 176811873],
                [0.00015,
                 0.00015,
                 0.00015,
                 0.241943,
                 0.00015,
                 0.00015,
                 0.00015,
                 0.352899,
                 0.00015,
                 0.00015],
                ((&#39;2&#39;,
                  &#39;I:A&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;),
                 (&#39;2&#39;,
                  &#39;I:A&#39;,
                  &#39;1:&#39;,
                  &#39;2:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;),
                 (&#39;2&#39;,
                  &#39;I:B&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;2:&#39;,
                  &#39;1:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;1:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;),
                 (&#39;2&#39;,
                  &#39;I:B&#39;,
                  &#39;2:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;),
                 (&#39;2&#39;,
                  &#39;II:D&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;2|&#39;,
                  &#39;1|&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;1|&#39;,
                  &#39;2|&#39;,
                  &#39;2|&#39;,
                  &#39;2|&#39;),
                 (&#39;2&#39;,
                  &#39;II:D&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;),
                 (&#39;2&#39;,
                  &#39;II:C&#39;,
                  &#39;2:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;2|&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;2|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;),
                 (&#39;2&#39;,
                  &#39;II:C&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;),
                 (&#39;2&#39;,
                  &#39;II:B&#39;,
                  &#39;2:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;2|&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;2|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;),
                 (&#39;2&#39;,
                  &#39;II:B&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;),
                 (&#39;2&#39;,
                  &#39;II:A&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;2|&#39;,
                  &#39;1|&#39;,
                  &#39;2:&#39;,
                  &#39;2:&#39;,
                  &#39;1|&#39;,
                  &#39;2|&#39;,
                  &#39;2|&#39;,
                  &#39;2|&#39;),
                 (&#39;2&#39;,
                  &#39;II:A&#39;,
                  &#39;1:&#39;,
                  &#39;2|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1:&#39;,
                  &#39;1:&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;,
                  &#39;1|&#39;)),
                {&#39;V0-176659933&#39;: 0.00015,
                 &#39;V1-176660247&#39;: 0.00015,
                 &#39;V2-176660371&#39;: 0.00015,
                 &#39;V3-176664842&#39;: 0.241943,
                 &#39;V4-176668823&#39;: 0.00015,
                 &#39;V5-176671914&#39;: 0.00015,
                 &#39;V6-176679384&#39;: 0.00015,
                 &#39;V7-176734756&#39;: 0.352899,
                 &#39;V8-176811754&#39;: 0.00015,
                 &#39;V9-176811873&#39;: 0.00015}]}),
             (&#39;ld&#39;,
              [[[None],
                [0.1111111111111111, None],
                [0.022222222222222223, 0.022222222222222223, None],
                [0.1111111111111111,
                 0.1111111111111111,
                 0.022222222222222223,
                 None],
                [0.3333333333333334,
                 0.0,
                 0.6000000000000001,
                 0.3333333333333334,
                 None],
                [0.022222222222222223,
                 0.022222222222222223,
                 0.2177777777777778,
                 0.5555555555555556,
                 0.6000000000000001,
                 None],
                [0.1111111111111111,
                 0.1111111111111111,
                 0.022222222222222223,
                 1.0,
                 0.3333333333333334,
                 0.5555555555555556,
                 None],
                [0.0,
                 0.0,
                 0.6000000000000001,
                 0.0,
                 0.25,
                 0.06666666666666665,
                 0.0,
                 None],
                [0.19999999999999998,
                 0.022222222222222223,
                 0.2177777777777778,
                 0.022222222222222223,
                 0.06666666666666665,
                 0.2177777777777778,
                 0.022222222222222223,
                 0.6000000000000001,
                 None],
                [0.1111111111111111,
                 0.1111111111111111,
                 0.5555555555555556,
                 0.1111111111111111,
                 0.3333333333333334,
                 0.022222222222222223,
                 0.1111111111111111,
                 0.3333333333333334,
                 0.022222222222222223,
                 None]],
               [[3, 6]],
               [[&#39;V3-176664842&#39;, &#39;V6-176679384&#39;]]]),
             (&#39;coder&#39;,
              {&#39;input&#39;: [{&#39;II:2&#39;: [&#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;],
                 &#39;I:2&#39;: [&#39;11&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;],
                 &#39;I:1&#39;: [&#39;12&#39;,
                  &#39;12&#39;,
                  &#39;22&#39;,
                  &#39;12&#39;,
                  &#39;22&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;22&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;],
                 &#39;II:3&#39;: [&#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;],
                 &#39;II:4&#39;: [&#39;11&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;22&#39;,
                  &#39;22&#39;,
                  &#39;11&#39;],
                 &#39;II:1&#39;: [&#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;],
                 &#39;II:B&#39;: [&#39;12&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;],
                 &#39;I:B&#39;: [&#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;22&#39;,
                  &#39;22&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;],
                 &#39;I:A&#39;: [&#39;11&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;],
                 &#39;II:C&#39;: [&#39;12&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;,
                  &#39;11&#39;],
                 &#39;II:D&#39;: [&#39;11&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;],
                 &#39;II:A&#39;: [&#39;11&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;11&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;,
                  &#39;12&#39;]},
                OrderedDict([(&#39;1&#39;,
                              [[&#39;1&#39;,
                                &#39;I:1&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;],
                               [&#39;1&#39;,
                                &#39;I:1&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;],
                               [&#39;1&#39;,
                                &#39;I:2&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;],
                               [&#39;1&#39;,
                                &#39;I:2&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;],
                               [&#39;1&#39;,
                                &#39;II:4&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;1|&#39;],
                               [&#39;1&#39;,
                                &#39;II:4&#39;,
                                &#39;1:&#39;,
                                &#39;2|&#39;,
                                &#39;2:&#39;,
                                &#39;2|&#39;,
                                &#39;2:&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;1|&#39;],
                               [&#39;1&#39;,
                                &#39;II:3&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;],
                               [&#39;1&#39;,
                                &#39;II:3&#39;,
                                &#39;2:&#39;,
                                &#39;1|&#39;,
                                &#39;2:&#39;,
                                &#39;1|&#39;,
                                &#39;2:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;],
                               [&#39;1&#39;,
                                &#39;II:2&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;],
                               [&#39;1&#39;,
                                &#39;II:2&#39;,
                                &#39;2:&#39;,
                                &#39;1|&#39;,
                                &#39;2:&#39;,
                                &#39;1|&#39;,
                                &#39;2:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;],
                               [&#39;1&#39;,
                                &#39;II:1&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;],
                               [&#39;1&#39;,
                                &#39;II:1&#39;,
                                &#39;2:&#39;,
                                &#39;1|&#39;,
                                &#39;2:&#39;,
                                &#39;1|&#39;,
                                &#39;2:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;]]),
                             (&#39;2&#39;,
                              [[&#39;2&#39;,
                                &#39;I:A&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;],
                               [&#39;2&#39;,
                                &#39;I:A&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;],
                               [&#39;2&#39;,
                                &#39;I:B&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;],
                               [&#39;2&#39;,
                                &#39;I:B&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;],
                               [&#39;2&#39;,
                                &#39;II:D&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;,
                                &#39;1|&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;],
                               [&#39;2&#39;,
                                &#39;II:D&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;],
                               [&#39;2&#39;,
                                &#39;II:C&#39;,
                                &#39;2:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;],
                               [&#39;2&#39;,
                                &#39;II:C&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;],
                               [&#39;2&#39;,
                                &#39;II:B&#39;,
                                &#39;2:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;2|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;],
                               [&#39;2&#39;,
                                &#39;II:B&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;],
                               [&#39;2&#39;,
                                &#39;II:A&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;,
                                &#39;1|&#39;,
                                &#39;2:&#39;,
                                &#39;2:&#39;,
                                &#39;1|&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;,
                                &#39;2|&#39;],
                               [&#39;2&#39;,
                                &#39;II:A&#39;,
                                &#39;1:&#39;,
                                &#39;2|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1:&#39;,
                                &#39;1:&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;,
                                &#39;1|&#39;]])]),
                {&#39;V0-176659933&#39;: 0.00015,
                 &#39;V1-176660247&#39;: 0.00015,
                 &#39;V2-176660371&#39;: 0.00015,
                 &#39;V3-176664842&#39;: 0.241943,
                 &#39;V4-176668823&#39;: 0.00015,
                 &#39;V5-176671914&#39;: 0.00015,
                 &#39;V6-176679384&#39;: 0.00015,
                 &#39;V7-176734756&#39;: 0.352899,
                 &#39;V8-176811754&#39;: 0.00015,
                 &#39;V9-176811873&#39;: 0.00015},
                {&#39;1&#39;: [&#39;V0-176659933&#39;,
                  &#39;V1-176660247&#39;,
                  &#39;V2-176660371&#39;,
                  &#39;V3-176664842&#39;,
                  &#39;V4-176668823&#39;,
                  &#39;V5-176671914&#39;,
                  &#39;V6-176679384&#39;,
                  &#39;V7-176734756&#39;,
                  &#39;V8-176811754&#39;,
                  &#39;V9-176811873&#39;],
                 &#39;2&#39;: [&#39;V0-176659933&#39;,
                  &#39;V1-176660247&#39;,
                  &#39;V2-176660371&#39;,
                  &#39;V3-176664842&#39;,
                  &#39;V4-176668823&#39;,
                  &#39;V5-176671914&#39;,
                  &#39;V6-176679384&#39;,
                  &#39;V7-176734756&#39;,
                  &#39;V8-176811754&#39;,
                  &#39;V9-176811873&#39;]},
                [[&#39;V3-176664842&#39;, &#39;V6-176679384&#39;]]],
               &#39;output&#39;: [((&#39;1&#39;, &#39;I:1&#39;, &#39;4&#39;, &#39;1222222221&#39;, &#39;3&#39;, &#39;2122212212&#39;),
                 (&#39;1&#39;, &#39;I:2&#39;, &#39;2&#39;, &#39;1111111221&#39;, &#39;1&#39;, &#39;1111111111&#39;),
                 (&#39;1&#39;, &#39;II:4&#39;, &#39;2&#39;, &#39;1111111221&#39;, &#39;4&#39;, &#39;1222222221&#39;),
                 (&#39;1&#39;, &#39;II:3&#39;, &#39;1&#39;, &#39;1111111111&#39;, &#39;3&#39;, &#39;2122212212&#39;),
                 (&#39;1&#39;, &#39;II:2&#39;, &#39;1&#39;, &#39;1111111111&#39;, &#39;3&#39;, &#39;2122212212&#39;),
                 (&#39;1&#39;, &#39;II:1&#39;, &#39;1&#39;, &#39;1111111111&#39;, &#39;3&#39;, &#39;2122212212&#39;),
                 (&#39;2&#39;, &#39;I:A&#39;, &#39;1&#39;, &#39;1111111111&#39;, &#39;2&#39;, &#39;1212112111&#39;),
                 (&#39;2&#39;, &#39;I:B&#39;, &#39;4&#39;, &#39;1121221222&#39;, &#39;3&#39;, &#39;2112222111&#39;),
                 (&#39;2&#39;, &#39;II:D&#39;, &#39;4&#39;, &#39;1121221222&#39;, &#39;1&#39;, &#39;1111111111&#39;),
                 (&#39;2&#39;, &#39;II:C&#39;, &#39;3&#39;, &#39;2112222111&#39;, &#39;1&#39;, &#39;1111111111&#39;),
                 (&#39;2&#39;, &#39;II:B&#39;, &#39;3&#39;, &#39;2112222111&#39;, &#39;1&#39;, &#39;1111111111&#39;),
                 (&#39;2&#39;, &#39;II:A&#39;, &#39;4&#39;, &#39;1121221222&#39;, &#39;2&#39;, &#39;1212112111&#39;)),
                {&#39;II:2&#39;: ([&#39;1&#39;], [&#39;1111111111&#39;]),
                 &#39;I:2&#39;: ([&#39;2&#39;], [&#39;1111111221&#39;]),
                 &#39;I:1&#39;: ([&#39;4&#39;], [&#39;1222222221&#39;]),
                 &#39;II:3&#39;: ([&#39;1&#39;], [&#39;1111111111&#39;]),
                 &#39;II:4&#39;: ([&#39;2&#39;], [&#39;1111111221&#39;]),
                 &#39;II:1&#39;: ([&#39;1&#39;], [&#39;1111111111&#39;]),
                 &#39;II:B&#39;: ([&#39;3&#39;], [&#39;2112222111&#39;]),
                 &#39;I:B&#39;: ([&#39;4&#39;], [&#39;1121221222&#39;]),
                 &#39;I:A&#39;: ([&#39;1&#39;], [&#39;1111111111&#39;]),
                 &#39;II:C&#39;: ([&#39;3&#39;], [&#39;2112222111&#39;]),
                 &#39;II:D&#39;: ([&#39;4&#39;], [&#39;1121221222&#39;]),
                 &#39;II:A&#39;: ([&#39;4&#39;], [&#39;1121221222&#39;])},
                1,
                OrderedDict([(&#39;1&#39;,
                              ((0.9998363838109469,
                                0.00016361618905309718,
                                1.3225147758256331e-20,
                                7.937469761930493e-24),)),
                             (&#39;2&#39;,
                              ((0.9999999928166995,
                                7.183300126057594e-09,
                                3.233697565987606e-16,
                                1.6580038589959425e-19),))])]}),
             (&#39;format&#39;,
              {&#39;II:2&#39;: [(&#39;1&#39;, &#39;1111111111&#39;)],
               &#39;I:2&#39;: [(&#39;2&#39;, &#39;1111111221&#39;)],
               &#39;I:1&#39;: [(&#39;4&#39;, &#39;1222222221&#39;)],
               &#39;II:3&#39;: [(&#39;1&#39;, &#39;1111111111&#39;)],
               &#39;II:4&#39;: [(&#39;2&#39;, &#39;1111111221&#39;)],
               &#39;II:1&#39;: [(&#39;1&#39;, &#39;1111111111&#39;)],
               &#39;II:B&#39;: [(&#39;3&#39;, &#39;2112222111&#39;)],
               &#39;I:B&#39;: [(&#39;4&#39;, &#39;1121221222&#39;)],
               &#39;I:A&#39;: [(&#39;1&#39;, &#39;1111111111&#39;)],
               &#39;II:C&#39;: [(&#39;3&#39;, &#39;2112222111&#39;)],
               &#39;II:D&#39;: [(&#39;4&#39;, &#39;1121221222&#39;)],
               &#39;II:A&#39;: [(&#39;4&#39;, &#39;1121221222&#39;)]})])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="One-region-test">One region test<a class="anchor-link" href="#One-region-test"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">region</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">extractor</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
<span class="n">maker</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>  
<span class="n">extractor</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>data {&#39;II:2&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;], &#39;I:2&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;], &#39;I:1&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;], &#39;II:3&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;12&#39;], &#39;II:4&#39;: [&#39;20&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;22&#39;], &#39;II:1&#39;: [&#39;22&#39;, &#39;22&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;, &#39;22&#39;], &#39;II:B&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;], &#39;I:B&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;11&#39;], &#39;I:A&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;22&#39;], &#39;II:C&#39;: [&#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;11&#39;, &#39;12&#39;], &#39;II:D&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;], &#39;II:A&#39;: [&#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;, &#39;12&#39;]}
Estimating allele frequencies... [using maximum likelihood]0
   V0-89984370 V1-89984604 V2-89984739 V3-89985940 V4-89986608 V5-89986760 
   V6-89987201 

V0-89984370: 0 0.5 0.5 
total familyCount:1
V1-89984604: 0 0.5 0.5 
total familyCount:1
V2-89984739: 0 1 
total familyCount:1
V3-89985940: 0 1 
total familyCount:1
V4-89986608: 0 1 
total familyCount:1
V5-89986760: 0 0.75 0.25 
total familyCount:1
V6-89987201: 0 0.5 0.5 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0
   V0-89984370 V1-89984604 V2-89984739 V3-89985940 V4-89986608 V5-89986760 
   V6-89987201 

V0-89984370: 0 0.75 0.25 
total familyCount:1
V1-89984604: 0 0.75 0.25 
total familyCount:1
V2-89984739: 0 0.75 0.25 
total familyCount:1
V3-89985940: 0 0.75 0.25 
total familyCount:1
V4-89986608: 0 0.75 0.25 
total familyCount:1
V5-89986760: 0 0.75 0.25 
total familyCount:1
V6-89987201: 0 0.5 0.5 
total familyCount:1
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/1974374.1.plot.q/ipykernel_14355/1565046380.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>maker<span class="ansi-blue-fg">.</span>apply<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/tmp/1974374.1.plot.q/ipykernel_14355/1421714082.py</span> in <span class="ansi-cyan-fg">apply</span><span class="ansi-blue-fg">(self, data)</span>
<span class="ansi-green-intense-fg ansi-bold">    119</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    120</span>                 <span class="ansi-red-fg"># calculate LD clusters using founder haplotypes</span>
<span class="ansi-green-fg">--&gt; 121</span><span class="ansi-red-fg">                 </span>clusters <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>__ClusterByLD<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> haplotypes<span class="ansi-blue-fg">,</span> varnames<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    122</span>                 print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;clusters:&#39;</span><span class="ansi-blue-fg">,</span>clusters<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    123</span>                 <span class="ansi-red-fg"># recoding the genotype of the region</span>

<span class="ansi-green-fg">/tmp/1974374.1.plot.q/ipykernel_14355/1421714082.py</span> in <span class="ansi-cyan-fg">__ClusterByLD</span><span class="ansi-blue-fg">(self, data, haplotypes, varnames)</span>
<span class="ansi-green-intense-fg ansi-bold">    236</span>                 founder_haplotypes<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;{}-{}&#34;</span><span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span>hap<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> ihap <span class="ansi-blue-fg">%</span> <span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;&#34;</span><span class="ansi-blue-fg">.</span>join<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>x<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span> <span class="ansi-green-fg">if</span> x<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>isupper<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> x<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span> <span class="ansi-green-fg">for</span> x <span class="ansi-green-fg">in</span> gt<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    237</span>         <span class="ansi-red-fg"># calculate LD blocks, use r2 measure</span>
<span class="ansi-green-fg">--&gt; 238</span><span class="ansi-red-fg">         </span>ld <span class="ansi-blue-fg">=</span> Align<span class="ansi-blue-fg">.</span>create<span class="ansi-blue-fg">(</span>founder_haplotypes<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>matrixLD<span class="ansi-blue-fg">(</span>validCharacters<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;12&#34;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;r2&#34;</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    239</span>         blocks <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    240</span>         <span class="ansi-green-fg">for</span> j <span class="ansi-green-fg">in</span> ld<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/miniconda3/envs/seqpy3v0/lib/python3.9/site-packages/egglib/_interface.py</span> in <span class="ansi-cyan-fg">create</span><span class="ansi-blue-fg">(cls, source, alphabet)</span>
<span class="ansi-green-intense-fg ansi-bold">    582</span> 
<span class="ansi-green-intense-fg ansi-bold">    583</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> isinstance<span class="ansi-blue-fg">(</span>source<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">(</span>Align<span class="ansi-blue-fg">,</span> Container<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 584</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">if</span> alphabet <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;alphabet is required for object creation from an iterable&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    585</span>             new_instance<span class="ansi-blue-fg">.</span>__init__<span class="ansi-blue-fg">(</span>alphabet<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    586</span>             new_instance<span class="ansi-blue-fg">.</span>add_samples<span class="ansi-blue-fg">(</span>source<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">ValueError</span>: alphabet is required for object creation from an iterable</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">haplotypes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">mafs</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1">##Per fam per variant</span>
<span class="n">varnames</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">_MarkerMaker__Haplotype</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">item</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running family&#39;</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>
<span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">positions</span><span class="p">,</span> <span class="n">vcf_mafs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamVariants</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;here&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
        <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="n">maker</span><span class="o">.</span><span class="n">missings</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running family 1007
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;V8-13273&#39;, &#39;V17-13417&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp_log_output</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
<span class="n">maker</span><span class="o">.</span><span class="n">haplotyper</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="n">maker</span><span class="o">.</span><span class="n">rsq</span><span class="p">,</span> <span class="n">tmp_log_output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[[&#39;4_364&#39;, &#39;4_364_1&#39;, &#39;0&#39;, &#39;0&#39;, &#39;1&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_17&#39;, &#39;0&#39;, &#39;0&#39;, &#39;2&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_14&#39;, &#39;0&#39;, &#39;0&#39;, &#39;1&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_13&#39;, &#39;0&#39;, &#39;0&#39;, &#39;1&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_21&#39;, &#39;0&#39;, &#39;0&#39;, &#39;1&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_2&#39;, &#39;0&#39;, &#39;0&#39;, &#39;2&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_7&#39;, &#39;4_364_1&#39;, &#39;4_364_2&#39;, &#39;1&#39;, &#39;00&#39;, &#39;11&#39;],
 [&#39;4_364&#39;, &#39;4_364_6&#39;, &#39;4_364_1&#39;, &#39;4_364_2&#39;, &#39;2&#39;, &#39;11&#39;, &#39;11&#39;],
 [&#39;4_364&#39;, &#39;4_364_5&#39;, &#39;4_364_1&#39;, &#39;4_364_2&#39;, &#39;2&#39;, &#39;11&#39;, &#39;11&#39;],
 [&#39;4_364&#39;, &#39;4_364_20&#39;, &#39;4_364_21&#39;, &#39;4_364_5&#39;, &#39;2&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_22&#39;, &#39;4_364_21&#39;, &#39;4_364_5&#39;, &#39;1&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_99&#39;, &#39;4_364_1&#39;, &#39;4_364_2&#39;, &#39;2&#39;, &#39;12&#39;, &#39;12&#39;],
 [&#39;4_364&#39;, &#39;4_364_9&#39;, &#39;4_364_13&#39;, &#39;4_364_99&#39;, &#39;2&#39;, &#39;11&#39;, &#39;11&#39;],
 [&#39;4_364&#39;, &#39;4_364_12&#39;, &#39;4_364_13&#39;, &#39;4_364_99&#39;, &#39;2&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_11&#39;, &#39;4_364_13&#39;, &#39;4_364_99&#39;, &#39;1&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_10&#39;, &#39;4_364_13&#39;, &#39;4_364_99&#39;, &#39;1&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_8&#39;, &#39;4_364_13&#39;, &#39;4_364_99&#39;, &#39;2&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_16&#39;, &#39;4_364_14&#39;, &#39;4_364_8&#39;, &#39;1&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_18&#39;, &#39;4_364_16&#39;, &#39;4_364_17&#39;, &#39;1&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_19&#39;, &#39;4_364_16&#39;, &#39;4_364_17&#39;, &#39;2&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_15&#39;, &#39;4_364_14&#39;, &#39;4_364_8&#39;, &#39;2&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_3&#39;, &#39;4_364_1&#39;, &#39;4_364_2&#39;, &#39;1&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_4&#39;, &#39;4_364_1&#39;, &#39;4_364_2&#39;, &#39;2&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_23&#39;, &#39;0&#39;, &#39;0&#39;, &#39;1&#39;, &#39;00&#39;, &#39;00&#39;],
 [&#39;4_364&#39;, &#39;4_364_DCH23.4&#39;, &#39;4_364_23&#39;, &#39;4_364_4&#39;, &#39;1&#39;, &#39;00&#39;, &#39;00&#39;]]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;V</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variants</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">:</span>
    <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">positions</span><span class="p">,</span> <span class="n">vcf_mafs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamVariants</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missings</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># haplotyping</span>
    <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">env</span><span class="o">.</span><span class="n">prephased</span><span class="p">:</span>
            <span class="c1">#with stdoutRedirect(to = env.tmp_log + str(os.getpid()) + &#39;.log&#39;):</span>
            <span class="c1">#    haplotypes[item] = self.haplotyper.Execute(data.chrom, varnames[item],</span>
            <span class="c1">#                                           sorted(positions), data.getFamSamples(item))[0]</span>
            <span class="n">tmp_log_output</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
            <span class="c1">#with stdoutRedirect(to = tmp_log_output + &#39;.log&#39;):</span>
            <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">haplotyper</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span>
                                                           <span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsq</span><span class="p">,</span> <span class="n">tmp_log_output</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__PedToHaplotype</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># C++ haplotyping implementation failed</span>
        <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
            <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># either use privided MAF or computer MAF</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">vcf_mafs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mafs</span><span class="p">:</span>
                <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcf_mafs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># count founder alleles</span>
        <span class="k">for</span> <span class="n">hap</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">is_founder</span><span class="p">(</span><span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">idxv</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mafs</span><span class="p">:</span>
                    <span class="c1"># [#alt, #haplotypes]</span>
                    <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">gt</span> <span class="o">=</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">gt</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
                    <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gtconv</span><span class="p">[</span><span class="n">gt</span><span class="p">]</span>
                    <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
<span class="c1">#</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">_MarkerMaker__Haplotype</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test3">Test3<a class="anchor-link" href="#Test3"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">triallelic_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> tri-allelic loci were ignored&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">triallelic_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">commonvar_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> variants ignored due to having MAF &gt; </span><span class="si">{}</span><span class="s1"> and other specified constraints&#39;</span><span class="o">.</span>\
                <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">commonvar_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">maf_cutoff</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">null_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units ignored due to absence in VCF file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">null_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">trivial_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units ignored due to absence of variation in samples&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">trivial_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 1 units ignored due to absence in VCF file</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fatal_errors</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Error msg from C++ extension</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;cat </span><span class="si">{}</span><span class="s2">/*.* &gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span><span class="p">))</span>
    <span class="n">fatal_errors</span> <span class="o">=</span> <span class="n">wordCount</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span><span class="p">)[</span><span class="s1">&#39;fatal&#39;</span><span class="p">]</span>
<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
    <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:,d}</span><span class="s2"> regional markers failed to be generated due to haplotyping failures!&quot;</span><span class="o">.</span>\
              <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
<span class="k">if</span> <span class="n">fatal_errors</span><span class="p">:</span>
    <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:,d}</span><span class="s2"> or more regional markers failed to be generated due to runtime errors!&quot;</span><span class="o">.</span>\
              <span class="nb">format</span><span class="p">(</span><span class="n">fatal_errors</span><span class="p">))</span>
<span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Archiving regional marker data to directory [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">cache_dir</span><span class="p">))</span>
<span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">arcroot</span> <span class="o">=</span> <span class="s1">&#39;CACHE&#39;</span><span class="p">,</span> <span class="n">source_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">jobs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>cat: &#39;./seqlinkage-example/tmprst/SEQLinkage_tmp_wk92qcpq/*.*&#39;: No such file or directory
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: Archiving regional marker data to directory [./seqlinkage-example/cache]</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;./seqlinkage-example/tmprst/SEQLinkage_tmp_wk92qcpq/CACHE&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;tsq20211129.chr1.freq&#39;, &#39;tsq20211129.chr1.tped&#39;, &#39;tsq20211129.tfam&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">jobs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>16</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tpeds</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tped&#39;</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">format</span><span class="p">:</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">setID</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">vanilla</span> <span class="ow">and</span> <span class="n">cache</span><span class="o">.</span><span class="n">check</span><span class="p">():</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Loading </span><span class="si">{}</span><span class="s1"> data from archive ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">target_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units will be converted to </span><span class="si">{}</span><span class="s1"> format&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">success_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">env</span><span class="o">.</span><span class="n">format_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">format</span><span class="p">(</span><span class="n">tpeds</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.tfam&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">)),</span>
               <span class="n">args</span><span class="o">.</span><span class="n">prevalence</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">wild_pen</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">muta_pen</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span>
               <span class="n">args</span><span class="o">.</span><span class="n">inherit_mode</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_max</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_inc</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units successfully converted to </span><span class="si">{}</span><span class="s1"> format</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span>\
                <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">format_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">flush</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">skipped_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="c1"># FIXME: perhaps we need to rephrase this message?</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> region - family pairs skipped&#39;</span><span class="o">.</span>\
                    <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">skipped_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Archiving </span><span class="si">{}</span><span class="s1"> format to directory [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">env</span><span class="o">.</span><span class="n">cache_dir</span><span class="p">))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">arcroot</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                    <span class="n">source_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">mkpath</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">outdir</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 2 units will be converted to MERLIN format</span>
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>16
16
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 1 units successfully converted to MERLIN format</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: Archiving MERLIN format to directory [./seqlinkage-example/cache]</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 2 units will be converted to LINKAGE format</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 1 units successfully converted to LINKAGE format</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: Archiving LINKAGE format to directory [./seqlinkage-example/cache]</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="2.-Testing-run_linkage">2. Testing run_linkage<a class="anchor-link" href="#2.-Testing-run_linkage"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">args</span><span class="o">.</span><span class="n">run_linkage</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cache</span><span class="o">.</span><span class="n">setID</span><span class="p">(</span><span class="s1">&#39;analysis&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">output</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;LINKAGE&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">?</span>cache.load
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea ">
<pre><span class="ansi-red-fg">Signature:</span> cache<span class="ansi-blue-fg">.</span>load<span class="ansi-blue-fg">(</span>target_dir<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> names<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Docstring:</span> &lt;no docstring&gt;
<span class="ansi-red-fg">File:</span>      /mnt/mfs/statgen/yin/Github/linkage/SEQpy3/SEQLinkage/Utils.py
<span class="ansi-red-fg">Type:</span>      method
</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cache</span><span class="o">.</span><span class="n">cache_name</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;/mnt/mfs/statgen/yin/Github/linkage/SEQpy3/cache/LINKAGE.cache&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">vanilla</span> <span class="ow">and</span> <span class="n">cache</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>False</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fmt</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">format</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">args</span><span class="o">.</span><span class="n">blueprint</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;data/genemap.hg38.txt&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">args</span><span class="o">.</span><span class="n">theta_inc</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.05</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">args</span><span class="o">.</span><span class="n">theta_max</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.5</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">args</span><span class="o">.</span><span class="n">output_limit</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>10</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">run_linkage</span><span class="p">:</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">setID</span><span class="p">(</span><span class="s1">&#39;analysis&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">vanilla</span> <span class="ow">and</span> <span class="n">cache</span><span class="o">.</span><span class="n">check</span><span class="p">():</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Loading linkage analysis result from archive ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">target_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;heatmap&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Running linkage analysis ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">run_linkage</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">blueprint</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_inc</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_max</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">output_limit</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Linkage analysis succesfully performed for </span><span class="si">{:,d}</span><span class="s1"> units</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span>\
                <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">run_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">flush</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">makeped_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &quot;makeped&quot; runtime errors occurred&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">makeped_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">pedcheck_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &quot;pedcheck&quot; runtime errors occurred&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">pedcheck_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">unknown_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &quot;unknown&quot; runtime errors occurred&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unknown_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">mlink_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &quot;mlink&quot; runtime errors occurred&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">mlink_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">arcroot</span> <span class="o">=</span> <span class="s1">&#39;heatmap&#39;</span><span class="p">,</span> <span class="n">source_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;heatmap&#39;</span><span class="p">),</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">html</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">theta_inc</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_max</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">output_limit</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Saving data to [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">)))</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">target_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">format</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: Running linkage analysis ...</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: Linkage analysis succesfully performed for 1 units</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 2 &#34;pedcheck&#34; runtime errors occurred</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: Report for [tsq20211129] is generated in HTML format</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>    <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Saving data to [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">)))</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">target_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">format</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: Saving data to [/mnt/mfs/statgen/yin/Github/linkage/SEQpy2/testseqlink]</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Testing-main">Testing main<a class="anchor-link" href="#Testing-main"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">no_save</span><span class="p">:</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="n">NoCache</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
<span class="n">cache</span><span class="o">.</span><span class="n">setID</span><span class="p">(</span><span class="s1">&#39;vcf&#39;</span><span class="p">)</span>
<span class="c1"># STEP 1: write encoded data to TPED format</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">vanilla</span> <span class="ow">and</span> <span class="n">cache</span><span class="o">.</span><span class="n">check</span><span class="p">():</span>
    <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Loading regional marker data from archive ...&#39;</span><span class="p">)</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">target_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CACHE&#39;</span><span class="p">])</span>
    <span class="n">env</span><span class="o">.</span><span class="n">success_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">fileLinesCount</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/*.tped&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">))))</span>
    <span class="n">env</span><span class="o">.</span><span class="n">batch</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># load VCF file header</span>
    <span class="n">checkVCFBundle</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">vcf</span><span class="p">)</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">vs</span> <span class="o">=</span> <span class="n">cstatgen</span><span class="o">.</span><span class="n">VCFstream</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">vcf</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">exit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">samples_vcf</span> <span class="o">=</span> <span class="n">vs</span><span class="o">.</span><span class="n">GetSampleNames</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples_vcf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Fail to extract samples from [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">vcf</span><span class="p">),</span> <span class="n">exit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> samples found in [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples_vcf</span><span class="p">),</span> <span class="n">args</span><span class="o">.</span><span class="n">vcf</span><span class="p">))</span>
    <span class="n">samples_not_vcf</span> <span class="o">=</span> <span class="n">checkSamples</span><span class="p">(</span><span class="n">samples_vcf</span><span class="p">,</span> <span class="n">getColumn</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">tfam</span><span class="p">,</span> <span class="mi">2</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># load sample info</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">RData</span><span class="p">(</span><span class="n">samples_vcf</span><span class="p">,</span> <span class="n">TFAMParser</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">tfam</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No valid family to process. &#39;</span> \
                  <span class="s1">&#39;Families have to be at least trio with at least one member in VCF file.&#39;</span><span class="p">,</span> <span class="n">exit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No valid sample to process. &#39;</span> \
                  <span class="s1">&#39;Samples have to be in families, and present in both TFAM and VCF files.&#39;</span><span class="p">,</span> <span class="n">exit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">rewriteFamfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.tfam&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">)),</span>
                   <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="n">samples_not_vcf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">single_markers</span><span class="p">:</span>
        <span class="n">regions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vs</span><span class="o">.</span><span class="n">GetGenomeCoordinates</span><span class="p">()]</span>
        <span class="n">args</span><span class="o">.</span><span class="n">blueprint</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># load blueprint</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Loading marker map from [</span><span class="si">{}</span><span class="s1">] ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">blueprint</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">blueprint</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">regions</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Cannot load regional marker blueprint [</span><span class="si">{}</span><span class="s2">]. &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">blueprint</span><span class="p">),</span> <span class="n">exit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> families with a total of </span><span class="si">{:,d}</span><span class="s1"> samples will be scanned for </span><span class="si">{:,d}</span><span class="s1"> pre-defined units&#39;</span><span class="o">.</span>\
            <span class="nb">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">)))</span>
    <span class="n">env</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">jobs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">regions</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">env</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span>
    <span class="n">queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">faulthandler</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span> <span class="o">+</span> <span class="s1">&#39;.SEGV&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
            <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">EncoderWorker</span><span class="p">(</span>
            <span class="n">queue</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">),</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="n">RegionExtractor</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">vcf</span><span class="p">,</span> <span class="n">chr_prefix</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">chr_prefix</span><span class="p">,</span> <span class="n">allele_freq_info</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">freq</span><span class="p">),</span>
            <span class="n">MarkerMaker</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">bin</span><span class="p">,</span> <span class="n">maf_cutoff</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">maf_cutoff</span><span class="p">),</span>
            <span class="n">LinkageWriter</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples_not_vcf</span><span class="p">))</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">jobs</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="n">faulthandler</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="c1"># FIXME: need to properly close all jobs</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Use &#39;killall </span><span class="si">{}</span><span class="s2">&#39; to properly terminate all processes!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">prog</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units (from </span><span class="si">{:,d}</span><span class="s1"> variants) processed; &#39;</span>\
            <span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> Mendelian inconsistencies and </span><span class="si">{:,d}</span><span class="s1"> recombination events handled</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span>\
            <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">success_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="n">env</span><span class="o">.</span><span class="n">variants_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="n">env</span><span class="o">.</span><span class="n">mendelerror_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="n">env</span><span class="o">.</span><span class="n">recomb_counter</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">flush</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">triallelic_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> tri-allelic loci were ignored&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">triallelic_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">commonvar_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> variants ignored due to having MAF &gt; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span>\
                    <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">commonvar_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">maf_cutoff</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">null_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units ignored due to absence in VCF file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">null_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">trivial_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units ignored due to absence of variation in samples&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">trivial_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="n">fatal_errors</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Error msg from C++ extension</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;cat </span><span class="si">{}</span><span class="s2">/*.* &gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span><span class="p">))</span>
            <span class="n">fatal_errors</span> <span class="o">=</span> <span class="n">wordCount</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span><span class="p">)[</span><span class="s1">&#39;fatal&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:,d}</span><span class="s2"> regional markers failed to be generated due to haplotyping failures!&quot;</span><span class="o">.</span>\
                      <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fatal_errors</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:,d}</span><span class="s2"> or more regional markers failed to be generated due to runtime errors!&quot;</span><span class="o">.</span>\
                      <span class="nb">format</span><span class="p">(</span><span class="n">fatal_errors</span><span class="p">))</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Archiving regional marker data to directory [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">cache_dir</span><span class="p">))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">arcroot</span> <span class="o">=</span> <span class="s1">&#39;CACHE&#39;</span><span class="p">,</span> <span class="n">source_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">jobs</span>
<span class="c1"># STEP 2: write to PLINK or mega2 format</span>
<span class="n">tpeds</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tped&#39;</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">format</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">setID</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">vanilla</span> <span class="ow">and</span> <span class="n">cache</span><span class="o">.</span><span class="n">check</span><span class="p">():</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Loading </span><span class="si">{}</span><span class="s1"> data from archive ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">target_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units will be converted to </span><span class="si">{}</span><span class="s1"> format&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">success_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">env</span><span class="o">.</span><span class="n">format_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">format</span><span class="p">(</span><span class="n">tpeds</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.tfam&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">)),</span>
               <span class="n">args</span><span class="o">.</span><span class="n">prevalence</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">wild_pen</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">muta_pen</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span>
               <span class="n">args</span><span class="o">.</span><span class="n">inherit_mode</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_max</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_inc</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units successfully converted to </span><span class="si">{}</span><span class="s1"> format</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span>\
                <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">format_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">flush</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">skipped_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="c1"># FIXME: perhaps we need to rephrase this message?</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> region - family pairs skipped&#39;</span><span class="o">.</span>\
                    <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">skipped_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Archiving </span><span class="si">{}</span><span class="s1"> format to directory [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">env</span><span class="o">.</span><span class="n">cache_dir</span><span class="p">))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">arcroot</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                    <span class="n">source_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">mkpath</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">outdir</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">run_linkage</span><span class="p">:</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">setID</span><span class="p">(</span><span class="s1">&#39;analysis&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">vanilla</span> <span class="ow">and</span> <span class="n">cache</span><span class="o">.</span><span class="n">check</span><span class="p">():</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Loading linkage analysis result from archive ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">target_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;heatmap&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Running linkage analysis ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">run_linkage</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">blueprint</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_inc</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_max</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">output_limit</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Linkage analysis succesfully performed for </span><span class="si">{:,d}</span><span class="s1"> units</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span>\
                <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">run_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">flush</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">makeped_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &quot;makeped&quot; runtime errors occurred&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">makeped_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">pedcheck_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &quot;pedcheck&quot; runtime errors occurred&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">pedcheck_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">unknown_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &quot;unknown&quot; runtime errors occurred&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unknown_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">mlink_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &quot;mlink&quot; runtime errors occurred&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">mlink_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">arcroot</span> <span class="o">=</span> <span class="s1">&#39;heatmap&#39;</span><span class="p">,</span> <span class="n">source_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;heatmap&#39;</span><span class="p">),</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">html</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">theta_inc</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_max</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">output_limit</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Saving data to [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">)))</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">target_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 3,479 samples found in [/mnt/mfs/statgen/yin/Github/linkage/SEQpy3/data/first1000snp_full_samples.vcf.gz]</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 7 samples found in FAM file but not in VCF file:
28_9_101, 28_9_100, 28_9_186, 1036_2, 22_1_20, 1036_1, 22_1_10</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 3,461 samples in VCF file will be ignored due to absence in FAM file</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: Loading marker map from [data/genemap.hg38.txt] ...</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 3 families with a total of 18 samples will be scanned for 28,325 pre-defined units</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 0 units processed {5.65%} ...</span>                                       </pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>in Haplotype</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 0 units processed {19.76%} ...</span>                                      </pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Estimating allele frequencies... [using maximum likelihood]0
   V8-13273 V12-13302 V17-13417 V22-13687 

V8-13273: 0 0.707106 0.292894 
total familyCount:1
V12-13302: 0 0.75 0.25 
total familyCount:1
V17-13417: 0 0.75 0.25 
total familyCount:1
V22-13687: 0 0.75 0.25 
total familyCount:1
in Haplotype</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 0 units processed {14.12%} ...</span>                                      </pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>in Haplotype</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 0 units processed {11.29%} ...</span>                                      </pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>


running familyrunning family running family1036  
10361036
running familyrunning familyrunning family
 22_1 
22_1 running family
 running family22_1Estimating allele frequencies... [using maximum likelihood]0
   V8-13273 V12-13302 V17-13417 V22-13687 

V8-13273: 0 0.707106 0.292894 
total familyCount:1
V12-13302: 0 0.75 0.25 
total familyCount:1
V17-13417: 0 0.75 0.25 
total familyCount:1
V22-13687: 0 0.75 0.25 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0
   V4-17385 V8-17407 

V4-17385: 0 1 
total familyCount:1
V8-17407: 0 0.5 0.5 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0
   V8-13273 V15-13380 V17-13417 

V8-13273: 0 0.744757 0.255243 
total familyCount:1
V15-13380: 0 0.744757 0.255243 
total familyCount:1
V17-13417: 0 0.744757 0.255243 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0
   V4-17385 V5-17398 V8-17407 

V4-17385: 0 0.739454 0.260546 
total familyCount:1
V5-17398: 0 0.744757 0.255243 
total familyCount:1
V8-17407: 0 0.744757 0.255243 
total familyCount:1

28_9running family
 28_9 28_9

</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 3 units processed {36.70%} ...</span>                                      </pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Estimating allele frequencies... [using maximum likelihood]0
   V8-13273 V15-13380 V17-13417 

V8-13273: 0 0.744757 0.255243 
total familyCount:1
V15-13380: 0 0.744757 0.255243 
total familyCount:1
V17-13417: 0 0.744757 0.255243 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0
   V3-17379 V4-17385 V9-17408 

V3-17379: 0 0.824706 0.175294 
total familyCount:1
V4-17385: 0 0.5 0.5 
total familyCount:1
V9-17408: 0 0.824706 0.175294 
total familyCount:1
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 3 units processed {73.39%} ...</span>                                      </pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>in Haplotype
running family 1036
running family 22_1</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 3 units processed {79.04%} ...</span></pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
running family </pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 3 units processed {81.86%} ...</span></pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>28_9</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 3 units processed {81.86%} ...</span></pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 4 units processed {93.15%} ...</span>                                      </pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Estimating allele frequencies... [using maximum likelihood]0
   V3-14464 V8-14653 V18-14907 V19-14930 V20-14933 V40-16103 V50-16378 
   V55-16487 V69-17147 V79-17358 V85-17385 V89-17407 V124-17697 V151-17928 
   V152-17929 V159-20184 V160-20191 V162-20212 V165-20227 V169-20235 
   V171-20250 V178-20316 V180-20485 V182-20522 V184-20547 V194-29368 

V3-14464: 0 0.75 0.25 
total familyCount:1
V8-14653: 0 0.75 0.25 
total familyCount:1
V18-14907: 0 0.5 0.5 
total familyCount:1
V19-14930: 0 0.5 0.5 
total familyCount:1
V20-14933: 0 1 
total familyCount:1
V40-16103: 0 0.707106 0.292894 
total familyCount:1
V50-16378: 0 0.5 0.5 
total familyCount:1
V55-16487: 0 0.75 0.25 
total familyCount:1
V69-17147: 0 0.5 0.5 
total familyCount:1
V79-17358: 0 1 
total familyCount:1
V85-17385: 0 1 
total familyCount:1
V89-17407: 0 0.5 0.5 
total familyCount:1
V124-17697: 0 0.5 0.5 
total familyCount:1
V151-17928: 0 0.5 0.5 
total familyCount:1
V152-17929: 0 0.5 0.5 
total familyCount:1
V159-20184: 0 0.5 0.5 
total familyCount:1
V160-20191: 0 1 
total familyCount:1
V162-20212: 0 1 
total familyCount:1
V165-20227: 0 1 
total familyCount:1
V169-20235: 0 1 
total familyCount:1
V171-20250: 0 1 
total familyCount:1
V178-20316: 0 1 
total familyCount:1
V180-20485: 0 1 
total familyCount:1
V182-20522: 0 1 
total familyCount:1
V184-20547: 0 0.75 0.25 
total familyCount:1
V194-29368: 0 1 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0
   V3-14464 V8-14653 V10-14677 V18-14907 V19-14930 V40-16103 V50-16378 
   V55-16487 V69-17147 V80-17365 V85-17385 V86-17398 V89-17407 V95-17479 
   V108-17559 V112-17589 V124-17697 V129-17722 V131-17746 V142-17829 
   V155-19190 V159-20184 V160-20191 V162-20212 V165-20227 V169-20235 
   V171-20250 V178-20316 V184-20547 

V3-14464: 0 0.739454 0.260546 
total familyCount:1
V8-14653: 0 0.707103 0.292897 
total familyCount:1
V10-14677: 0 0.739454 0.260546 
total familyCount:1
V18-14907: 0 0.707103 0.292897 
total familyCount:1
V19-14930: 0 0.728713 0.271287 
total familyCount:1
V40-16103: 0 0.5 0.5 
total familyCount:1
V50-16378: 0 0.5 0.5 
total familyCount:1
V55-16487: 0 0.744757 0.255243 
total familyCount:1
V69-17147: 0 0.744757 0.255243 
total familyCount:1
V80-17365: 0 0.744757 0.255243 
total familyCount:1
V85-17385: 0 0.739454 0.260546 
total familyCount:1
V86-17398: 0 0.744757 0.255243 
total familyCount:1
V89-17407: 0 0.744757 0.255243 
total familyCount:1
V95-17479: 0 0.744757 0.255243 
total familyCount:1
V108-17559: 0 0.744757 0.255243 
total familyCount:1
V112-17589: 0 0.744757 0.255243 
total familyCount:1
V124-17697: 0 0.739454 0.260546 
total familyCount:1
V129-17722: 0 0.744757 0.255243 
total familyCount:1
V131-17746: 0 0.739454 0.260546 
total familyCount:1
V142-17829: 0 0.744757 0.255243 
total familyCount:1
V155-19190: 0 0.739454 0.260546 
total familyCount:1
V159-20184: 0 0.744757 0.255243 
total familyCount:1
V160-20191: 0 0.744757 0.255243 
total familyCount:1
V162-20212: 0 0.744757 0.255243 
total familyCount:1
V165-20227: 0 0.744757 0.255243 
total familyCount:1
V169-20235: 0 0.744757 0.255243 
total familyCount:1
V171-20250: 0 0.739454 0.260546 
total familyCount:1
V178-20316: 0 0.739454 0.260546 
total familyCount:1
V184-20547: 0 0.739454 0.260546 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0
   V3-14464 V5-14470 V8-14653 V10-14677 V18-14907 V19-14930 V34-16068 
   V40-16103 V50-16378 V84-17379 V85-17385 V90-17408 V105-17519 V107-17556 
   V116-17614 V155-19190 V158-20166 V160-20191 V162-20212 V165-20227 
   V166-20227 V168-20231 V169-20235 V171-20250 V174-20254 V178-20316 
   V183-20545 V184-20547 V194-29368 

V3-14464: 0 0.646634 0.353366 
total familyCount:1
V5-14470: 0 0.824706 0.175294 
total familyCount:1
V8-14653: 0 0.452863 0.547137 
total familyCount:1
V10-14677: 0 0.656432 0.343568 
total familyCount:1
V18-14907: 0 0.5 0.5 
total familyCount:1
V19-14930: 0 0.628665 0.371335 
total familyCount:1
V34-16068: 0 0.5 0.5 
total familyCount:1
V40-16103: 0 0.628667 0.371333 
total familyCount:1
V50-16378: 0 0.617751 0.382249 
total familyCount:1
V84-17379: 0 0.824706 0.175294 
total familyCount:1
V85-17385: 0 0.5 0.5 
total familyCount:1
V90-17408: 0 0.824706 0.175294 
total familyCount:1
V105-17519: 0 0.824706 0.175294 
total familyCount:1
V107-17556: 0 0.820231 0.179769 
total familyCount:1
V116-17614: 0 0.824706 0.175294 
total familyCount:1
V155-19190: 0 0.6 0.4 
total familyCount:1
V158-20166: 0 0.628665 0.371335 
total familyCount:1
V160-20191: 0 0.628665 0.371335 
total familyCount:1
V162-20212: 0 0.628665 0.371335 
total familyCount:1
V165-20227: 0 0.656432 0.343568 
total familyCount:1
V166-20227: 0 0.646634 0.353366 
total familyCount:1
V168-20231: 0 0.811255 0.188745 
total familyCount:1
V169-20235: 0 0.824706 0.175294 
total familyCount:1
V171-20250: 0 0.628665 0.371335 
total familyCount:1
V174-20254: 0 0.824706 0.175294 
total familyCount:1
V178-20316: 0 0.628665 0.371335 
total familyCount:1
V183-20545: 0 0.820231 0.179769 
total familyCount:1
V184-20547: 0 0.617751 0.382249 
total familyCount:1
V194-29368: 0 0.656432 0.343568 
total familyCount:1
                                                                      </pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 4 units processed {99.94%} ...</span>                                      </pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Estimating allele frequencies... [using maximum likelihood]0
   V8-13273 V12-13302 V17-13417 V22-13687 

V8-13273: 0 0.707106 0.292894 
total familyCount:1
V12-13302: 0 0.75 0.25 
total familyCount:1
V17-13417: 0 0.75 0.25 
total familyCount:1
V22-13687: 0 0.75 0.25 
total familyCount:1
Estimating allele frequencies... [using maximum likelihood]0
   V8-13273 V15-13380 V17-13417 

V8-13273: 0 0.744757 0.255243 
total familyCount:1
V15-13380: 0 0.744757 0.255243 
total familyCount:1
V17-13417: 0 0.744757 0.255243 
total familyCount:1
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 4 units (from 256 variants) processed; 24 Mendelian inconsistencies and 116 recombination events handled</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 28,321 units ignored due to absence in VCF file</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: Archiving regional marker data to directory [/mnt/mfs/statgen/yin/Github/linkage/SEQpy3/cache]</span>
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>merlin
16
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 4 units will be converted to MERLIN format</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: 4 units successfully converted to MERLIN format</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: Archiving MERLIN format to directory [/mnt/mfs/statgen/yin/Github/linkage/SEQpy3/cache]</span>
<span class="ansi-green-intense-fg ansi-black-bg ansi-bold">MESSAGE: Saving data to [/mnt/mfs/statgen/yin/Github/linkage/SEQpy3/LINKAGE]</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">args</span><span class="o">.</span><span class="n">run_linkage</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">region</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;69090&#39;</span><span class="p">,</span> <span class="s1">&#39;70008&#39;</span><span class="p">,</span> <span class="s1">&#39;OR4F5&#39;</span><span class="p">,</span> <span class="s1">&#39;4.866641545668504e-06&#39;</span><span class="p">,</span> <span class="s1">&#39;6.181823219621424e-06&#39;</span><span class="p">,</span> <span class="s1">&#39;3.6135725636621673e-06&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">extractor</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
<span class="n">maker</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">haplotypes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">mafs</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1">##Per fam per variant</span>
<span class="n">uniq_vars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">exclude_vars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">varnames</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">recombPos</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">extractor</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">_MarkerMaker__Haplotype</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">,</span><span class="n">recombPos</span><span class="p">,</span><span class="n">uniq_vars</span><span class="p">,</span><span class="n">exclude_vars</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">haplotypes</span><span class="p">[</span><span class="s1">&#39;668&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">_MarkerMaker__ClusterByLD</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">varnames</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">_MarkerMaker__CodeHaplotypes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">,</span> <span class="p">[])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clusters</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">if</span> <span class="n">clusters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">clusters_idx</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">clusters_idx</span> <span class="o">=</span> <span class="p">[[[]]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">]</span>
<span class="n">maker</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">haplotypes</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[[</span><span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">],</span> <span class="n">clusters_idx</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">ld</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[[</span><span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">varnames</span><span class="p">[</span><span class="s1">&#39;668&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mafs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Test-clusterbyld">Test clusterbyld<a class="anchor-link" href="#Test-clusterbyld"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">freq</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">variants</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">haplotypes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">mafs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">varnames</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">maker</span><span class="o">.</span><span class="n">_MarkerMaker__Haplotype</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;V</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variants</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">item</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">item</span> <span class="o">=</span><span class="s1">&#39;1036&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">varnames</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">positions</span><span class="p">,</span> <span class="n">vcf_mafs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamVariants</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">varnames</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">item</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">varnames</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">haplotyper</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">recombPos</span><span class="o">=</span><span class="p">{}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">positions</span><span class="p">,</span> <span class="n">vcf_mafs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamVariants</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span><span class="p">)</span>
<span class="n">recombPos</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
<span class="n">var_for_haplotype</span><span class="o">=</span><span class="p">[]</span>
<span class="n">positions_for_haplotype</span><span class="o">=</span><span class="p">[]</span>
<span class="n">output_sample</span><span class="o">=</span><span class="p">[]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">gnomAD_estimate</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">freq</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">positions</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">var_for_haplotype</span><span class="o">=</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
<span class="n">positions_for_haplotype</span><span class="o">=</span><span class="n">positions</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">item</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">famid</span> <span class="o">=</span><span class="n">item</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sorted_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">S_no_parents</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">is_founder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">famid</span><span class="p">])</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">graph</span><span class="p">[</span><span class="n">famid</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">S_no_parents</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">famid</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">graph</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">while</span><span class="p">(</span><span class="n">S_no_parents</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">S_no_parents</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">sorted_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">offsprings</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">offsprings</span><span class="p">:</span>
        <span class="n">father</span><span class="p">,</span> <span class="n">mother</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">get_parents</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">father</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span> <span class="ow">and</span> <span class="n">mother</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="n">S_no_parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="k">if</span> <span class="n">graph</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;There is a loop in the pedigree: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">sorted_names</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">tfam</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">sort_family</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">output_sample</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    <span class="n">last_ele</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">output_sample</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">output_sample</span><span class="p">[</span><span class="n">last_ele</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">person</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">var_for_haplotype</span><span class="p">:</span>
            <span class="n">idx</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">marker</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">output_sample</span><span class="p">[</span><span class="n">last_ele</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">genotype_all</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_sample</span><span class="p">[</span><span class="n">last_ele</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;00&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_for_haplotype</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">sort_family</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">output_sample</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">:])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">haplotypes</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp_log_output</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
<span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">maker</span><span class="o">.</span><span class="n">haplotyper</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="n">var_for_haplotype</span><span class="p">,</span> <span class="n">positions_for_haplotype</span><span class="p">,</span> <span class="n">output_sample</span><span class="p">,</span> <span class="n">maker</span><span class="o">.</span><span class="n">rsq</span><span class="p">,</span> <span class="n">tmp_log_output</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">var_for_haplotype</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">positions_for_haplotype</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">haplotypes</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">haplotypes</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">var_for_haplotype</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">positions_for_haplotype</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">output_sample</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">rsq</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">haplotypes</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">hap_idx</span><span class="p">,</span><span class="n">haploid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">vidx</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">haploid</span><span class="p">[</span><span class="mi">2</span><span class="p">:]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">vidx</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">postvar_name</span><span class="o">=</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">vidx</span><span class="p">]</span>
            <span class="n">prevar_name</span><span class="o">=</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">vidx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">recomb_pair</span> <span class="o">=</span> <span class="p">(</span><span class="n">prevar_name</span><span class="p">,</span><span class="n">postvar_name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;run this&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">recombPos</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">recomb_pair</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hap_idx</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">recombPos</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">recomb_pair</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">hap_idx</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">haploid</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">var</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">haplotypes</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mafs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">varnames</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">recombPos</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">uniq_vars</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exclude_vars</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">rsq</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">person</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mafs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mafs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># either use privided MAF or computer MAF</span>
<span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">vcf_mafs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;run this&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mafs</span><span class="p">:</span>
            <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcf_mafs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># count founder alleles</span>
    <span class="k">for</span> <span class="n">hap</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">is_founder</span><span class="p">(</span><span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">idxv</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mafs</span><span class="p">:</span>
                <span class="c1"># [#alt, #haplotypes]</span>
                <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">gt</span> <span class="o">=</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gt</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
                <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gtconv</span><span class="p">[</span><span class="n">gt</span><span class="p">]</span>
                <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mafs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vcf_mafs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">mafs</span><span class="p">[</span><span class="s1">&#39;V0-176659933&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">maf_cutoff</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exclude_vars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mafs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">maker</span><span class="o">.</span><span class="n">maf_cutoff</span><span class="p">:</span>
        <span class="n">exclude_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">listit</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
        <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> \
          <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">:])</span> <span class="k">if</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_vars</span><span class="p">]</span>
    <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_vars</span><span class="p">]</span>
    <span class="c1"># handle trivial data</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missings</span>
        <span class="k">del</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp_exclude_vars</span><span class="o">=</span><span class="n">exclude_vars</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp_exclude_vars</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">recombPos</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">uniq_vars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">i</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
<span class="k">for</span> <span class="n">tmp_var</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">tmp_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uniq_vars</span><span class="p">:</span>
             <span class="n">uniq_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_var</span><span class="p">)</span>
<span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_exclude_vars</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">genotype_all</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">varnames</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span> <span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">]):</span>
        <span class="c1"># all families have only one variant</span>
        <span class="n">maker</span><span class="o">.</span><span class="n">_MarkerMaker__AssignSNVHaplotypes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;run this&#39;</span><span class="p">)</span>
        <span class="c1"># calculate LD clusters using founder haplotypes</span>
        <span class="n">clusters</span> <span class="o">=</span> <span class="n">maker</span><span class="o">.</span><span class="n">_MarkerMaker__ClusterByLD</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">varnames</span><span class="p">)</span>
        <span class="c1"># recoding the genotype of the region</span>
        <span class="n">maker</span><span class="o">.</span><span class="n">_MarkerMaker__CodeHaplotypes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">,</span> <span class="n">clusters</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clusters</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="def-__ClusterByLD(self,-data,-haplotypes,-varnames):">def __ClusterByLD(self, data, haplotypes, varnames):<a class="anchor-link" href="#def-__ClusterByLD(self,-data,-haplotypes,-varnames):"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">haplotypes</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>OrderedDict([(&#39;1&#39;,
              [[&#39;1&#39;, &#39;I:1&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;],
               [&#39;1&#39;, &#39;I:1&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2:&#39;],
               [&#39;1&#39;, &#39;I:2&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2:&#39;, &#39;2:&#39;],
               [&#39;1&#39;, &#39;I:2&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;],
               [&#39;1&#39;, &#39;II:3&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2|&#39;, &#39;2|&#39;],
               [&#39;1&#39;, &#39;II:3&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;],
               [&#39;1&#39;, &#39;II:2&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2|&#39;, &#39;2|&#39;],
               [&#39;1&#39;, &#39;II:2&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;],
               [&#39;1&#39;, &#39;II:1&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2|&#39;, &#39;2|&#39;],
               [&#39;1&#39;, &#39;II:1&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;2|&#39;],
               [&#39;1&#39;, &#39;II:4&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2\\&#39;, &#39;2|&#39;],
               [&#39;1&#39;, &#39;II:4&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1\\&#39;, &#39;2|&#39;]]),
             (&#39;2&#39;,
              [[&#39;2&#39;, &#39;I:A&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2:&#39;],
               [&#39;2&#39;, &#39;I:A&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;2:&#39;],
               [&#39;2&#39;, &#39;I:B&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;2:&#39;, &#39;1:&#39;],
               [&#39;2&#39;, &#39;I:B&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;],
               [&#39;2&#39;, &#39;II:D&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;1:&#39;],
               [&#39;2&#39;, &#39;II:D&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;2:&#39;],
               [&#39;2&#39;, &#39;II:C&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1:&#39;],
               [&#39;2&#39;, &#39;II:C&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;2:&#39;],
               [&#39;2&#39;, &#39;II:B&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1:&#39;],
               [&#39;2&#39;, &#39;II:B&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;2:&#39;],
               [&#39;2&#39;, &#39;II:A&#39;, &#39;2:&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;2|&#39;, &#39;1:&#39;],
               [&#39;2&#39;, &#39;II:A&#39;, &#39;1:&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;1|&#39;, &#39;2:&#39;]])])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">r2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">markers</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gtt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">founder_haplotypes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">markers</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">varnames</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]))</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">ihap</span><span class="p">,</span> <span class="n">hap</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">is_founder</span><span class="p">(</span><span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">continue</span>
        <span class="n">gt</span> <span class="o">=</span> <span class="p">[</span><span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;?&#39;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">markers</span><span class="p">]</span>
        <span class="n">founder_haplotypes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ihap</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">])))</span>
        <span class="n">gtt</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ihap</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">]])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">founder_haplotypes</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;I:1-0&#39;, &#39;1111111&#39;),
 (&#39;I:1-1&#39;, &#39;2211112&#39;),
 (&#39;I:2-0&#39;, &#39;2211122&#39;),
 (&#39;I:2-1&#39;, &#39;1111111&#39;),
 (&#39;I:A-0&#39;, &#39;1111112&#39;),
 (&#39;I:A-1&#39;, &#39;1111112&#39;),
 (&#39;I:B-0&#39;, &#39;2222221&#39;),
 (&#39;I:B-1&#39;, &#39;1111111&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">egglib</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">matrix_LD</span><span class="p">(</span><span class="n">Align</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">founder_haplotypes</span><span class="p">,</span><span class="n">egglib</span><span class="o">.</span><span class="n">Alphabet</span><span class="p">(</span><span class="n">cat</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">,</span><span class="n">expl</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">],</span><span class="n">miss</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">)),(</span><span class="s1">&#39;rsq&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>([0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0],
 [[None],
  [1.0, None],
  [0.2380952380952381, 0.2380952380952381, None],
  [0.2380952380952381, 0.2380952380952381, 1.0, None],
  [0.2380952380952381, 0.2380952380952381, 1.0, 1.0, None],
  [0.5555555555555556,
   0.5555555555555556,
   0.42857142857142866,
   0.42857142857142866,
   0.42857142857142866,
   None],
  [0.06666666666666665,
   0.06666666666666665,
   0.14285714285714282,
   0.14285714285714282,
   0.14285714285714282,
   0.0,
   None]])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gtt</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[[&#39;I:1-0&#39;, [&#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;]],
 [&#39;I:1-1&#39;, [&#39;2&#39;, &#39;2&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;2&#39;]],
 [&#39;I:2-0&#39;, [&#39;2&#39;, &#39;2&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;2&#39;, &#39;2&#39;]],
 [&#39;I:2-1&#39;, [&#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;]],
 [&#39;I:A-0&#39;, [&#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;2&#39;]],
 [&#39;I:A-1&#39;, [&#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;2&#39;]],
 [&#39;I:B-0&#39;, [&#39;2&#39;, &#39;2&#39;, &#39;2&#39;, &#39;2&#39;, &#39;2&#39;, &#39;2&#39;, &#39;1&#39;]],
 [&#39;I:B-1&#39;, [&#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;]]]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">egglib</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gt</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;, &#39;1:&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ldi</span><span class="p">,</span><span class="n">ld</span> <span class="o">=</span> <span class="n">egglib</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">matrix_LD</span><span class="p">(</span><span class="n">Align</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">gtt</span><span class="p">,</span><span class="n">egglib</span><span class="o">.</span><span class="n">Alphabet</span><span class="p">(</span><span class="n">cat</span><span class="o">=</span><span class="s1">&#39;char&#39;</span><span class="p">,</span><span class="n">expl</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">],</span><span class="n">miss</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">)),(</span><span class="s1">&#39;rsq&#39;</span><span class="p">))</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ldi</span><span class="p">)):</span>
    <span class="n">block</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ldi</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">ld</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">maker</span><span class="o">.</span><span class="n">r2</span><span class="p">:</span>
            <span class="n">block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="p">[[</span><span class="n">markers</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">connected_components</span><span class="p">(</span><span class="n">blocks</span><span class="p">))]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clusters</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[[&#39;V0-89984370&#39;, &#39;V1-89984604&#39;], [&#39;V2-89984739&#39;, &#39;V3-89985940&#39;, &#39;V4-89986608&#39;]]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">varnames</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;1&#39;: [&#39;V0-89984370&#39;,
  &#39;V1-89984604&#39;,
  &#39;V2-89984739&#39;,
  &#39;V3-89985940&#39;,
  &#39;V4-89986608&#39;,
  &#39;V5-89986760&#39;,
  &#39;V6-89987201&#39;],
 &#39;2&#39;: [&#39;V0-89984370&#39;,
  &#39;V1-89984604&#39;,
  &#39;V2-89984739&#39;,
  &#39;V3-89985940&#39;,
  &#39;V4-89986608&#39;,
  &#39;V5-89986760&#39;,
  &#39;V6-89987201&#39;]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ld</span> <span class="o">=</span> <span class="n">Align</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">founder_haplotypes</span><span class="p">)</span><span class="o">.</span><span class="n">matrixLD</span><span class="p">(</span><span class="n">validCharacters</span><span class="o">=</span><span class="s2">&quot;12&quot;</span><span class="p">)[</span><span class="s2">&quot;r2&quot;</span><span class="p">]</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ld</span><span class="p">:</span>
    <span class="n">block</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ld</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">ld</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">maker</span><span class="o">.</span><span class="n">r2</span><span class="p">:</span>
            <span class="n">block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
<span class="c1"># get LD clusters</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="p">[[</span><span class="n">markers</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">connected_components</span><span class="p">(</span><span class="n">blocks</span><span class="p">))]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ld</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">block</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">connected_components</span><span class="p">([]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">connected_components</span><span class="p">(</span><span class="n">blocks</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clusters</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="def-__CodeHaplotypes(self,-data,-haplotypes,-mafs,-varnames,-clusters):">def __CodeHaplotypes(self, data, haplotypes, mafs, varnames, clusters):<a class="anchor-link" href="#def-__CodeHaplotypes(self,-data,-haplotypes,-mafs,-varnames,-clusters):"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">clusters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">clusters_idx</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">clusters_idx</span> <span class="o">=</span> <span class="p">[[[]]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clusters_idx</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">haplotypes</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[[</span><span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">],</span> <span class="n">clusters_idx</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">maker</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">GetHaplotypes</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="c1"># this sample is not in VCF file. Every variant site should be missing</span>
        <span class="c1"># they have to be skipped for now</span>
        <span class="k">continue</span>
    <span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
        
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
    <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">maker</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">GetAlleleFrequencies</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>
                      <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">maf</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">_MarkerMaker__FormatHaplotypes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">recombPos</span><span class="p">,</span><span class="n">varnames</span><span class="p">,</span><span class="n">uniq_vars</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;I:1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">famvaridx</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">haplotypes</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">):</span>
            <span class="c1"># when only wild-type haplotypes are present in a family, still code them instead of ignoring the family</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
                <span class="n">pop</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span>
                    <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">total_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span>
                <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">total_mafs</span>
            <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                <span class="n">tmp_person</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">,</span> <span class="n">person</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;00&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]:</span>
                    <span class="n">tmp_person</span><span class="o">+=</span><span class="p">[</span><span class="s1">&#39;?:&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp_person</span><span class="o">+=</span><span class="p">[</span><span class="s1">&#39;1:&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_person</span><span class="p">)</span>
                <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_person</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
            <span class="n">nonvar_hap_flag</span><span class="o">=</span><span class="kc">False</span>
            <span class="c1">#determine if wild-type haplotype is present in a family</span>
            <span class="k">for</span> <span class="n">hap</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                <span class="n">tmp_genes</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">tmpa</span> <span class="ow">in</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="s1">&#39;A&#39;</span> <span class="ow">in</span> <span class="n">tmpa</span> <span class="ow">or</span> <span class="s1">&#39;B&#39;</span> <span class="ow">in</span> <span class="n">tmpa</span><span class="p">:</span>
                        <span class="n">tmp_genes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpa</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tmp_genes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">tmp_genes</span><span class="p">)</span><span class="o">==</span><span class="nb">set</span><span class="p">([</span><span class="s1">&#39;1&#39;</span><span class="p">]):</span>
                    <span class="c1">#non variant haplotype</span>
                    <span class="n">nonvar_hap_flag</span><span class="o">=</span><span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nonvar_hap_flag</span><span class="p">:</span>
                <span class="c1">#if family don&#39;t have wild-type haplotype, add a fake one to ensure correct coding</span>
                <span class="n">var_num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                <span class="n">fake_person</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;FAKEPERSON&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;1:&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">var_num</span>
                <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fake_person</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">hidx</span><span class="p">,</span><span class="n">hap</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">missing_persons</span><span class="p">:</span>
                    <span class="n">missing_person</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="p">,</span><span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;?:&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                    <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">hidx</span><span class="p">]</span><span class="o">=</span><span class="n">missing_person</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">clusters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">clusters_idx</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">clusters_idx</span> <span class="o">=</span> <span class="p">[[[]]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hap</span><span class="si">{0}</span><span class="se">\t</span><span class="si">{1}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]),</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">haplotypes</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[[</span><span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">],</span> <span class="n">clusters_idx</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">clusters</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Family LD clusters: &quot;</span><span class="p">,</span> <span class="n">clusters_idx</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>
    <span class="c1"># line: [fid, sid, hap1, hap2]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">GetHaplotypes</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="c1"># this sample is not in VCF file. Every variant site should be missing</span>
            <span class="c1"># they have to be skipped for now</span>
            <span class="k">continue</span>
        <span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span> <span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="c1">#sub-region count for each sample individual</span>
        <span class="n">superMarkerCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">superMarkerCount</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">t_Marker</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">superMarkerCount</span><span class="p">):</span>
            <span class="n">t_pat1</span><span class="o">=</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="n">t_Marker</span><span class="p">]</span>
            <span class="n">t_pat2</span><span class="o">=</span><span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="n">t_Marker</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">t_pat1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">t_Marker</span><span class="p">]:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">t_Marker</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_pat1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">t_pat2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">t_Marker</span><span class="p">]:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">patterns</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">t_Marker</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_pat2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># get MAF</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">famvaridx</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span><span class="o">=</span><span class="p">([</span><span class="s1">&#39;0&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span><span class="p">,[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">superMarkerCount</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coder</span><span class="o">.</span><span class="n">GetAlleleFrequencies</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">continue</span>
        <span class="n">data</span><span class="o">.</span><span class="n">varnames_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="n">wt_maf</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wt_maf</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">wt_maf</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wt_maf</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">wt_maf</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span>
        <span class="n">tmp_data_maf</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">tmp_data_maf</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">tmp_ratio</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">wt_maf</span><span class="p">)</span>
                    <span class="n">tmp_list</span><span class="o">=</span><span class="p">[</span><span class="n">wt_maf</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">tmp_ratio</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">tmp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">wt_maf</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">tmpv</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                            <span class="n">tmp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpv</span><span class="o">/</span><span class="n">tmp_ratio</span><span class="p">)</span>
                    <span class="n">tmp_data_maf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">tmp_list</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp_data_maf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">tmp_data_maf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;marker freqs = &quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">maf</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">:</span>
    <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">positions</span><span class="p">,</span> <span class="n">vcf_mafs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamVariants</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missings</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># haplotyping</span>
    <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">env</span><span class="o">.</span><span class="n">prephased</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">stdoutRedirect</span><span class="p">(</span><span class="n">to</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span><span class="p">):</span>
                <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">haplotyper</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span>
                                                       <span class="nb">sorted</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__PedToHaplotype</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># C++ haplotyping implementation failed</span>
        <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
            <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># either use privided MAF or computer MAF</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">vcf_mafs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mafs</span><span class="p">:</span>
                <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcf_mafs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># count founder alleles</span>
        <span class="k">for</span> <span class="n">hap</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">is_founder</span><span class="p">(</span><span class="n">hap</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">idxv</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mafs</span><span class="p">:</span>
                    <span class="c1"># [#alt, #haplotypes]</span>
                    <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">gt</span> <span class="o">=</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="n">hap</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">idxv</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">gt</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
                    <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gtconv</span><span class="p">[</span><span class="n">gt</span><span class="p">]</span>
                    <span class="n">mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">maker</span><span class="o">.</span><span class="n">haplotyper</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">aa</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
    <span class="n">tmp1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
    <span class="c1">#tmp2.apply(dd)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">variants</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">aa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data1</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="_MarkerMaker__Haplotype">_MarkerMaker__Haplotype<a class="anchor-link" href="#_MarkerMaker__Haplotype"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">dd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">haplotypes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">mafs</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1">##Per fam per variant</span>
<span class="n">uniq_vars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">exclude_vars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">varnames</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">recombPos</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">markers</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}
def __Haplotype(self, data, haplotypes, mafs, varnames,recombPos,uniq_vars,exclude_vars):
'''genetic haplotyping. haplotypes stores per family data'''
# FIXME: it is SWIG's (2.0.12) fault not to properly destroy the object "Pedigree" in "Execute()"
# So there is a memory leak here which I tried to partially handle on C++
#
# Per family haplotyping
#
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;V</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variants</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp_mafs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
    <span class="c1">## if families are from different populations</span>
    <span class="c1">## estimate MAF by different population</span>
    <span class="n">fam_to_analyze</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">fam</span><span class="p">,</span><span class="n">pop</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">pop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fam_to_analyze</span><span class="p">:</span>
            <span class="n">fam_to_analyze</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">fam</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fam_to_analyze</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fam</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">count</span><span class="p">:</span>
    <span class="c1">## estimate MAF by counting founder alleles</span>
    <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
        <span class="n">local_count_mafs</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">fam_to_analyze</span><span class="p">:</span>
            <span class="n">local_count_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">=</span><span class="n">tmp1</span><span class="o">.</span><span class="n">_MarkerMaker__computefounderfreq</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">fam_to_analyze</span><span class="p">[</span><span class="n">pop</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">local_count_mafs</span><span class="o">=</span><span class="n">tmp1</span><span class="o">.</span><span class="n">_MarkerMaker__computefounderfreq</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;run here&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">local_count_mafs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">mle</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">mle</span><span class="p">:</span>
    <span class="c1">## estimate MLE allele frequency using all fam</span>
    <span class="n">local_mle_mafs</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">fam_to_analyze</span><span class="p">:</span>
            <span class="n">local_mle_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">markers_to_analyze</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">pos_all</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">markers_analyzed</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">if</span> <span class="n">pop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">mle_mafs</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">mle_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">tmpv</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">mle_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">]:</span>
                    <span class="n">markers_analyzed</span><span class="p">[</span><span class="n">tmpv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">mle_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">][</span><span class="n">tmpv</span><span class="p">]</span>
            <span class="n">output_log</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span><span class="o">+</span><span class="s2">&quot;AF_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">.log&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span><span class="n">tmp1</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">popidx</span><span class="o">=</span><span class="n">tmp1</span><span class="o">.</span><span class="n">af_info</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span>
            <span class="n">variants_in_fams</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fam_to_analyze</span><span class="p">[</span><span class="n">pop</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">tmpvar</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamVariants</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">tmpvar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">variants_in_fams</span><span class="p">:</span>
                        <span class="n">variants_in_fams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpvar</span><span class="p">)</span>
            <span class="n">variants_in_fams</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">variants_in_fams</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">variants_in_fams</span><span class="p">:</span>
                <span class="n">idx</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">variants</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">popidx</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="n">markers_analyzed</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="c1">#if variant has been analyzed</span>
                        <span class="n">vname</span><span class="o">=</span><span class="s2">&quot;V</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">local_mle_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">=</span><span class="n">markers_analyzed</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1">#variant not analyzed before</span>
                        <span class="n">markers_to_analyze</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;V</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">pos_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tmp_mle_mafs</span><span class="o">=</span><span class="n">tmp1</span><span class="o">.</span><span class="n">_MarkerMaker__getMLEfreq</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">markers_to_analyze</span><span class="p">,</span> <span class="n">pos_all</span><span class="p">,</span> <span class="n">fam_to_analyze</span><span class="p">[</span><span class="n">pop</span><span class="p">],</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">rsq</span><span class="p">,</span> <span class="n">output_log</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_mle_mafs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">vname</span><span class="p">,</span><span class="n">vmaf</span> <span class="ow">in</span> <span class="n">tmp_mle_mafs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">mle_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">=</span><span class="n">vmaf</span>
                    <span class="n">local_mle_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">=</span><span class="n">vmaf</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#Homogeneous families</span>
        <span class="n">markers_to_analyze</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">pos_all</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">markers_analyzed</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">tmpv</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">mle_mafs</span><span class="p">:</span>
            <span class="n">markers_analyzed</span><span class="p">[</span><span class="n">tmpv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">mle_mafs</span><span class="p">[</span><span class="n">tmpv</span><span class="p">]</span>
        <span class="n">variants_in_fams</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">var_per_fam</span><span class="o">=</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">tmpvar</span><span class="p">)</span> <span class="k">for</span> <span class="n">tmpvar</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamVariants</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span>
            <span class="n">variants_in_fams</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">var_per_fam</span><span class="o">+</span><span class="n">variants_in_fams</span><span class="p">))</span>
        <span class="n">variants_in_fams</span><span class="o">=</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">tmpvar</span><span class="p">)</span> <span class="k">for</span> <span class="n">tmpvar</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">variants_in_fams</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">variants_in_fams</span><span class="p">:</span>
            <span class="n">idx</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">variants</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">af_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="n">markers_analyzed</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1">#if variant has been analyzed</span>
                    <span class="n">vname</span><span class="o">=</span><span class="s2">&quot;V</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">local_mle_mafs</span><span class="p">[</span><span class="n">vname</span><span class="p">]</span><span class="o">=</span><span class="n">markers_analyzed</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#variant not analyzed before</span>
                    <span class="n">markers_to_analyze</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;V</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">pos_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">output_log</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span><span class="o">+</span><span class="s2">&quot;AF_</span><span class="si">{}</span><span class="s2">.log&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmp1</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">tmp_mle_mafs</span><span class="o">=</span><span class="n">tmp1</span><span class="o">.</span><span class="n">_MarkerMaker__getMLEfreq</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">markers_to_analyze</span><span class="p">,</span> <span class="n">pos_all</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">rsq</span><span class="p">,</span> <span class="n">output_log</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_mle_mafs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vname</span><span class="p">,</span> <span class="n">vmaf</span> <span class="ow">in</span> <span class="n">tmp_mle_mafs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">data</span><span class="o">.</span><span class="n">mle_mafs</span><span class="p">[</span><span class="n">vname</span><span class="p">]</span><span class="o">=</span><span class="n">vmaf</span>
                <span class="n">local_mle_mafs</span><span class="p">[</span><span class="n">vname</span><span class="p">]</span><span class="o">=</span><span class="n">vmaf</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp_mle_mafs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">varnames</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">families</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">getFamVariants</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;map&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">famvaridx</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">famsampidx</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gnomAD_pop</span><span class="o">=</span><span class="kc">None</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">:</span>
    <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">positions</span><span class="p">,</span> <span class="n">vcf_mafs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamVariants</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span><span class="p">)</span>
    <span class="n">recombPos</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">var_for_haplotype</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">positions_for_haplotype</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">output_sample</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># either use privided MAF or compute MAF</span>
    <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
        <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">tfreq_fam</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">gnomAD_estimate</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">tfreq_fam</span><span class="p">:</span>
                <span class="n">gnomAD_pop</span><span class="o">=</span><span class="n">pop</span>
                <span class="k">break</span>
    <span class="k">elif</span> <span class="n">gnomAD_pop</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">gnomAD_estimate</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">freq</span><span class="p">:</span>
                <span class="n">gnomAD_pop</span><span class="o">=</span><span class="n">pop</span>
                <span class="k">break</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
        <span class="n">tmp_maf_var</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">af_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#no vcf freq column specified</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_mafs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">mle</span><span class="p">:</span>
                <span class="c1">#use MLE freq for all variants</span>
                    <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="n">local_mle_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">count</span><span class="p">:</span>
                <span class="c1">#estimate MAF based on founder counts if MLE not specified</span>
                    <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="n">local_count_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="n">tmp_maf_var</span><span class="o">=</span><span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">af_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#if vcf freq column is specified</span>
            <span class="c1">#use vcf_mafs if possible</span>
            <span class="k">if</span> <span class="n">vcf_mafs</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                <span class="n">tmp_maf_var</span><span class="o">=</span><span class="n">vcf_mafs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
                    <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcf_mafs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_mafs</span><span class="p">:</span>
                        <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcf_mafs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#if variants do not have valid vcf_mafs values if specified</span>
                <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">gnomAD_pop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">gnomAD_estimate</span><span class="p">[</span><span class="n">gnomAD_pop</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">mle</span><span class="p">:</span>
                            <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="n">local_mle_mafs</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">]][</span><span class="n">v</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">count</span><span class="p">:</span>
                            <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="n">local_count_mafs</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">]][</span><span class="n">v</span><span class="p">]</span>
                    <span class="n">tmp_maf_var</span><span class="o">=</span><span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">v</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_mafs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">gnomAD_pop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">gnomAD_estimate</span><span class="p">[</span><span class="n">gnomAD_pop</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">mle</span><span class="p">:</span>
                            <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="n">local_mle_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">count</span><span class="p">:</span>
                            <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="n">local_count_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                    <span class="n">tmp_maf_var</span><span class="o">=</span><span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">rvhaplo</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tmp_maf_var</span><span class="o">&lt;=</span><span class="n">tmp1</span><span class="o">.</span><span class="n">maf_cutoff</span><span class="p">:</span>
                <span class="n">var_for_haplotype</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="n">positions_for_haplotype</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">rvhaplo</span><span class="p">:</span>
        <span class="n">var_for_haplotype</span><span class="o">=</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="n">positions_for_haplotype</span><span class="o">=</span><span class="n">positions</span>
    <span class="c1">#collect sample+genotypes</span>
    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">sort_family</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="n">output_sample</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="n">last_ele</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">output_sample</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">output_sample</span><span class="p">[</span><span class="n">last_ele</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tfam</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">person</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">var_for_haplotype</span><span class="p">:</span>
                <span class="n">idx</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">marker</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">output_sample</span><span class="p">[</span><span class="n">last_ele</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">genotype_all</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_sample</span><span class="p">[</span><span class="n">last_ele</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;00&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_for_haplotype</span><span class="p">))</span>
    <span class="c1"># haplotyping</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_for_haplotype</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">varnames</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1">#for person in data.families[item]:</span>
        <span class="c1">#    data[person] = tmp1.missings</span>
        <span class="k">continue</span>
    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">output_sample</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">person</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span><span class="o">==</span><span class="nb">set</span><span class="p">([</span><span class="s1">&#39;00&#39;</span><span class="p">]):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">missing_persons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">env</span><span class="o">.</span><span class="n">prephased</span><span class="p">:</span>
            <span class="n">tmp_log_output</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
            <span class="k">with</span> <span class="n">stdoutRedirect</span><span class="p">(</span><span class="n">to</span> <span class="o">=</span> <span class="n">tmp_log_output</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span><span class="p">):</span>
                <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">haplotyper</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="n">var_for_haplotype</span><span class="p">,</span> <span class="n">positions_for_haplotype</span><span class="p">,</span> <span class="n">output_sample</span><span class="p">,</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">rsq</span><span class="p">,</span> <span class="n">tmp_log_output</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">__PedToHaplotype</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getFamSamples</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># C++ haplotyping implementation failed</span>
        <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
            <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">var_for_haplotype</span>
    
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">hap_idx</span><span class="p">,</span><span class="n">haploid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">item</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">vidx</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">haploid</span><span class="p">[</span><span class="mi">2</span><span class="p">:]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">vidx</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">postvar_name</span><span class="o">=</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">vidx</span><span class="p">]</span>
                <span class="n">prevar_name</span><span class="o">=</span><span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">vidx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">recomb_pair</span> <span class="o">=</span> <span class="p">(</span><span class="n">prevar_name</span><span class="p">,</span><span class="n">postvar_name</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">recombPos</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">recomb_pair</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hap_idx</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">recombPos</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">recomb_pair</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">hap_idx</span><span class="p">]</span>
<span class="c1">#</span>
<span class="c1"># Compute founder MAFs</span>
<span class="c1">#</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_mafs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">tmp_mafs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tmp_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">][</span><span class="n">v</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">tmp_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tmp_mafs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
<span class="c1">## Make mafs consistent in structure regardless of freq_by_fam</span>
<span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
        <span class="n">popname</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">popname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_mafs</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mafs</span><span class="p">:</span>
            <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">tmp_mafs</span><span class="p">[</span><span class="n">popname</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tmp_mafs</span><span class="p">[</span><span class="n">popname</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                    <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="n">tmp_mafs</span><span class="p">[</span><span class="n">popname</span><span class="p">][</span><span class="n">v</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="p">:</span>
        <span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">tmp_mafs</span>
<span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;variant mafs = &quot;</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="c1">##</span>
<span class="c1">#</span>
<span class="c1"># Drop some variants if maf is greater than given threshold</span>
<span class="c1">#</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">maf_cutoff</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">single_markers</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
        <span class="n">exclude_vars</span><span class="o">=</span><span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">freq</span><span class="p">))]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">haplotypes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
            <span class="n">pop_idx</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">tmp_exclude_vars</span><span class="o">=</span><span class="n">exclude_vars</span><span class="p">[</span><span class="n">pop_idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmp_exclude_vars</span><span class="o">=</span><span class="n">exclude_vars</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mafs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">maf_cutoff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mafs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">maf_cutoff</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_exclude_vars</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">include_vars</span><span class="p">:</span>
                    <span class="n">tmp_exclude_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">single_markers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">include_vars</span><span class="p">:</span>
                    <span class="n">tmp_exclude_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">listit</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tmp_remain_vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_exclude_vars</span><span class="p">]</span>
        <span class="n">recomb_remain_vars</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_remain_vars</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">recombPos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recombPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1">#extend recombination signal to neighbouring RVs</span>
                <span class="c1">#if the original variant is to be excluded</span>
                <span class="c1">#Only allow a maximum of one recombination event between one pair of consecutive markers</span>
                <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">recombPos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_exclude_vars</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">tmp_remain_vars</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">recomb_remain_vars</span><span class="p">:</span>
                            <span class="n">recomb_remain_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">del</span> <span class="n">recombPos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">pair</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">tmp_remain_vars</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                            <span class="c1">#last variant</span>
                            <span class="k">del</span> <span class="n">recombPos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">pair</span><span class="p">]</span>
                            <span class="k">continue</span>
                        <span class="k">for</span> <span class="n">tmp_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                            <span class="k">if</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">tmp_idx</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_exclude_vars</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">tmp_remain_vars</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">tmp_idx</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                    <span class="c1">#delete recombination pair if the recombination was marked to the first remaining variant</span>
                                    <span class="k">del</span> <span class="n">recombPos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">pair</span><span class="p">]</span>
                                    <span class="k">break</span>
                                <span class="k">for</span> <span class="n">tmp_hap</span> <span class="ow">in</span> <span class="n">recombPos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">pair</span><span class="p">]:</span>
                                    <span class="n">tmp_var</span><span class="o">=</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">tmp_hap</span><span class="p">][</span><span class="n">tmp_idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                                    <span class="k">if</span> <span class="n">tmp_var</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">tmp_var</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">):</span>
                                        <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">tmp_hap</span><span class="p">][</span><span class="n">tmp_idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">tmp_var</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>
                                <span class="k">if</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">tmp_idx</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">recomb_remain_vars</span><span class="p">:</span>
                                    <span class="n">recomb_remain_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">tmp_idx</span><span class="p">])</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">del</span> <span class="n">recombPos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">pair</span><span class="p">]</span>
                                <span class="k">break</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
            <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> \
              <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">:])</span> <span class="k">if</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_exclude_vars</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tmp_var</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">tmp_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uniq_vars</span><span class="p">:</span>
                     <span class="n">uniq_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_var</span><span class="p">)</span>
        <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_exclude_vars</span><span class="p">]</span>
        <span class="c1"># handle trivial data</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recombPos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">&gt;</span><span class="n">tmp1</span><span class="o">.</span><span class="n">recomb_max</span><span class="p">:</span>
            <span class="c1">#treat as missing if recombination events occurred more than speicified times</span>
            <span class="n">recombPos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">families</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">missings</span>
            <span class="k">del</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">haplotypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="c1"># count how many variants are removed</span>
    <span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">commonvar_counter</span><span class="o">.</span><span class="n">get_lock</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
            <span class="n">tmp_ex_vars</span><span class="o">=</span><span class="p">[</span><span class="n">tmp_var</span> <span class="k">for</span> <span class="n">tmp_vars</span> <span class="ow">in</span> <span class="n">exclude_vars</span> <span class="k">for</span> <span class="n">tmp_var</span> <span class="ow">in</span> <span class="n">tmp_vars</span><span class="p">]</span>
            <span class="n">env</span><span class="o">.</span><span class="n">commonvar_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tmp_ex_vars</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">commonvar_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exclude_vars</span><span class="p">)</span>
    <span class="c1"># get total observed variants</span>
    <span class="k">if</span> <span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">:</span>
            <span class="n">pop</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">pop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">total_mafs</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">total_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
                <span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">total_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">]:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">total_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">][</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">v</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span><span class="p">[</span><span class="n">pop</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]))</span>
            <span class="n">data</span><span class="o">.</span><span class="n">wt_maf</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>
            <span class="k">for</span> <span class="n">v</span><span class="p">,</span><span class="n">tmaf</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">total_mafs</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">data</span><span class="o">.</span><span class="n">wt_maf</span><span class="p">[</span><span class="n">pop</span><span class="p">]</span><span class="o">*=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tmaf</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">total_mafs</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">total_mafs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="n">mafs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">v</span><span class="p">]</span>
        <span class="n">data</span><span class="o">.</span><span class="n">wt_maf</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span><span class="n">tmaf</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">total_mafs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">data</span><span class="o">.</span><span class="n">wt_maf</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">*=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tmaf</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">total_varnames</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">??</span>cstatgen.HaplotypingEngine<span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">wt_maf</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">aa</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">variants</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">aa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">aa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">dd</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">tmp</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">_MarkerMaker__Haplotype</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">count</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">mle</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">rvhaplo</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
<span class="n">tmp2</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">freq_by_fam</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">count</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">prephased</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">haplotypes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">mafs</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1">##Per fam per variant</span>
<span class="n">uniq_vars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">exclude_vars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">varnames</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">recombPos</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">tmp1</span><span class="o">.</span><span class="n">_MarkerMaker__Haplotype</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span> <span class="n">haplotypes</span><span class="p">,</span> <span class="n">mafs</span><span class="p">,</span> <span class="n">varnames</span><span class="p">,</span><span class="n">recombPos</span><span class="p">,</span><span class="n">uniq_vars</span><span class="p">,</span><span class="n">exclude_vars</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tm</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">recomb_perfam</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp2</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">variants</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">include_vars</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">variants</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp1</span><span class="o">.</span><span class="n">getRegion</span><span class="p">(</span><span class="n">aa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">tmp1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span><span class="kc">True</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">variants</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">chrom</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">variants</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp</span><span class="o">.</span><span class="n">vcf</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">??</span>EncoderWorker
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">total_counter</span><span class="o">.</span><span class="n">value</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">jobs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
    <span class="n">j</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
    <span class="n">j</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="n">faulthandler</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">faulthandler</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span> <span class="o">+</span> <span class="s1">&#39;.SEGV&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">freq_by_fam_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">freq_by_fam</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;haha&#39;</span><span class="p">)</span>
            <span class="n">freq_by_fam_flag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">)</span> <span class="k">as</span> <span class="n">freq_fh</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">freq_line</span> <span class="ow">in</span> <span class="n">freq_fh</span><span class="p">:</span>
                    <span class="n">tmp_eles</span><span class="o">=</span><span class="n">freq_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>   <span class="c1">#Fam and Population</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="p">[</span><span class="n">tmp_eles</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">tmp_eles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">data</span><span class="o">.</span><span class="n">freq</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">freq_by_fam</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">freq</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">freq</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">EncoderWorker</span><span class="p">(</span>
            <span class="n">queue</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">),</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="n">RegionExtractor</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">vcf</span><span class="p">,</span> <span class="n">chr_prefix</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">chr_prefix</span><span class="p">,</span> <span class="n">allele_freq_info</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="n">include_vars_file</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">include_vars</span><span class="p">),</span>
            <span class="n">MarkerMaker</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">bin</span><span class="p">,</span> <span class="n">maf_cutoff</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">maf_cutoff</span><span class="p">,</span><span class="n">single_markers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">single_markers</span><span class="p">,</span><span class="n">recomb_max</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">recomb_max</span><span class="p">,</span><span class="n">af_info</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span><span class="n">freq_by_fam</span><span class="o">=</span><span class="n">freq_by_fam_flag</span><span class="p">,</span><span class="n">rsq</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">rsq</span><span class="p">,</span><span class="n">mle</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">mle</span><span class="p">,</span> <span class="n">rvhaplo</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">rvhaplo</span><span class="p">,</span> <span class="n">recomb_perfam</span><span class="o">=</span><span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">recomb_cross_fam</span><span class="p">),</span>
            <span class="n">LinkageWriter</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples_not_vcf</span><span class="p">))</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">jobs</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="n">faulthandler</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="c1"># FIXME: need to properly close all jobs</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Use &#39;killall </span><span class="si">{}</span><span class="s2">&#39; to properly terminate all processes!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">prog</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units (from </span><span class="si">{:,d}</span><span class="s1"> variants) processed; &#39;</span>\
            <span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> Mendelian inconsistencies and </span><span class="si">{:,d}</span><span class="s1"> recombination events handled</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span>\
            <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">success_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="n">env</span><span class="o">.</span><span class="n">variants_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="n">env</span><span class="o">.</span><span class="n">mendelerror_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="n">env</span><span class="o">.</span><span class="n">recomb_counter</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">flush</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">triallelic_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> tri-allelic loci were ignored&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">triallelic_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">commonvar_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> variants ignored due to having MAF &gt; </span><span class="si">{}</span><span class="s1"> and other specified constraints&#39;</span><span class="o">.</span>\
                    <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">commonvar_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">maf_cutoff</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">null_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units ignored due to absence in VCF file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">null_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">trivial_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units ignored due to absence of variation in samples&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">trivial_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="n">fatal_errors</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Error msg from C++ extension</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;cat </span><span class="si">{}</span><span class="s2">/*.* &gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span><span class="p">))</span>
            <span class="n">fatal_errors</span> <span class="o">=</span> <span class="n">wordCount</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_log</span><span class="p">)[</span><span class="s1">&#39;fatal&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:,d}</span><span class="s2"> regional markers failed to be generated due to haplotyping failures!&quot;</span><span class="o">.</span>\
                      <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">chperror_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fatal_errors</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:,d}</span><span class="s2"> or more regional markers failed to be generated due to runtime errors!&quot;</span><span class="o">.</span>\
                      <span class="nb">format</span><span class="p">(</span><span class="n">fatal_errors</span><span class="p">))</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Archiving regional marker data to directory [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">cache_dir</span><span class="p">))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">arcroot</span> <span class="o">=</span> <span class="s1">&#39;CACHE&#39;</span><span class="p">,</span> <span class="n">source_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">jobs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tpeds</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tped&#39;</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">format</span><span class="p">:</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">setID</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">vanilla</span> <span class="ow">and</span> <span class="n">cache</span><span class="o">.</span><span class="n">check</span><span class="p">():</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Loading </span><span class="si">{}</span><span class="s1"> data from archive ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">target_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units will be converted to </span><span class="si">{}</span><span class="s1"> format&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">success_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">env</span><span class="o">.</span><span class="n">format_counter</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">format</span><span class="p">(</span><span class="n">tpeds</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_cache</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.tfam&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">)),</span>
               <span class="n">args</span><span class="o">.</span><span class="n">prevalence</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">wild_pen</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">muta_pen</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span>
               <span class="n">args</span><span class="o">.</span><span class="n">inherit_mode</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_max</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_inc</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:,d}</span><span class="s1"> units successfully converted to </span><span class="si">{}</span><span class="s1"> format</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span>\
                <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">format_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">flush</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">skipped_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="c1"># FIXME: perhaps we need to rephrase this message?</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> region - family pairs skipped&#39;</span><span class="o">.</span>\
                    <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">skipped_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Archiving </span><span class="si">{}</span><span class="s1"> format to directory [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">env</span><span class="o">.</span><span class="n">cache_dir</span><span class="p">))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">arcroot</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                    <span class="n">source_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">mkpath</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">outdir</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">run_linkage</span><span class="p">:</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">setID</span><span class="p">(</span><span class="s1">&#39;analysis&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">vanilla</span> <span class="ow">and</span> <span class="n">cache</span><span class="o">.</span><span class="n">check</span><span class="p">():</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Loading linkage analysis result from archive ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">target_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;heatmap&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Running linkage analysis ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">run_linkage</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">blueprint</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_inc</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_max</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">output_limit</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Linkage analysis succesfully performed for </span><span class="si">{:,d}</span><span class="s1"> units</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span>\
                <span class="nb">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">run_counter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">flush</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">makeped_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &quot;makeped&quot; runtime errors occurred&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">makeped_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">pedcheck_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &quot;pedcheck&quot; runtime errors occurred&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">pedcheck_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">unknown_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &quot;unknown&quot; runtime errors occurred&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">unknown_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">mlink_counter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &quot;mlink&quot; runtime errors occurred&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">mlink_counter</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">arcroot</span> <span class="o">=</span> <span class="s1">&#39;heatmap&#39;</span><span class="p">,</span> <span class="n">source_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;heatmap&#39;</span><span class="p">),</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">html</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">theta_inc</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta_max</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">output_limit</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">env</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Saving data to [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">)))</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">target_dir</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">format</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Args</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

